(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{595:function(e,t,n){var content=n(658);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(87).default)("16f5d698",content,!0,{sourceMap:!1})},657:function(e,t,n){"use strict";n(595)},658:function(e,t,n){var o=n(86)(!1);o.push([e.i,'[data-v-6ee10543]:export{base-width--small:320px;base-width--medium:768px;base-width--large:1600px;base-font-size--small:1vw;base-font-size--medium:1vw;base-font-size--large:1vw;max-width--small:none;max-width--medium:none;max-width--large:none}@media(min-width:0){html[data-v-6ee10543]:before{display:none;content:"small"}}@media(min-width:500px){html[data-v-6ee10543]:before{display:none;content:"medium"}}@media(min-width:850px){html[data-v-6ee10543]:before{display:none;content:"large"}}.the-webgl-background[data-v-6ee10543]{position:fixed;top:0;left:0;background-color:#fff}',""]),e.exports=o},675:function(e,t,n){"use strict";n.r(t);n(31),n(24),n(30),n(15),n(38),n(26),n(39);var o=n(8),r=(n(104),n(48)),l=n(650),c=n(0),h=n(1),d=(n(40),n(47),n(205),n(36),n(203),n(69)),m=n(3),f=n(669),v=n(651),_=n.n(v),y=n(37),x=n(2),w=n(45),S=n(4);n(119),n(49),n(46),n(59),n(78);function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var C=function(){function e(){Object(c.a)(this,e),this.data={},this.listeners={},this.fireAtStart={},this.instances=[],this.globals={}}return Object(h.a)(e,[{key:"on",value:function(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}},{key:"off",value:function(e,t){e in this.listeners!=!1&&this.listeners[e].splice(this.listeners[e].indexOf(t),1)}},{key:"register",value:function(e){for(var t in this.instances.push(e),this.fireAtStart)this.fireMethod(e,t)}},{key:"unregister",value:function(e){var t=this.instances.indexOf(e);t>-1&&this.instances.splice(t,1)}},{key:"nameToMethod",value:function(e){return"on".concat(e.charAt(0).toUpperCase()+e.slice(1))}},{key:"fireMethod",value:function(e,t){var n=e[this.nameToMethod(t)];"function"==typeof n&&n.call(e,this.data[t])}},{key:"trigger",value:function(e){var t=this,n=e.name,o=e.fireAtStart,r=void 0!==o&&o,l=e.log,c=void 0!==l&&l,data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.data[n]=data,r&&(this.fireAtStart[n]=!0),c&&console.log("üë®‚Äçüè´ ".concat(n," ‚Äì ").concat(data)),n in this.listeners)for(var i=0;i<this.listeners[n].length;i++)this.listeners[n][i].call(this,data);this.instances.forEach((function(e){return t.fireMethod(e,n)}))}},{key:"registerGlobal",value:function(e,t){this.globals["$".concat(e)]=t}}]),e}(),M=new C;function component(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.a)((function e(){Object(c.a)(this,e)}));return function(e){Object(x.a)(n,e);var t=k(n);function n(){var e,o;Object(c.a)(this,n);for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];return o=t.call.apply(t,[this].concat(l)),Object.assign(Object(y.a)(o),M.globals),o._args=l,o.init&&(e=o).init.apply(e,l),M.register(Object(y.a)(o)),o}return Object(h.a)(n,[{key:"destroy",value:function(){M.unregister(this)}}]),n}(e)}var O=M,P=n(102),R=n(259),A=n(345);function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var F=function(e){Object(x.a)(n,e);var t=T(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.a)(this,n),(e=t.call(this)).el=o.el,e._touchStartPosition={x:0,y:0},e._touchPosition={x:0,y:0},e._dragDelta={x:0,y:0},e._enabled=!0,e._isDraging=!1,e._bindAll(),e._setup(),e}return Object(h.a)(n,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"destroy",value:function(){this._removeEventListeners()}},{key:"_setup",value:function(){this._setupEventListeners()}},{key:"_bindAll",value:function(){this._touchstartHandler=this._touchstartHandler.bind(this),this._touchmoveHandler=this._touchmoveHandler.bind(this),this._touchendHandler=this._touchendHandler.bind(this),this._mousedownHandler=this._mousedownHandler.bind(this),this._mousemoveHandler=this._mousemoveHandler.bind(this),this._mouseupHandler=this._mouseupHandler.bind(this)}},{key:"_setupEventListeners",value:function(){A.a.isTouch()?(this.el.addEventListener("touchstart",this._touchstartHandler),window.addEventListener("touchmove",this._touchmoveHandler),window.addEventListener("touchend",this._touchendHandler)):(this.el.addEventListener("mousedown",this._mousedownHandler),window.addEventListener("mousemove",this._mousemoveHandler),window.addEventListener("mouseup",this._mouseupHandler))}},{key:"_removeEventListeners",value:function(){A.a.isTouch()?(this.el.removeEventListener("touchstart",this._touchstartHandler),window.removeEventListener("touchmove",this._touchmoveHandler),window.removeEventListener("touchend",this._touchendHandler)):(this.el.removeEventListener("mousedown",this._mousedownHandler),window.removeEventListener("mousemove",this._mousemoveHandler),window.removeEventListener("mouseup",this._mouseupHandler))}},{key:"_dragstartHandler",value:function(e){this._enabled&&this.dispatchEvent("dragstart",e)}},{key:"_dragHandler",value:function(e){this._enabled&&this.dispatchEvent("drag",e)}},{key:"_dragendHandler",value:function(e){this._enabled&&this.dispatchEvent("dragend",e)}},{key:"_tapHandler",value:function(e){this._enabled&&this.dispatchEvent("tap",e)}},{key:"_touchdownHandler",value:function(e){this._enabled&&this.dispatchEvent("touchdown",e)}},{key:"_touchupHandler",value:function(e){this._enabled&&this.dispatchEvent("touchup",e)}},{key:"_mousedownHandler",value:function(e){this._isDraging=!0;var t={x:e.clientX,y:e.clientY},n={x:0,y:0};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._touchStartPosition.x=t.x,this._touchStartPosition.y=t.y,this._touchdownHandler({position:t,delta:n}),this._dragstartHandler({position:t,delta:n})}},{key:"_mousemoveHandler",value:function(e){if(this._isDraging){var t={x:e.clientX,y:e.clientY},n={x:this._touchPosition.x-t.x,y:this._touchPosition.y-t.y};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._dragDelta.x=n.x,this._dragDelta.y=n.y,this._dragHandler({position:t,delta:n})}}},{key:"_mouseupHandler",value:function(){var e=this._touchPosition,t=this._dragDelta;this._isDraging&&Math.abs(e.x-this._touchStartPosition.x)<2&&Math.abs(e.y-this._touchStartPosition.y)<2?this._tapHandler({position:e,delta:t}):this._dragendHandler({position:e,delta:t}),this._isDraging=!1,this._touchupHandler({position:e,delta:t})}},{key:"_touchstartHandler",value:function(e){this._isDraging=!0;var t={x:e.touches[0].clientX,y:e.touches[0].clientY},n={x:0,y:0};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._touchStartPosition.x=t.x,this._touchStartPosition.y=t.y,this._touchdownHandler({position:t,delta:n}),this._dragstartHandler({position:t,delta:n})}},{key:"_touchmoveHandler",value:function(e){if(this._isDraging){var t={x:e.touches[0].clientX,y:e.touches[0].clientY},n={x:this._touchPosition.x-t.x,y:this._touchPosition.y-t.y};this._touchPosition.x=t.x,this._touchPosition.y=t.y,this._dragDelta.x=n.x,this._dragDelta.y=n.y,this._dragHandler({position:t,delta:n})}}},{key:"_touchendHandler",value:function(){var e=this._touchPosition,t=this._dragDelta;this._isDraging&&Math.abs(e.x-this._touchStartPosition.x)<2&&Math.abs(e.y-this._touchStartPosition.y)<2?this._tapHandler({position:e,delta:t}):this._dragendHandler({position:e,delta:t}),this._isDraging=!1,this._touchupHandler({position:e,delta:t})}}]),n}(R.a),L=F,I=new(function(){function e(){Object(c.a)(this,e),this._viewportWidth=P.a.innerWidth,this._viewportHeight=P.a.innerHeight,this._mousePosition=new m.Vector2,this._normalizedMousePosition=new m.Vector2,this._centeredMousePosition=new m.Vector2,this._bindAll()}return Object(h.a)(e,[{key:"start",value:function(){this._dragManager=this._createDragManager(),this._setupEventListeners()}},{key:"dragManager",get:function(){return this._dragManager}},{key:"_createDragManager",value:function(){return new L({el:document.querySelector(".the-webgl-background")})}},{key:"_bindAll",value:function(){this._mousemoveHandler=this._mousemoveHandler.bind(this),this._resizeHandler=this._resizeHandler.bind(this),this._tapHandler=this._tapHandler.bind(this)}},{key:"_setupEventListeners",value:function(){window.addEventListener("mousemove",this._mousemoveHandler),this._dragManager.addEventListener("tap",this._tapHandler),P.a.addEventListener("resize",this._resizeHandler)}},{key:"_mousemoveHandler",value:function(e){this._mousePosition.x=e.clientX,this._mousePosition.y=e.clientY,this._normalizedMousePosition.x=this._mousePosition.x/this._viewportWidth,this._normalizedMousePosition.y=1-this._mousePosition.y/this._viewportHeight,this._centeredMousePosition.x=this._mousePosition.x/this._viewportWidth*2-1,this._centeredMousePosition.y=-this._mousePosition.y/this._viewportHeight*2+1,O.trigger({name:"mousemove",fireAtStart:!1},{mousePosition:this._mousePosition,normalizedMousePosition:this._normalizedMousePosition,centeredMousePosition:this._centeredMousePosition})}},{key:"_tapHandler",value:function(e){window.nativeButtonClicked||(this._mousePosition.x=e.position.x,this._mousePosition.y=e.position.y,this._normalizedMousePosition.x=this._mousePosition.x/this._viewportWidth,this._normalizedMousePosition.y=1-this._mousePosition.y/this._viewportHeight,this._centeredMousePosition.x=this._mousePosition.x/this._viewportWidth*2-1,this._centeredMousePosition.y=-this._mousePosition.y/this._viewportHeight*2+1,O.trigger({name:"click",fireAtStart:!1},{mousePosition:this._mousePosition,normalizedMousePosition:this._normalizedMousePosition,centeredMousePosition:this._centeredMousePosition}))}},{key:"_resizeHandler",value:function(e){var t=e.innerWidth,n=e.innerHeight;this._viewportWidth=t,this._viewportHeight=n}}]),e}()),j=n(344),D=n(5),z=n(35),U=n.n(z),N={name:"Sample",resources:[]},B=n(652);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var H=function(e){Object(x.a)(n,e);var t=E(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debug=e.debugFolder,this._bindAll(),this._initialSettings={fov:45,near:1,far:1e3,position:{x:0,y:0,z:5},rotation:{x:0,y:0,z:0}},this._initialize(),this._applySavedSettings(),this._enabled=!1,this._debugFolder=this._createDebugFolder(),this._controls=this._createCameraControls(),this._setupEventListeners()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._controls.dispose(),this._removeEventListeners()}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this._controls.enabled=e}},{key:"_initialize",value:function(){this.fov=this._initialSettings.fov,this.near=this._initialSettings.near,this.far=this._initialSettings.far,this.position.x=this._initialSettings.position.x,this.position.y=this._initialSettings.position.y,this.position.z=this._initialSettings.position.z,this.rotation.x=this._initialSettings.rotation.x,this.rotation.y=this._initialSettings.rotation.y,this.rotation.z=this._initialSettings.rotation.z,this.updateProjectionMatrix()}},{key:"_applySavedSettings",value:function(){var e=JSON.parse(localStorage.getItem("camera-orbit-settings")),t=JSON.parse(localStorage.getItem("camera-orbit-position")),n=JSON.parse(localStorage.getItem("camera-orbit-rotation"));e&&e.fov&&(this.fov=e.fov),e&&e.near&&(this.near=e.near),e&&e.far&&(this.far=e.far),t&&(this.position.x=t.x),t&&(this.position.y=t.y),t&&(this.position.z=t.z),n&&(this.rotation.x=n.x),n&&(this.rotation.y=n.y),n&&(this.rotation.z=n.z),this.updateProjectionMatrix()}},{key:"_createCameraControls",value:function(){var e=new B.a(this,this.$renderer.domElement);return e.update(),e}},{key:"_bindAll",value:function(){this._controlsChangeHandler=this._controlsChangeHandler.bind(this),this._updateCameraSettingsHandler=this._updateCameraSettingsHandler.bind(this),this._resetSettingsClickHandler=this._resetSettingsClickHandler.bind(this)}},{key:"onUpdate",value:function(){}},{key:"onWindowResize",value:function(e){this.aspect=e.innerWidth/e.innerHeight,this.updateProjectionMatrix()}},{key:"_setupEventListeners",value:function(){this._controls.addEventListener("change",this._controlsChangeHandler)}},{key:"_removeEventListeners",value:function(){this._controls.removeEventListener("change",this._controlsChangeHandler)}},{key:"_controlsChangeHandler",value:function(e){localStorage.setItem("camera-orbit-position",JSON.stringify(this.position)),localStorage.setItem("camera-orbit-rotation",JSON.stringify(this.rotation))}},{key:"_updateCameraSettingsHandler",value:function(){var e={fov:this.fov,near:this.near,far:this.far};localStorage.setItem("camera-orbit-settings",JSON.stringify(e)),this.updateProjectionMatrix()}},{key:"_resetSettingsClickHandler",value:function(){localStorage.removeItem("camera-orbit-settings"),localStorage.removeItem("camera-orbit-position"),localStorage.removeItem("camera-orbit-rotation"),this._initialize(),this.$debugger.refresh()}},{key:"_createDebugFolder",value:function(){if(this._debug){var e=this._debug.addFolder({title:"Orbit",expanded:!1});return e.addInput(this,"fov").on("change",this._updateCameraSettingsHandler),e.addInput(this,"near").on("change",this._updateCameraSettingsHandler),e.addInput(this,"far").on("change",this._updateCameraSettingsHandler),e.addButton({label:" ",title:"Reset settings"}).on("click",this._resetSettingsClickHandler),e}}}]),n}(component(m.PerspectiveCamera));function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var V=function(e){Object(x.a)(n,e);var t=G(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debug=e.debugFolder,this._bindAll(),this._initialSettings={fov:45,near:1,far:1e3,position:{x:0,y:0,z:5},rotation:{x:0,y:0,z:0}},this._initialize(),this._applySavedSettings(),this._enabled=!1,this._debugFolder=this._createDebugFolder()}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"_initialize",value:function(){this.fov=this._initialSettings.fov,this.near=this._initialSettings.near,this.far=this._initialSettings.far,this.position.x=this._initialSettings.position.x,this.position.y=this._initialSettings.position.y,this.position.z=this._initialSettings.position.z,this.rotation.x=this._initialSettings.rotation.x,this.rotation.y=this._initialSettings.rotation.y,this.rotation.z=this._initialSettings.rotation.z,this.updateProjectionMatrix()}},{key:"_applySavedSettings",value:function(){var e=JSON.parse(localStorage.getItem("camera-default-settings")),t=JSON.parse(localStorage.getItem("camera-default-position")),n=JSON.parse(localStorage.getItem("camera-default-rotation"));e&&e.fov&&(this.fov=e.fov),e&&e.near&&(this.near=e.near),e&&e.far&&(this.far=e.far),t&&t.x&&(this.position.x=t.x),t&&t.y&&(this.position.y=t.y),t&&t.z&&(this.position.z=t.z),n&&n.x&&(this.rotation.x=n.x),n&&n.y&&(this.rotation.y=n.y),n&&n.z&&(this.rotation.z=n.z),this.updateProjectionMatrix()}},{key:"_bindAll",value:function(){this._updateCameraSettingsHandler=this._updateCameraSettingsHandler.bind(this),this._resetSettingsClickHandler=this._resetSettingsClickHandler.bind(this)}},{key:"onWindowResize",value:function(e){this.aspect=e.innerWidth/e.innerHeight,this.updateProjectionMatrix()}},{key:"_updateCameraSettingsHandler",value:function(){var e={fov:this.fov,near:this.near,far:this.far};localStorage.setItem("camera-default-settings",JSON.stringify(e)),localStorage.setItem("camera-default-position",JSON.stringify(this.position)),localStorage.setItem("camera-default-rotation",JSON.stringify({x:this.rotation.x,y:this.rotation.y,z:this.rotation.z})),this.updateProjectionMatrix()}},{key:"_resetSettingsClickHandler",value:function(){localStorage.removeItem("camera-default-settings"),localStorage.removeItem("camera-default-position"),localStorage.removeItem("camera-default-rotation"),this._initialize(),this.$debugger.refresh()}},{key:"_createDebugFolder",value:function(){if(this._debug){var e=this._debug.addFolder({title:"Default",expanded:!1});return e.addInput(this,"fov").on("change",this._updateCameraSettingsHandler),e.addInput(this,"near").on("change",this._updateCameraSettingsHandler),e.addInput(this,"far").on("change",this._updateCameraSettingsHandler),e.addInput(this,"position").on("change",this._updateCameraSettingsHandler),e.addInput(this,"rotation").on("change",this._updateCameraSettingsHandler),e.addButton({label:" ",title:"Reset settings"}).on("click",this._resetSettingsClickHandler),e}}}]),n}(component(m.PerspectiveCamera)),W=n(258);function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Y=function(e){Object(x.a)(n,e);var t=$(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debug=e.debugFolder,this._bindAll(),this._initialSettings={fov:45,near:3,far:1e3,position:{x:0,y:0,z:5},rotation:{x:0,y:0,z:0}},this._cameraOffsetZ=0,"medium"===W.a.current&&(this._cameraOffsetZ=3),"small"===W.a.current&&(this._cameraOffsetZ=6),this._initialize(),this._applySavedSettings(),this._cameraModel=null,this._enabled=!1,this._debugFolder=this._createDebugFolder()}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"isAnimationCompleted",get:function(){return!!this._cameraModel&&this._cameraModel.isAnimationCompleted}},{key:"applyModelCamera",value:function(e){this._cameraModel=e,this.fov=this._cameraModel.fov,this.updateProjectionMatrix()}},{key:"_initialize",value:function(){this.fov=this._initialSettings.fov,this.near=this._initialSettings.near,this.far=this._initialSettings.far,this.position.x=this._initialSettings.position.x,this.position.y=this._initialSettings.position.y,this.position.z=this._initialSettings.position.z,this.rotation.x=this._initialSettings.rotation.x,this.rotation.y=this._initialSettings.rotation.y,this.rotation.z=this._initialSettings.rotation.z,this.updateProjectionMatrix()}},{key:"_applySavedSettings",value:function(){}},{key:"onUpdate",value:function(){this._cameraModel&&(this._cameraModel.isAnimationCompleted||(this.position.x=this._cameraModel.position.x,this.position.y=this._cameraModel.position.y,this.position.z=this._cameraModel.position.z+this._cameraOffsetZ,this.rotation.copy(this._cameraModel.rotation)))}},{key:"_bindAll",value:function(){this._updateCameraSettingsHandler=this._updateCameraSettingsHandler.bind(this),this._resetSettingsClickHandler=this._resetSettingsClickHandler.bind(this)}},{key:"onWindowResize",value:function(e){this.aspect=e.innerWidth/e.innerHeight,this.updateProjectionMatrix()}},{key:"_updateCameraSettingsHandler",value:function(){this.fov,this.near,this.far;this.updateProjectionMatrix()}},{key:"_resetSettingsClickHandler",value:function(){this._initialize(),this.$debugger.refresh()}},{key:"_createDebugFolder",value:function(){if(this._debug){var e=this._debug.addFolder({title:"Model",expanded:!1});return e.addInput(this,"fov").on("change",this._updateCameraSettingsHandler),e.addInput(this,"near").on("change",this._updateCameraSettingsHandler),e.addInput(this,"far").on("change",this._updateCameraSettingsHandler),e.addInput(this,"position").on("change",this._updateCameraSettingsHandler),e.addInput(this,"rotation").on("change",this._updateCameraSettingsHandler),e.addButton({label:" ",title:"Reset settings"}).on("click",this._resetSettingsClickHandler),e}}}]),n}(component(m.PerspectiveCamera)),K={Default:V,Orbit:H,Model:Y};function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Z=function(e){Object(x.a)(n,e);var t=X(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._types=e.types||["Default"],this._debug=e.debugFolder||this.$debugger,this._bindAll(),this._settings={active:this._types[0]},this._debugFolder=this._createDebugFolder(),this._cameras=this._createCameras(),this._camera=this._cameras[this._settings.active],this._camera.enabled=!0}},{key:"camera",get:function(){return this._camera}},{key:"cameras",get:function(){return this._cameras}},{key:"getCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Default";if(!this._cameras[e])throw new Error('No camera with type: "'.concat(e,'" was found'));return this._cameras[e]}},{key:"_createCameras",value:function(){for(var e={},i=0;i<this._types.length;i++){var t=this._types[i];if(!K[t])throw new Error('No camera with type: "'.concat(t,'" was found'));e[t]=new K[t]({debugFolder:this._debugFolder})}return e}},{key:"_updateActiveCamera",value:function(e){this._camera.enabled=!1,this._camera=e,this._camera.enabled=!0}},{key:"_bindAll",value:function(){this._activeCameraChangedHandler=this._activeCameraChangedHandler.bind(this)}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){}},{key:"_createDebugFolder",value:function(){if(this._debug){for(var e={},i=0;i<this._types.length;i++){var t=this._types[i];e[t]=t}var n=this._debug.addFolder({title:"Camera Manager",expanded:!1});return n.addInput(this._settings,"active",{label:"Active",options:e}).on("change",this._activeCameraChangedHandler),n}}},{key:"_activeCameraChangedHandler",value:function(){var e=this._cameras[this._settings.active];this._updateActiveCamera(e)}}]),n}(component());function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Q=function(e){Object(x.a)(n,e);var t=J(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._geometry=this._createGeometry(),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"_createGeometry",value:function(){return new m.BoxGeometry(1,1,1)}},{key:"_createMaterial",value:function(){return new m.MeshNormalMaterial}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return this.add(e),e}},{key:"onUpdate",value:function(e){var time=e.time;e.deltaTime,e.frame;this._mesh.rotation.x=time,this._mesh.rotation.y=time,this._mesh.rotation.z=time}},{key:"onWindowResize",value:function(e){this._resize()}},{key:"_resize",value:function(){this._mesh.scale.set(1,1,1)}},{key:"_createDebugFolder",value:function(){if(this._debug)return this._debug.addFolder({title:"Box"})}}]),n}(component(m.Object3D));function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var te=function(e){Object(x.a)(n,e);var t=ee(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){this._bindAll(),this._config=N,this._debugFolder=this._createDebugFolder(),this._cameraManager=this._createCameraManager(),this._resourceManager=this._createResourceManager(),this._setupEventListeners()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._destroyComponents(),this._removeEventListeners()}},{key:"config",get:function(){return this._config}},{key:"camera",get:function(){return this._cameraManager.camera}},{key:"_start",value:function(){this._components=this._createComponents()}},{key:"_createCameraManager",value:function(){return new Z({types:["Orbit","Default"],debugFolder:this._debugFolder})}},{key:"_createResourceManager",value:function(){var e=new z.ResourceManager;return e.add(N.resources),e.load(),e}},{key:"_bindAll",value:function(){this._loadCompleteHandler=this._loadCompleteHandler.bind(this)}},{key:"_createComponents",value:function(){return{box:this._createComponentBox()}}},{key:"_createComponentBox",value:function(){var e=new Q({debugFolder:this._debugFolder});return this.add(e),e}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){}},{key:"_setupEventListeners",value:function(){this._resourceManager.addEventListener("complete",this._loadCompleteHandler)}},{key:"_removeEventListeners",value:function(){this._resourceManager.removeEventListener("complete",this._loadCompleteHandler)}},{key:"_loadCompleteHandler",value:function(){this._start()}},{key:"_createDebugFolder",value:function(){if(this.$debugger)return this.$debugger.addFolder({title:"Scene ".concat(N.name)})}}]),n}(component(m.Scene)),ie=(n(570),n(32));function ne(e){return e&&"object"===Object(ie.a)(e)&&!Array.isArray(e)}function ae(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!n.length)return e;var source=n.shift();if(ne(e)&&ne(source))for(var l in source)ne(source[l])?(e[l]||Object.assign(e,Object(o.a)({},l,{})),ae(e[l],source[l])):Object.assign(e,Object(o.a)({},l,source[l]));return ae.apply(void 0,[e].concat(n))}var se={name:"Main",resources:[],settings:{large:{backgroundColor:"#ffffff",sky:{levels:{min:-1.54,level:.34,max:1.1},contrast:1,saturation:1.31,brightness:1.21,color1:"#ffffff",color2:"#ffffff"},layers:{scaleProgress0:.1,scale0:new m.Vector2(1.2,1.2),offset0:new m.Vector2(0,0),scaleProgress1:.2,scale1:new m.Vector2(1.5,1.5),offset1:new m.Vector2(0,0),scaleProgress2:.3,scale2:new m.Vector2(1.7,1.7),offset2:new m.Vector2(0,0),scaleMin:.1,scaleMax:1.4},mask:{scaleProgress:0,scaleMin:.1,scaleMax:1.4},vignette:{enabled:!0,uvScale:1.02,scale:18.37,intensity:0,intensityMin:0,intensityMiddle:.3,intensityMax:.7,alpha:0,alphaMin:0,alphaMax:.48},text:{scaleMin:.8773,opacity:1,scale:3.26,width:53,lineHeight:57.72,color:new m.Color("red"),position:new m.Vector2(0,-521.2),texture:{scale:new m.Vector2(1.2,1.2),offset:new m.Vector2(0,0),levels:{min:-1.04,level:.34,max:1.1},contrast:1,saturation:1.31,brightness:1.21,color1:"#ffffff",color2:"#ffffff"}}},medium:{mask:{scaleProgress:0,scaleMin:.175,scaleMax:1.4},text:{scaleMin:.89966,scale:4.74,width:53,lineHeight:53.850342,position:new m.Vector2(0,-1012.68),texture:{scale:new m.Vector2(1.2,1.2),offset:new m.Vector2(0,0),levels:{min:-1.04,level:.34,max:1.1},contrast:1,saturation:1.31,brightness:1.21,color1:"#ffffff",color2:"#ffffff"}},layers:{scaleProgress0:.1,scale0:new m.Vector2(1.2,1.2),offset0:new m.Vector2(0,0),scaleProgress1:.2,scale1:new m.Vector2(1.5,1.5),offset1:new m.Vector2(0,0),scaleProgress2:.3,scaleMin:.175,scaleMax:1.4}},small:{mask:{scaleProgress:0,scaleMin:.355,scaleMax:1.5},text:{scaleMin:.81838,scale:9.36,width:53,lineHeight:55.292969,position:new m.Vector2(0,-1137.16),texture:{scale:new m.Vector2(1.2,1.2),offset:new m.Vector2(0,0),levels:{min:-1.04,level:.34,max:1.1},contrast:1,saturation:1.31,brightness:1.21,color1:"#ffffff",color2:"#ffffff"}},layers:{scaleProgress0:.1,scale0:new m.Vector2(1.2,1.2),offset0:new m.Vector2(0,0),scaleProgress1:.2,scale1:new m.Vector2(1.5,1.5),offset1:new m.Vector2(0,0),scaleProgress2:.3,scaleMin:.355,scaleMax:1.5}}}};function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var re=function(e){Object(x.a)(n,e);var t=oe(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._texture=e.texture,this._material=e.material,this._geometry=this._createGeometry(),this._material=this._material||this._createMaterial(),this._mesh=this._createMesh()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"texture",get:function(){return this._texture},set:function(e){this._texture=e,this._material.uniforms.uMap.value=e}},{key:"_createGeometry",value:function(){return new m.PlaneGeometry(1,1,1)}},{key:"_createMaterial",value:function(){return new m.ShaderMaterial({transparent:!0,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uMap;\n\nvoid main() {\n\tgl_FragColor = texture2D(uMap, vUv);\n}",uniforms:{uMap:{value:this._texture}}})}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return this.add(e),e}}]),n}(component(m.Object3D)),le=(n(55),n(653)),ue=n(51);function ce(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function he(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ce(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):ce(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var me=function(e){Object(x.a)(n,e);var t=de(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._value=e.value,this._debug=e.debugFolder,this._texture=e.texture,this._globalSettings=e.settings,this._settings=null,this._tweenObject={scale:{progress:0}},this._applySettings(),this._dimensions=P.a.dimensions,this._textContainer=this._createTextContainer(),this._geometry=this._createGeometry(),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this._resize()}},{key:"playIntroLoadingAnimation",value:function(){return new d.b.timeline}},{key:"playLoadingAnimationComplete",value:function(){var e=new d.b.timeline;return e.to(this._tweenObject.scale,{duration:2,progress:1,ease:"power2.inOut"},0),e}},{key:"hide",value:function(){var e=new d.b.timeline;return e.to(this._material.uniforms.uOpacity,{duration:1,value:0,ease:"sine.in"},0),e.to(this._textContainer.position,{duration:1,y:20,ease:"power3.in"},0),e}},{key:"skipLoadingAnimation",value:function(){this._material.uniforms.uOpacity.value=0}},{key:"_applySettings",value:function(){"large"===W.a.current&&(this._settings=this._globalSettings.large.text),"medium"===W.a.current&&(this._settings=ae(this._globalSettings.large.text,this._globalSettings.medium.text)),"small"===W.a.current&&(this._settings=ae(this._globalSettings.large.text,this._globalSettings.small.text)),P.a.innerWidth>1e3&&P.a.innerWidth<1300&&P.a.innerHeight>750&&P.a.innerHeight<1050&&(this._settings.scaleMin=.94*this._settings.scaleMin)}},{key:"_scaleSettings",value:function(){}},{key:"_createTextContainer",value:function(){var e=new m.Object3D;return this.add(e),e}},{key:"_createGeometry",value:function(){var e=U.a.get("fnt-ogg-text-book");return new le.MSDFTextGeometry({text:this._value,font:e,align:"center",width:this._settings.width,lineHeight:this._settings.lineHeight})}},{key:"_createMaterial",value:function(){var e=new m.ShaderMaterial({side:m.DoubleSide,transparent:!0,defines:{IS_SMALL:!1},extensions:{derivatives:!0},uniforms:he(he(he(he({},le.uniforms.common),le.uniforms.rendering),le.uniforms.strokes),{},{uTexture:{value:this._texture},uResolution:{value:new m.Vector2(0,0)},uScale:{value:this._settings.texture.scale},uOffset:{value:this._settings.texture.offset},uLevelMin:{value:this._settings.texture.levels.min},uLevel:{value:this._settings.texture.levels.level},uLevelMax:{value:this._settings.texture.levels.max},uContrast:{value:this._settings.texture.contrast},uSaturation:{value:this._settings.texture.saturation},uBrightness:{value:this._settings.texture.brightness},uColor1:{value:new m.Color(this._settings.texture.color1)},uColor2:{value:new m.Color(this._settings.texture.color2)}}),vertexShader:"#define GLSLIFY 1\n// Attribute\n#include <three_msdf_attributes>\n\n// Varyings\n#include <three_msdf_varyings>\n\nvoid main() {\n    #include <three_msdf_vertex>\n}\n",fragmentShader:"#define GLSLIFY 1\n// Varyings\n#include <three_msdf_varyings>\n\n// Uniforms\n#include <three_msdf_common_uniforms>\n#include <three_msdf_strokes_uniforms>\n\nuniform sampler2D uTexture;\nuniform vec2 uResolution;\n\nuniform vec2 uScale;\nuniform vec2 uOffset;\n\nuniform float uLevelMin;\nuniform float uLevel;\nuniform float uLevelMax;\n\nuniform float uContrast;\nuniform float uSaturation;\nuniform float uBrightness;\n\nuniform vec3 uColor1;\nuniform vec3 uColor2;\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 contrastSaturationBrightness(vec3 color, float con, float sat, float brt)\n{\n\t// Increase or decrease theese values to adjust r, g and b color channels seperately\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\treturn conColor;\n}\n\n/*\n** Levels\n** Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\n*/\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 levels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\n// Utils\n#include <three_msdf_median>\n\nvoid main() {\n    // Common\n    #include <three_msdf_common>\n\n    // Strokes\n    #include <three_msdf_strokes>\n\n    // Alpha Test\n    #include <three_msdf_alpha_test>\n\n    // UV\n\tvec2 st = vec2(gl_FragCoord.x / uResolution.x, gl_FragCoord.y / uResolution.y);\n\t// // UV Scale\n\tst.x = (st.x - 0.5) * (1.0 / uScale.x) + 0.5;\n\tst.y = (st.y - 0.5) * (1.0 / uScale.y) + 0.5;\n\t// // UV Offset\n\tst = st + uOffset;\n\n\t// Texture\n\tvec4 texture = texture2D(uTexture, st);\n\t\n\t// Color settings\n\tvec3 colorGradient = mix(uColor1, uColor2, 0.5);\n\ttexture.rgb *= colorGradient;\n\ttexture.rgb = levels(texture.rgb, uLevelMin, uLevel, uLevelMax);\n    texture.rgb = contrastSaturationBrightness(texture.rgb, uContrast, uSaturation, uBrightness);\n\n\t// Output\n\tgl_FragColor = texture;\n\tgl_FragColor.a = uOpacity * alpha;\n\n\t// Debug\n\t// gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"});return e.uniforms.uMap.value=U.a.get("atlas-ogg-text-book"),e.side=m.DoubleSide,e.uniforms.uColor.value.set(this._settings.color),e}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return e.rotation.x=Math.PI,this._textContainer.add(e),e}},{key:"_updateGeometry",value:function(){this._geometry.update({text:this._value,width:this._settings.width,lineHeight:this._settings.lineHeight})}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame;var t=ue.a.map(this._tweenObject.scale.progress,0,1,this._settings.scaleMin,1);this._textContainer.scale.set(t,t,1)}},{key:"onWindowResize",value:function(e){this._dimensions=e,this._applySettings(),this._scaleSettings(),this._resize(),this._material.uniforms.uResolution.value.x=e.innerWidth*e.dpr,this._material.uniforms.uResolution.value.y=e.innerHeight*e.dpr}},{key:"_resize",value:function(){this._updateGeometry();var e=this._geometry.layout.lineHeight*this._geometry.layout.linesTotal-(this._geometry.layout.ascender+this._geometry.layout.descender)/2;this._mesh.position.x=-this._geometry.layout.width/2,this._mesh.position.y=-e/2,this._mesh.position.x+=.01*this._settings.position.x,this._mesh.position.y+=.01*this._settings.position.y;var t=this._dimensions.innerWidth/this._dimensions.innerHeight,n=.001*this._settings.scale,o=n,r=n*t;this.scale.set(o,r,1)}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t=function(){e._material.uniforms.uOpacity.value=e._settings.opacity,e._material.uniforms.uScale.value=e._settings.texture.scale,e._material.uniforms.uOffset.value.x=e._settings.texture.offset.x,e._material.uniforms.uOffset.value.y=e._settings.texture.offset.y,e._material.uniforms.uLevelMin.value=e._settings.texture.levels.min,e._material.uniforms.uLevel.value=e._settings.texture.levels.level,e._material.uniforms.uLevelMax.value=e._settings.texture.levels.max,e._material.uniforms.uContrast.value=e._settings.texture.contrast,e._material.uniforms.uSaturation.value=e._settings.texture.saturation,e._material.uniforms.uBrightness.value=e._settings.texture.brightness,e._material.uniforms.uColor1.value.set(e._settings.texture.color1),e._material.uniforms.uColor2.value.set(e._settings.texture.color2),e._updateGeometry(),e._resize()},n=this._debug.addFolder({title:"Text preloader",extanded:!1});n.addInput(this._settings,"opacity",{min:0,max:1}).on("change",t),n.addInput(this._settings,"scale").on("change",t),n.addInput(this._settings,"width").on("change",t),n.addInput(this._settings,"lineHeight").on("change",t),n.addInput(this._settings,"position").on("change",t);var o=n.addFolder({title:"Texture"});o.addInput(this._settings.texture,"scale",{label:"Scale",x:{min:-2,max:2},y:{min:-2,max:2}}).on("change",t),o.addInput(this._settings.texture,"offset",{label:"Offset",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",t);var r=o.addTab({pages:[{title:"Levels"},{title:"Settings"},{title:"Colors"}]});return r.pages[0].addInput(this._settings.texture.levels,"min",{label:"Min"}).on("change",t),r.pages[0].addInput(this._settings.texture.levels,"level",{label:"Level"}).on("change",t),r.pages[0].addInput(this._settings.texture.levels,"max",{label:"Max"}).on("change",t),r.pages[1].addInput(this._settings.texture,"contrast",{label:"Contrast"}).on("change",t),r.pages[1].addInput(this._settings.texture,"saturation",{label:"Saturation"}).on("change",t),r.pages[1].addInput(this._settings.texture,"brightness",{label:"Brightness"}).on("change",t),r.pages[2].addInput(this._settings.texture,"color1",{label:"Color"}).on("change",t),r.pages[2].addInput(this._settings.texture,"color2",{label:"Color"}).on("change",t),n}}}]),n}(component(m.Object3D));function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var ve=function(e){Object(x.a)(n,e);var t=fe(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._globalSettings=e.settings,this._texture=e.texture,this._settings=null,this._applySettings(),this._geometry=this._createGeometry(),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"material",get:function(){return this._material}},{key:"playIntroLoadingAnimation",value:function(){var e=new d.b.timeline;return e.set(this,{visible:!0}),e.set(this._material.uniforms.uLayerScaleProgress0,{value:this._settings.scaleMin},0),e.set(this._material.uniforms.uLayerScaleProgress1,{value:this._settings.scaleMin},0),e.set(this._material.uniforms.uLayerScaleProgress2,{value:this._settings.scaleMin},0),e}},{key:"playLoadingAnimationComplete",value:function(){var e=.15,t=new d.b.timeline;return t.to(this._material.uniforms.uLayerScaleProgress2,{value:this._settings.scaleMax,duration:1,ease:"power4.in"},.15),t.to(this._material.uniforms.uLayerScaleProgress1,{value:this._settings.scaleMax,duration:1,ease:"power4.in"},.3),t.to(this._material.uniforms.uLayerScaleProgress0,{value:this._settings.scaleMax,duration:1,ease:"power4.in"},3*e),t.set(this,{visible:!1}),t}},{key:"skipLoadingAnimation",value:function(){this._material.uniforms.uLayerScaleProgress2.value=1.2,this._material.uniforms.uLayerScaleProgress1.value=1.2,this._material.uniforms.uLayerScaleProgress0.value=1.2,this.visible=!1}},{key:"_applySettings",value:function(){"large"===W.a.current&&(this._settings=this._globalSettings.large.layers),"medium"===W.a.current&&(this._settings=ae(this._globalSettings.large.layers,this._globalSettings.medium.layers)),"small"===W.a.current&&(this._settings=ae(this._globalSettings.large.layers,this._globalSettings.small.layers)),"large"===W.a.current&&(this._skySettings=this._globalSettings.large.sky),"medium"===W.a.current&&(this._skySettings=ae(this._globalSettings.large.sky,this._globalSettings.medium.sky)),"small"===W.a.current&&(this._skySettings=ae(this._globalSettings.large.sky,this._globalSettings.small.sky))}},{key:"_createGeometry",value:function(){return new m.PlaneGeometry(1,1)}},{key:"_createMaterial",value:function(){return new m.ShaderMaterial({transparent:!0,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uMap;\nuniform vec2 uResolution;\n\n//// Shape\nuniform sampler2D uShape;\nuniform vec2 uShapeSize;\n\n//// Layers\nuniform float uLayerScaleProgress0;\nuniform float uLayerScaleProgress1;\nuniform float uLayerScaleProgress2;\nuniform vec2 uLayerScale0;\nuniform vec2 uLayerScale1;\nuniform vec2 uLayerScale2;\nuniform vec2 uLayerOffset0;\nuniform vec2 uLayerOffset1;\nuniform vec2 uLayerOffset2;\n\n//// Postprocessing\nuniform float uLevelMin;\nuniform float uLevel;\nuniform float uLevelMax;\n\nuniform float uContrast;\nuniform float uSaturation;\nuniform float uBrightness;\n\nuniform vec3 uColor1;\nuniform vec3 uColor2;\n\nvec2 scaleUv(vec2 uv, float scale)\n{\n  return (uv - 0.5) * (1.0 / scale) + 0.5;\n}\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 contrastSaturationBrightness(vec3 color, float con, float sat, float brt)\n{\n\t// Increase or decrease theese values to adjust r, g and b color channels seperately\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\treturn conColor;\n}\n\n/*\n** Levels\n** Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\n*/\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 levels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\n\nfloat msdfAlpha(sampler2D msdfSample, vec2 uv) {\n\tvec3 s = texture2D(msdfSample, uv).rgb;\n\tfloat sigDist = median(s.r, s.g, s.b) - 0.5;\n\tfloat afwidth = 1.4142135623730951 / 2.0;\n\tfloat mask = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n\treturn mask;\n}\n\nvoid main() {\n\t// Render Target texture\n    vec4 texel = texture2D(uMap, vUv);\n\ttexel.a = 0.0;\n\n\t// Shape\n\n\t//// Correct aspect ratio\n\tfloat shapeAspect = uShapeSize.x / uShapeSize.y;\n\tfloat screenAspect = uResolution.x / uResolution.y;\n\n\tvec2 shapeUv = vUv;\n\tshapeUv.x = (shapeUv.x - 0.5) * (1.0 / (shapeAspect / screenAspect)) + 0.5;\n\n\t//// Scale animations\n\tfloat maxScale = uResolution.x / uShapeSize.x;\n\n\tif (uResolution.x / uResolution.y <= 0.7) {\n\t\tmaxScale = uResolution.y / uShapeSize.y;\n\t}\n\n\t// Layers\n\n\t//// Layer 0\n\tvec2 layerShapeUv0 = shapeUv;\n\tlayerShapeUv0 = scaleUv(layerShapeUv0, maxScale * uLayerScaleProgress0);\n\tfloat layer0 = msdfAlpha(uShape, layerShapeUv0);\n\tvec2 layerUv0 = vUv;\n\tlayerUv0.x = (layerUv0.x - 0.5) * (1.0 / uLayerScale0.x) + 0.5;\n\tlayerUv0.y = (layerUv0.y - 0.5) * (1.0 / uLayerScale0.y) + 0.5;\n\tlayerUv0.x += uLayerOffset0.x;\n\tlayerUv0.y += uLayerOffset0.y;\n\tvec4 layerSample0 = texture2D(uMap, layerUv0);\n\n\t//// Layer 1\n\tvec2 layerShapeUv1 = shapeUv;\n\tlayerShapeUv1 = scaleUv(layerShapeUv1, maxScale * uLayerScaleProgress1);\n\tfloat layer1 = msdfAlpha(uShape, layerShapeUv1);\n\tvec2 layerUv1 = vUv;\n\tlayerUv1.x = (layerUv1.x - 0.5) * (1.0 / uLayerScale1.x) + 0.5;\n\tlayerUv1.y = (layerUv1.y - 0.5) * (1.0 / uLayerScale1.y) + 0.5;\n\tlayerUv1.x += uLayerOffset1.x;\n\tlayerUv1.y += uLayerOffset1.y;\n\tvec4 layerSample1 = texture2D(uMap, layerUv1);\n\n\t//// Layer 2\n\tvec2 layerShapeUv2 = shapeUv;\n\tlayerShapeUv2 = scaleUv(layerShapeUv2, maxScale * uLayerScaleProgress2);\n\tfloat layer2 = msdfAlpha(uShape, layerShapeUv2);\n\tvec2 layerUv2 = vUv;\n\tlayerUv2.x = (layerUv2.x - 0.5) * (1.0 / uLayerScale2.x) + 0.5;\n\tlayerUv2.y = (layerUv2.y - 0.5) * (1.0 / uLayerScale2.y) + 0.5;\n\tlayerUv2.x += uLayerOffset2.x;\n\tlayerUv2.y += uLayerOffset2.y;\n\tvec4 layerSample2 = texture2D(uMap, layerUv2);\n\n\t// Output\n\ttexel = mix(layerSample0, texel, layer0);\n\ttexel = mix(layerSample1, texel, layer1);\n\ttexel = mix(layerSample2, texel, layer2);\n\n\t// Postprocessing\n\tvec3 colorGradient = mix(uColor1, uColor2, 0.5);\n\ttexel.rgb = texel.rgb * colorGradient;\n\ttexel.rgb = levels(texel.rgb, uLevelMin, uLevel, uLevelMax);\n    texel.rgb = contrastSaturationBrightness(texel.rgb, uContrast, uSaturation, uBrightness);\n\n\tgl_FragColor = texel;\n}",uniforms:{uMap:{value:this._texture},uResolution:{value:new m.Vector2},uShape:{value:U.a.get("shape-intro")},uShapeSize:{value:new m.Vector2(U.a.get("shape-intro").image.width,U.a.get("shape-intro").image.height)},uLayerScaleProgress0:{value:this._settings.scaleProgress0},uLayerScaleProgress1:{value:this._settings.scaleProgress1},uLayerScaleProgress2:{value:this._settings.scaleProgress2},uLayerScale0:{value:this._settings.scale0},uLayerScale1:{value:this._settings.scale1},uLayerScale2:{value:this._settings.scale2},uLayerOffset0:{value:this._settings.offset0},uLayerOffset1:{value:this._settings.offset1},uLayerOffset2:{value:this._settings.offset2},uLevelMin:{value:this._skySettings.levels.min},uLevel:{value:this._skySettings.levels.level},uLevelMax:{value:this._skySettings.levels.max},uContrast:{value:this._skySettings.contrast},uSaturation:{value:this._skySettings.saturation},uBrightness:{value:this._skySettings.brightness},uColor1:{value:new m.Color(this._skySettings.color1)},uColor2:{value:new m.Color(this._skySettings.color2)}},extensions:{derivatives:!0}})}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return this.add(e),e}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){this._material.uniforms.uResolution.value.x=e.innerWidth,this._material.uniforms.uResolution.value.y=e.innerHeight,this._applySettings()}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){for(var t=function(){e._material.uniforms.uLayerScaleProgress0.value=e._settings.scaleProgress0,e._material.uniforms.uLayerScaleProgress1.value=e._settings.scaleProgress1,e._material.uniforms.uLayerScaleProgress2.value=e._settings.scaleProgress2,e._material.uniforms.uLayerScale0.value=e._settings.scale0,e._material.uniforms.uLayerScale1.value=e._settings.scale1,e._material.uniforms.uLayerScale2.value=e._settings.scale2,e._material.uniforms.uLayerOffset0.value=e._settings.offset0,e._material.uniforms.uLayerOffset1.value=e._settings.offset1,e._material.uniforms.uLayerOffset2.value=e._settings.offset2},n=this._debug.addFolder({title:"Layers"}),o=n.addTab({pages:[{title:"Layer 0"},{title:"Layer 1"},{title:"Layer 2"}]}),i=0;i<o.pages.length;i++)o.pages[i].addInput(this._settings,"scaleProgress".concat(i),{min:0,max:1}).on("change",t),o.pages[i].addInput(this._settings,"scale".concat(i),{x:{min:-2,max:2},y:{min:-2,max:2}}).on("change",t),o.pages[i].addInput(this._settings,"offset".concat(i),{x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",t);return n}}}]),n}(component(m.Object3D));function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var ge=function(e){Object(x.a)(n,e);var t=pe(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){this.name=se.name,this._config=se,this._settings=null,this._applySettings(),this._scaleSettings(),this._debugFolder=this._createDebugFolder(),this._camera=this._createCamera(),this._renderTargetFinal=this._createRenderTargetFinal(),this._renderTargetSky=this._createRenderTargetSky(),this._renderTargetFacade=this._createRenderTargetFacade(),this._sceneFinal=this._createSceneFinal(),this._sceneSky=this._createSceneSky(),this._sceneFacade=this._createSceneFacade(),this._materialFinal=this._createMaterialFinal(),this._materialSky=this._createMaterialSky(),this._materialFacade=this._createMaterialFacade(),this._layerFinal=this._createLayerFinal(),this._layerSky=this._createLayerSky(),this._layerFacade=this._createLayerFacade(),this._textPreloader=this._createTextPreloader(),this._skyLayersPreloader=this._createSkyLayersPreloader()}},{key:"destroy",value:function(){var e,t,o;Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._sceneSky.destroy(),this._sceneFacade.destroy(),this._renderTargetFinal.dispose(),this._renderTargetSky.dispose(),this._renderTargetFacade.dispose(),this._materialFinal.dispose(),this._materialSky.dispose(),this._materialFacade.dispose(),this._layerFinal.destroy(),this._layerSky.destroy(),this._layerFacade.destroy(),this._textPreloader.destroy(),null===(e=this._timelineLoading)||void 0===e||e.kill(),null===(t=this._timelineLoadingAnimationComplete)||void 0===t||t.kill(),null===(o=this._timelineHideLoading)||void 0===o||o.kill()}},{key:"config",get:function(){return this._config}},{key:"camera",get:function(){return this._camera}},{key:"textPreloader",get:function(){return this._textPreloader}},{key:"sceneFacade",get:function(){return this._sceneFacade}},{key:"sceneSky",get:function(){return this._sceneSky}},{key:"initialize",value:function(e){"critical"===e&&this._sceneSky.initialize(),"default"===e&&this._sceneFacade.initialize()}},{key:"render",value:function(e){e.setRenderTarget(this._renderTargetSky),e.render(this._sceneSky,this._sceneSky.camera),this._sceneFacade.renderGround(e),e.setRenderTarget(this._renderTargetFacade),this._sceneFacade.render(e),e.setRenderTarget(this._renderTargetFinal),e.render(this._sceneFinal,this._sceneFinal.camera),e.setRenderTarget(null),e.render(this,this._camera)}},{key:"compile",value:function(e,t){"critical"===t&&this._sceneSky.compile(e),e.compile(this,this._camera)}},{key:"skipLoadingAnimation",value:function(){this._materialFinal.uniforms.uMaskScaleProgress.value=this._settings.mask.scaleMax,this._textPreloader.skipLoadingAnimation(),this._skyLayersPreloader.skipLoadingAnimation()}},{key:"playIntroLoadingAnimation",value:function(){var e;return null===(e=this._timelineLoading)||void 0===e||e.kill(),this._timelineLoading=new d.b.timeline,this._timelineLoading.fromTo(this._materialFinal.uniforms.uMaskScaleProgress,{value:0},{duration:1,value:this._settings.mask.scaleMin,ease:"power3.inOut"},0),this._timelineLoading.add(this._skyLayersPreloader.playIntroLoadingAnimation(),0),this._timelineLoading.add(this._textPreloader.playIntroLoadingAnimation(),0),this._timelineLoading}},{key:"playLoadingAnimationComplete",value:function(){var e;return null===(e=this._timelineLoading)||void 0===e||e.kill(),this._timelineLoadingAnimationComplete=new d.b.timeline,this._timelineLoadingAnimationComplete.to(this._materialFinal.uniforms.uMaskScaleProgress,{duration:1,value:this._settings.mask.scaleMax,ease:"power4.in"},0),this._timelineLoadingAnimationComplete.add(this._skyLayersPreloader.playLoadingAnimationComplete(),0),this._timelineLoadingAnimationComplete.add(this._textPreloader.playLoadingAnimationComplete(),0),this._timelineLoadingAnimationComplete}},{key:"hideLoadingProgress",value:function(){var e;return null===(e=this._timelineLoadingAnimationComplete)||void 0===e||e.kill(),this._timelineHideLoading=new d.b.timeline,this._timelineHideLoading.add(this._textPreloader.hide(),0),this._timelineHideLoading}},{key:"noFocus",value:function(){var e=new d.b.timeline;return e.to(this._materialFinal.uniforms.uVignetteIntensity,{duration:1.5,value:this._settings.vignette.intensityMin,ease:"sine.inOut"},0),e.to(this._materialFinal.uniforms.uVignetteAlpha,{duration:1.5,value:this._settings.vignette.alphaMin,ease:"sine.inOut"},0),e}},{key:"smallFocus",value:function(){var e=new d.b.timeline;return e.to(this._materialFinal.uniforms.uVignetteIntensity,{duration:1.5,value:this._settings.vignette.intensityMiddle,ease:"sine.inOut"},0),e.to(this._materialFinal.uniforms.uVignetteAlpha,{duration:1.5,value:this._settings.vignette.alphaMax,ease:"sine.inOut"},0),e}},{key:"fullFocus",value:function(){var e=new d.b.timeline;return e.to(this._materialFinal.uniforms.uVignetteIntensity,{duration:1.5,value:this._settings.vignette.intensityMax,ease:"sine.inOut"},0),e.to(this._materialFinal.uniforms.uVignetteAlpha,{duration:1.5,value:this._settings.vignette.alphaMax,ease:"sine.inOut"},0),e}},{key:"_applySettings",value:function(){"large"===W.a.current&&(this._settings=this._config.settings.large),"medium"===W.a.current&&(this._settings=ae(this._config.settings.large,this._config.settings.medium)),"small"===W.a.current&&(this._settings=ae(this._config.settings.large,this._config.settings.small))}},{key:"_scaleSettings",value:function(){}},{key:"_createCamera",value:function(){var e=new m.OrthographicCamera(-.5,.5,.5,-.5,1,1e3);return e.position.z=1,e}},{key:"_createRenderTargetFinal",value:function(){return new m.WebGLRenderTarget(0,0,{samples:1})}},{key:"_createRenderTargetSky",value:function(){return new m.WebGLRenderTarget(0,0,{samples:1})}},{key:"_createRenderTargetFacade",value:function(){return new m.WebGLRenderTarget(0,0,{samples:1})}},{key:"_createSceneFinal",value:function(){var e=new m.Scene;return e.camera=new m.OrthographicCamera(-.5,.5,.5,-.5,1,1e3),e.camera.position.z=1,e}},{key:"_createSceneSky",value:function(){return new Ot.Sky({debugFolder:this._debugFolder})}},{key:"_createSceneFacade",value:function(){return new Ot.Facade({debugFolder:this._debugFolder})}},{key:"_createMaterialFinal",value:function(){return new m.ShaderMaterial({depthTest:!1,depthWrite:!1,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uMap;\nuniform vec2 uResolution;\nuniform vec3 uBackgroundColor;\n\n//// Shape\nuniform sampler2D uShape;\nuniform vec2 uShapeSize;\n\n//// Mask\nuniform float uMaskScaleProgress;\n\n//// Vignette\nuniform float uVignetteUvScale;\nuniform float uVignetteAlpha;\nuniform float uVignetteScale;\nuniform float uVignetteIntensity;\n\nvec2 scaleUv(vec2 uv, float scale)\n{\n  return (uv - 0.5) * (1.0 / scale) + 0.5;\n}\n\nfloat vignette(vec2 uv, float intensity, float scale, float alpha) {\n    vec2 vigUv = uv; \n    vigUv *=  1.0 - vigUv.yx;\n    float vig = vigUv.x * vigUv.y * intensity; // multiply with sth for intensity\n    vig = pow(vig, scale * alpha); // change pow for modifying the extend of the vignette   \n\treturn clamp(vig, 0.0, 1.0);\n}\n\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\n\nfloat msdfAlpha(sampler2D msdfSample, vec2 uv) {\n\tvec3 s = texture2D(msdfSample, uv).rgb;\n\tfloat sigDist = median(s.r, s.g, s.b) - 0.5;\n\tfloat afwidth = 1.4142135623730951 / 2.0;\n\tfloat mask = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n\treturn mask;\n}\n\nvoid main() {\n\t// Render Target texture\n    vec4 texel = texture2D(uMap, vUv);\n\n\t// Shape\n\n\t//// Correct aspect ratio\n\tfloat shapeAspect = uShapeSize.x / uShapeSize.y;\n\tfloat screenAspect = uResolution.x / uResolution.y;\n\n\tvec2 shapeUv = vUv;\n\tshapeUv.x = (shapeUv.x - 0.5) * (1.0 / (shapeAspect / screenAspect)) + 0.5;\n\n\t//// Scale animations\n\tfloat maxScale = uResolution.x / uShapeSize.x;\n\n\tif (uResolution.x / uResolution.y <= 0.7) {\n\t\tmaxScale = uResolution.y / uShapeSize.y;\n\t}\n\n\t// Mask\n\tfloat maskScale = maxScale * uMaskScaleProgress;\n\tvec2 maskUv = shapeUv;\n\tmaskUv = scaleUv(maskUv, maskScale);\n\n\t//// Output mask value\n\tfloat mask = msdfAlpha(uShape, maskUv);\n\n\t// Output\n\tvec3 outputColor = mix(uBackgroundColor, texel.rgb, mask * smoothstep(maskScale, 0.0, 0.05));\n\n\t#ifdef USE_VIGNETTE\n\t\tvec2 vignetteUV = scaleUv(vUv, uVignetteUvScale);\n\t\toutputColor *= vignette(vignetteUV, uVignetteScale, uVignetteIntensity, uVignetteAlpha);\n\t#endif\n\n\tgl_FragColor = vec4(outputColor, 1.0);\n}",uniforms:{uMap:{value:this._renderTargetFinal.texture},uResolution:{value:new m.Vector2},uBackgroundColor:{value:new m.Color(this._settings.backgroundColor)},uShape:{value:U.a.get("shape-intro")},uShapeSize:{value:new m.Vector2(U.a.get("shape-intro").image.width,U.a.get("shape-intro").image.height)},uMaskScaleProgress:{value:this._settings.mask.scaleProgress},uVignetteUvScale:{value:this._settings.vignette.uvScale},uVignetteScale:{value:this._settings.vignette.scale},uVignetteIntensity:{value:this._settings.vignette.intensity},uVignetteAlpha:{value:this._settings.vignette.alpha}},defines:{USE_VIGNETTE:!0},extensions:{derivatives:!0}})}},{key:"_createMaterialSky",value:function(){return new m.ShaderMaterial({depthTest:!1,depthWrite:!1,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uMap;\n\nuniform float uLevelMin;\nuniform float uLevel;\nuniform float uLevelMax;\n\nuniform float uContrast;\nuniform float uSaturation;\nuniform float uBrightness;\n\nuniform vec3 uColor1;\nuniform vec3 uColor2;\n\n/*\n** Contrast, saturation, brightness\n** Code of this function is from TGM's shader pack\n** http://irrlicht.sourceforge.net/phpBB2/viewtopic.php?t=21057\n*/\n\n// For all settings: 1.0 = 100% 0.5=50% 1.5 = 150%\nvec3 contrastSaturationBrightness(vec3 color, float con, float sat, float brt)\n{\n\t// Increase or decrease theese values to adjust r, g and b color channels seperately\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\treturn conColor;\n}\n\n/*\n** Levels\n** Source: https://gist.github.com/aferriss/9be46b6350a08148da02559278daa244\n*/\nvec3 gammaCorrect(vec3 color, float gamma){\n    return pow(color, vec3(1.0/gamma));\n}\n\nvec3 levelRange(vec3 color, float minInput, float maxInput){\n    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));\n}\n\nvec3 levels(vec3 color, float minInput, float gamma, float maxInput){\n    return gammaCorrect(levelRange(color, minInput, maxInput), gamma);\n}\n\nvoid main() {\n\t// Render Target texture\n\tvec4 texel = texture2D(uMap, vUv);\n\n\t// Main Color\n\tvec3 colorGradient = mix(uColor1, uColor2, 0.5);\n\tvec3 color = texel.rgb * colorGradient;\n\tcolor = levels(color, uLevelMin, uLevel, uLevelMax);\n    color = contrastSaturationBrightness(color, uContrast, uSaturation, uBrightness);\n\n\t// Output\n\tgl_FragColor = vec4(color, 1.0);\n}",uniforms:{uMap:{value:this._renderTargetSky.texture},uLevelMin:{value:this._settings.sky.levels.min},uLevel:{value:this._settings.sky.levels.level},uLevelMax:{value:this._settings.sky.levels.max},uContrast:{value:this._settings.sky.contrast},uSaturation:{value:this._settings.sky.saturation},uBrightness:{value:this._settings.sky.brightness},uColor1:{value:new m.Color(this._settings.sky.color1)},uColor2:{value:new m.Color(this._settings.sky.color2)}}})}},{key:"_createMaterialFacade",value:function(){return new m.ShaderMaterial({depthTest:!1,depthWrite:!1,transparent:!0,blending:m.CustomBlending,blendSrc:m.OneFactor,blendDst:m.OneMinusSrcAlphaFactor,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform sampler2D uMap;\n\nvoid main() {\n\tgl_FragColor = texture2D(uMap, vUv);\n}",uniforms:{uMap:{value:this._renderTargetFacade.texture}}})}},{key:"_createLayerFinal",value:function(){var e=new re({material:this._materialFinal});return this.add(e),e}},{key:"_createLayerSky",value:function(){var e=new re({material:this._materialSky});return this._sceneFinal.add(e),e}},{key:"_createLayerFacade",value:function(){var e=new re({material:this._materialFacade});return this._sceneFinal.add(e),e}},{key:"_createTextPreloader",value:function(){var text=new me({debugFolder:this._debugFolder,value:"00",settings:this._config.settings,texture:this._renderTargetSky.texture});return this._sceneFinal.add(text),text}},{key:"_createSkyLayersPreloader",value:function(){var e=new ve({debugFolder:this._debugFolder,settings:this._config.settings,texture:this._renderTargetSky.texture});return this._sceneFinal.add(e),e}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){this._applySettings(),this._resizeRenderTargets(e),this._resizeMaterials(e)}},{key:"_resizeRenderTargets",value:function(e){this._renderTargetSky.setSize(e.innerWidth*e.dpr,e.innerHeight*e.dpr),this._renderTargetFacade.setSize(e.innerWidth*e.dpr,e.innerHeight*e.dpr),this._renderTargetFinal.setSize(e.innerWidth*e.dpr,e.innerHeight*e.dpr)}},{key:"_resizeMaterials",value:function(e){this._materialFinal.uniforms.uResolution.value.x=e.innerWidth,this._materialFinal.uniforms.uResolution.value.y=e.innerHeight}},{key:"_createDebugFolder",value:function(){var e=this;if(this.$debugger){var t=function(){e._materialSky.uniforms.uLevelMin.value=e._settings.sky.levels.min,e._skyLayersPreloader.material.uniforms.uLevelMin.value=e._settings.sky.levels.min,e._materialSky.uniforms.uLevel.value=e._settings.sky.levels.level,e._skyLayersPreloader.material.uniforms.uLevel.value=e._settings.sky.levels.level,e._materialSky.uniforms.uLevelMax.value=e._settings.sky.levels.max,e._skyLayersPreloader.material.uniforms.uLevelMax.value=e._settings.sky.levels.max,e._materialSky.uniforms.uContrast.value=e._settings.sky.contrast,e._skyLayersPreloader.material.uniforms.uContrast.value=e._settings.sky.contrast,e._materialSky.uniforms.uSaturation.value=e._settings.sky.saturation,e._skyLayersPreloader.material.uniforms.uSaturation.value=e._settings.sky.saturation,e._materialSky.uniforms.uBrightness.value=e._settings.sky.brightness,e._skyLayersPreloader.material.uniforms.uBrightness.value=e._settings.sky.brightness,e._materialSky.uniforms.uColor1.value.set(e._settings.sky.color1),e._skyLayersPreloader.material.uniforms.uColor1.value.set(e._settings.sky.color1),e._materialSky.uniforms.uColor2.value.set(e._settings.sky.color2),e._skyLayersPreloader.material.uniforms.uColor2.value.set(e._settings.sky.color2),e._materialFinal.uniforms.uVignetteAlpha.value=e._settings.vignette.alpha,e._materialFinal.uniforms.uVignetteIntensity.value=e._settings.vignette.intensity,e._materialFinal.uniforms.uVignetteScale.value=e._settings.vignette.scale,e._materialFinal.uniforms.uVignetteUvScale.value=e._settings.vignette.uvScale},n=this.$debugger.addFolder({title:"Scene ".concat(se.name),expanded:!1});n.addButton({title:"Intro Loading"}).on("click",(function(){e.playIntroLoadingAnimation()})),n.addButton({title:"Loading Complete"}).on("click",(function(){e.playLoadingAnimationComplete()})),n.addFolder({title:"Mask",expanded:!1}).addInput(this._settings.mask,"scaleProgress",{min:0,max:1}).on("change",(function(){e._materialFinal.uniforms.uMaskScaleProgress.value=e._settings.mask.scaleProgress}));var o=n.addFolder({title:"Postprocessing",expanded:!1}),r=o.addTab({pages:[{title:"Levels"},{title:"Settings"},{title:"Colors"}]});r.pages[0].addInput(this._settings.sky.levels,"min",{title:"Min"}).on("change",t),r.pages[0].addInput(this._settings.sky.levels,"level",{title:"Level"}).on("change",t),r.pages[0].addInput(this._settings.sky.levels,"max",{title:"Max"}).on("change",t),r.pages[1].addInput(this._settings.sky,"contrast",{title:"Contrast"}).on("change",t),r.pages[1].addInput(this._settings.sky,"saturation",{title:"Level"}).on("change",t),r.pages[1].addInput(this._settings.sky,"brightness",{title:"Brightness"}).on("change",t),r.pages[2].addInput(this._settings.sky,"color1",{title:"Color"}).on("change",t),r.pages[2].addInput(this._settings.sky,"color2",{title:"Color"}).on("change",t);var l=o.addFolder({title:"Vignette",expanded:!1});return l.addInput(this._settings.vignette,"enabled",{label:"Enabled"}).on("change",(function(){e._materialFinal.defines.USE_VIGNETTE=e._settings.vignette.enabled,e._materialFinal.needsUpdate=!0})),l.addInput(this._settings.vignette,"intensity",{label:"Intensity",min:0,max:1}).on("change",t),l.addInput(this._settings.vignette,"alpha",{label:"alpha",min:0,max:1}).on("change",t),l.addInput(this._settings.vignette,"scale",{label:"Scale"}).on("change",t),l.addInput(this._settings.vignette,"uvScale",{label:"UV Scale"}).on("change",t),n}}}]),n}(component(m.Scene)),_e={name:"Sky",resources:[]};n(204);function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var be=function(e){Object(x.a)(n,e);var t=ye(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._settings=e.settings,this._options={speed:this._settings.speed},this._geometry=this._createGeometry(),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"playTimelapseAnimation",value:function(){var e=new d.a.timeline;e.to(this._options,{speed:8e-4,duration:1,ease:"power3.in"},0),e.to(this._options,{speed:this._settings.speed,duration:1,ease:"power3.out"},7.5)}},{key:"skipAnimation",value:function(){}},{key:"settings",get:function(){return this._settings},set:function(e){this._settings=e}},{key:"_createGeometry",value:function(){return new m.PlaneGeometry(1,1,1)}},{key:"_createMaterial",value:function(){var e=this._settings.textureCloud,t=this._settings.textureNoise,n=this._settings.textureBlend;return new m.ShaderMaterial({vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\nvarying float vFogDepth;\n\nuniform float uTime;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4(position.xyz, 1.);\n    \n    vFogDepth = -mvPosition.z;\n\n    gl_Position = projectionMatrix* modelViewMatrix * vec4(position.xyz, 1.0);\n\n    vUv = uv;\n}",fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;\nvarying float vFogDepth;\n\nuniform sampler2D uBaseTexture;\nuniform vec2 uBaseRepeat;\n\nuniform sampler2D uNoiseTexture;\nuniform float uNoiseScale;\n\nuniform sampler2D uBlendTexture;\nuniform float uBlendScale;\n\nuniform float uBlendSpeed;\n\nuniform float uTime;\nuniform float uAlpha;\nuniform float uAlphaFade;\nuniform vec2 uMixOffset;\nuniform vec2 uFadeRange;\n\nvoid main(){\n    vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * uTime;\n    vec2 uvTimeShift2 = vUv + vec2( 1.3, -1.7 ) * uTime * uBlendSpeed;\n    \n    vec4 noiseTex = texture2D( uNoiseTexture, uvTimeShift );\n    vec2 uvNoiseTimeShift = vUv + uNoiseScale * vec2( noiseTex.r * 10., noiseTex.b * 10.);\n\n    vec4 baseColor = texture2D( uBaseTexture, uvNoiseTimeShift * vec2(uBaseRepeat.x, uBaseRepeat.y) );\n\n    vec4 noiseTex2 = texture2D( uNoiseTexture, uvTimeShift2 );\n\n    vec4 blendTex = texture2D( uBlendTexture, vec2(fract(vUv.x * uBlendScale) * sin(uBlendSpeed)* uMixOffset.x , (1.0 - fract(vUv.y * uBlendScale)) * cos(uBlendSpeed))* uMixOffset.y);\n    float smoothOpacity = smoothstep((vFogDepth * uFadeRange.x),(vFogDepth * uFadeRange.y), uAlphaFade * 15.);\n\n    gl_FragColor = vec4(vec3(baseColor.rgb * blendTex.rgb), smoothOpacity * baseColor.a * noiseTex2.r * uAlpha);\n}",side:m.DoubleSide,transparent:!0,depthWrite:!1,uniforms:{uBaseTexture:{value:e},uBaseRepeat:{value:this._settings.repeat},uFadeRange:{value:this._settings.fadeRange},uNoiseTexture:{value:t},uBlendTexture:{value:n},uNoiseScale:{value:this._settings.noiseScale},uBlendScale:{value:this._settings.blendScale},uBlendSpeed:{value:this._settings.blendSpeed},uAlphaFade:{value:this._settings.alphaFade},uMixOffset:{value:this._settings.mixOffset},uAlpha:{value:this._settings.globalAlpha},uTime:{value:1}}})}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return e.visible=this._settings.isVisible,e.scale.set(this._settings.scale.x,this._settings.scale.y,this._settings.scale.z),e.position.set(this._settings.position.x,this._settings.position.y,this._settings.position.z),e.rotation.set(this._settings.rotation.x,this._settings.rotation.y,this._settings.rotation.z),e.frustumCulled=!1,this.add(e),e}},{key:"onUpdate",value:function(e){e.time;var t=e.deltaTime;e.frame;this._material.uniforms.uTime.value+=this._options.speed*t/16}},{key:"onWindowResize",value:function(e){}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t=function(){e._mesh.visible=e._settings.isVisible,e._mesh.scale.set(e._settings.scale.x,e._settings.scale.y,e._settings.scale.z),e._mesh.position.set(e._settings.position.x,e._settings.position.y,e._settings.position.z),e._mesh.rotation.set(e._settings.rotation.x,e._settings.rotation.y,e._settings.rotation.z),e._material.uniforms.uBaseRepeat.value.set(e._settings.repeat.x,e._settings.repeat.y),e._material.uniforms.uFadeRange.value.set(e._settings.fadeRange.x,e._settings.fadeRange.y),e._material.uniforms.uNoiseScale.value=e._settings.noiseScale,e._material.uniforms.uBlendSpeed.value=e._settings.blendSpeed,e._material.uniforms.uBlendScale.value=e._settings.blendScale,e._material.uniforms.uAlphaFade.value=e._settings.alphaFade,e._material.uniforms.uMixOffset.value.set(e._settings.mixOffset.x,e._settings.mixOffset.y),e._material.uniforms.uAlpha.value=e._settings.globalAlpha},n=this._debug.addFolder({title:"Clouds ".concat(this._settings.name),expanded:!1}),o=n.addTab({pages:[{title:"Global"},{title:"Noise"},{title:"Alpha"},{title:"Blend"}]});return o.pages[0].addInput(this._settings,"isVisible",{label:"Visible"}).on("change",t),o.pages[0].addInput(this._settings,"position",{label:"Position"}).on("change",t),o.pages[0].addInput(this._settings,"rotation",{label:"Rotation"}).on("change",t),o.pages[0].addInput(this._settings,"scale",{label:"Scale"}).on("change",t),o.pages[0].addInput(this._settings,"speed",{label:"Speed"}).on("change",t),o.pages[0].addInput(this._settings,"globalAlpha",{label:"Alpha"}).on("change",t),o.pages[0].addInput(this._settings,"repeat",{label:"Repeat"}).on("change",t),o.pages[0].addInput(this._settings.textureCloud,"image",{label:"Texture",view:"image",height:100,showMonitor:!0}).on("change",(function(t){var n=t.value;e._material.uniforms.uBaseTexture.value=(new m.TextureLoader).load(n.src),e._material.uniforms.uBaseTexture.value.wrapS=e._material.uniforms.uBaseTexture.value.wrapT=m.RepeatWrapping})),o.pages[1].addInput(this._settings,"noiseScale",{label:"Noise Scale"}).on("change",t),o.pages[1].addInput(this._settings.textureNoise,"image",{label:"Texture",view:"image",height:100,showMonitor:!0}).on("change",(function(t){var n=t.value;e._material.uniforms.uNoiseTexture.value=(new m.TextureLoader).load(n.src),e._material.uniforms.uNoiseTexture.value.wrapS=e._material.uniforms.uNoiseTexture.value.wrapT=m.RepeatWrapping})),o.pages[2].addInput(this._settings,"alphaFade",{label:"Alpha fade"}).on("change",t),o.pages[2].addInput(this._settings,"fadeRange",{label:"Fade range"}).on("change",t),o.pages[3].addInput(this._settings,"blendScale",{label:"Blend Scale"}).on("change",t),o.pages[3].addInput(this._settings,"blendSpeed",{label:"Blend Speed"}).on("change",t),o.pages[3].addInput(this._settings,"mixOffset",{label:"Mix Offset"}).on("change",t),o.pages[3].addInput(this._settings.textureBlend,"image",{label:"Texture",view:"image",height:100,showMonitor:!0}).on("change",(function(t){var n=t.value;e._material.uniforms.uBlendTexture.value=(new m.TextureLoader).load(n.src)})),n}}}]),n}(component(m.Object3D));function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var we=function(e){Object(x.a)(n,e);var t=xe(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debugger=e.debugFolder||this.$debugger,this._isReady=!1,this._config=_e,this._settings={background:z.ResourceLoader.get("sky-background"),clouds1:{name:"Clouds 1",isVisible:!0,textureCloud:z.ResourceLoader.get("sky-cloud"),textureNoise:z.ResourceLoader.get("cloud-noise"),textureBlend:z.ResourceLoader.get("sky-blending"),position:new m.Vector3(1.1,8.3,-17),rotation:new m.Vector3(1.41,0,0),scale:new m.Vector3(100,100,1),speed:3e-4,globalAlpha:2.2,repeat:new m.Vector2(2.6,3.4),noiseScale:-.01,blendScale:1.2,blendSpeed:1.21,alphaFade:4.6,fadeRange:new m.Vector2(-.8,5.1),mixOffset:new m.Vector2(3.95,.59)},clouds2:{name:"Clouds 2",isVisible:!0,textureCloud:z.ResourceLoader.get("sky-cloud"),textureNoise:z.ResourceLoader.get("cloud-noise"),textureBlend:z.ResourceLoader.get("sky-blending"),position:new m.Vector3(0,.6,-17),rotation:new m.Vector3(1.15,0,0),scale:new m.Vector3(100,100,1),speed:2e-4,globalAlpha:1.14,repeat:new m.Vector2(3.9,6.2),noiseScale:-.01,blendScale:-.01,blendSpeed:.07,alphaFade:4.5,fadeRange:new m.Vector2(2.6,3.6),mixOffset:new m.Vector2(1.2,.47)}},this.background=this._settings.background,this._debugFolder=this._createDebugFolder(),this._cameraManager=this._createCameraManager()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._destroyComponents()}},{key:"config",get:function(){return this._config}},{key:"camera",get:function(){return this._cameraManager.camera}},{key:"initialize",value:function(e){"critical"!==e&&(this._components=this._createComponents(),this._isReady=!0)}},{key:"compile",value:function(e,t){"critical"!==t&&e.compile(this,this._cameraManager.camera)}},{key:"render",value:function(e){this._isReady&&e.render(this,this._cameraManager.camera)}},{key:"playTimelapseAnimation",value:function(){this._components&&this._components.clouds1&&this._components.clouds1.playTimelapseAnimation(),this._components&&this._components.clouds2&&this._components.clouds2.playTimelapseAnimation()}},{key:"_createCameraManager",value:function(){return new Z({types:["Default","Orbit"],debugFolder:this._debugFolder})}},{key:"_createComponents",value:function(){var e={};return e.clouds1=this._createClouds1(),e.clouds2=this._createClouds2(),e}},{key:"_createClouds1",value:function(){var e=new be({debugFolder:this._debugFolder,settings:this._settings.clouds1});return this.add(e),e}},{key:"_createClouds2",value:function(){var e=new be({debugFolder:this._debugFolder,settings:this._settings.clouds2});return this.add(e),e}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debugger){var t=this._debugger.addFolder({title:"Scene ".concat(_e.name),expanded:!1});return t.addInput(this._settings.background,"image",{label:"Background",view:"image",height:100,showMonitor:!0}).on("change",(function(t){var n=t.value;e.background=(new m.TextureLoader).load(n.src)})),t}}}]),n}(component(m.Scene)),Se=n(262),ke={name:"Facade",resources:[]},Ce=n(263),Me=n(654),Oe=n.n(Me);function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Re=function(e){Object(x.a)(n,e);var t=Pe(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.a)(this,n),(e=t.call(this)).el=o.el||document.documentElement,e._isWheeling=!1,e._enabled=!0,e._virtualScroll=new Oe.a({el:e._el}),e._bindAll(),e._setup(),e}return Object(h.a)(n,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"destroy",value:function(){this._virtualScroll.destroy(),this._removeEventListeners()}},{key:"_setup",value:function(){this._setupEventListeners()}},{key:"_bindAll",value:function(){this._scrollHandler=this._scrollHandler.bind(this),this._scrollEndHandler=this._scrollEndHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._virtualScroll.on(this._scrollHandler)}},{key:"_removeEventListeners",value:function(){this._virtualScroll.off(this._scrollHandler)}},{key:"_scrollHandler",value:function(e){this._enabled&&(Math.abs(e.deltaX)<10&&Math.abs(e.deltaY)<10||(this._isWheeling||(this._isWheeling=!0,this.dispatchEvent("wheel:start",e)),clearTimeout(this._debounceTimeout),this._debounceTimeout=setTimeout(this._scrollEndHandler,50),this.dispatchEvent("wheel",e)))}},{key:"_scrollEndHandler",value:function(){this._enabled&&(this._isWheeling=!1,this.dispatchEvent("wheel:end"))}}]),n}(R.a),Ae=Re;function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Fe=new(function(e){Object(x.a)(n,e);var t=Te(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this))._bindAll(),e._keys=[{key:"ArrowLeft",action:"left"},{key:"ArrowRight",action:"right"},{key:"ArrowUp",action:"up"},{key:"ArrowDown",action:"down"},{key:"Enter",action:"select"},{key:"Escape",action:"back"}],e._setupEventListeners(),e}return Object(h.a)(n,[{key:"destroy",value:function(){this._removeEventListeners()}},{key:"_bindAll",value:function(){this._keydownHandler=this._keydownHandler.bind(this)}},{key:"_setupEventListeners",value:function(){window.addEventListener("keydown",this._keydownHandler)}},{key:"_removeEventListeners",value:function(){window.removeEventListener("keydown",this._keydownHandler)}},{key:"_keydownHandler",value:function(e){for(var t=e.key,i=0;i<this._keys.length;i++)this._keys[i].key===t&&this.dispatchEvent(this._keys[i].action)}}]),n}(R.a));function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Ie=function(e){Object(x.a)(n,e);var t=Le(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debug=e.debugFolder,this._camera=e.camera,this._grid=e.grid,this._raycastMeshes=e.raycastMeshes,this._bindAll(),this._isNavigationEnabled=!1,this._isSelectionEnabled=!1,this._isTutorialSelectionEnabled=!1,this._isOverviewAllowed=!1,this._isNavigationBackEnabled=!1,this._initialActiveRow=this._grid.rows[2],this._initialActiveCol=this._grid.cols[2],this._savedActiveRow=this._initialActiveRow,this._savedActiveCol=this._initialActiveCol,this._activeRow=this._initialActiveRow,this._activeCol=this._initialActiveCol,this._activeIndex=this._getIndex(this._activeCol.index,this._activeRow.index),this._settings={cameraOffsetZ:0,damping:.201,overviewPosition:new m.Vector3(this._initialActiveCol.x,this._initialActiveRow.y,0),overviewPositionOffset:new m.Vector3(0,2.2054,40.5),focusPositionOffset:new m.Vector3(0,-.2,-3.94),boundsPadding:.5,clampBottom:1.22,drag:{sensibility:.007,resistance:15,durationMin:1,durationMax:1,feedbackDistance:2.5,feedbackDurationIn:1,feedbackDurationOut:1},wheel:{enabled:!1,sensibility:.0021,resistance:15,durationMin:1,durationMax:1}},this._settingsMedium={cameraOffsetZ:3,damping:.201,overviewPosition:new m.Vector3(this._initialActiveCol.x,this._initialActiveRow.y,0),overviewPositionOffset:new m.Vector3(0,2.7,40.46),focusPositionOffset:new m.Vector3(0,-.34,-6.94),boundsPadding:.5,clampBottom:1.22,drag:{sensibility:.015,resistance:15,durationMin:1,durationMax:1,feedbackDistance:2.5,feedbackDurationIn:1,feedbackDurationOut:1},wheel:{enabled:!1,sensibility:.0021,resistance:15,durationMin:1,durationMax:1}},this._settingsMobile={cameraOffsetZ:6,damping:.201,overviewPosition:new m.Vector3(this._initialActiveCol.x,this._initialActiveRow.y,0),overviewPositionOffset:new m.Vector3(0,2.7,40.46),focusPositionOffset:new m.Vector3(0,-.37,-8.83),boundsPadding:.5,clampBottom:1.22,drag:{sensibility:.015,resistance:15,durationMin:1,durationMax:1,feedbackDistance:2.5,feedbackDurationIn:1,feedbackDurationOut:1},wheel:{enabled:!1,sensibility:.0021,resistance:15,durationMin:1,durationMax:1}},this._applySettings(),this._previousPosition=new m.Vector3,this._targetPosition=new m.Vector3,this._currentPosition=new m.Vector3,this._dragManager=I.dragManager,this._wheelManager=this._createWheelManager(),this._debugFolder=this._createDebugFolder(),Ce.a.track(this._targetPosition,"x"),Ce.a.track(this._targetPosition,"y"),this._setupEventListeners(),this._setInitialPosition()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._removeEventListeners(),this._wheelManager.destroy(),Ce.a.untrack(this._targetPosition,"x"),Ce.a.untrack(this._targetPosition,"y")}},{key:"raycastMeshes",get:function(){return this._raycastMeshes},set:function(e){this._raycastMeshes=e}},{key:"enableNavigation",value:function(){this._isNavigationEnabled=!0}},{key:"disableNavigation",value:function(){this._isNavigationEnabled=!1}},{key:"enableBackNavigation",value:function(){this._isNavigationBackEnabled=!0}},{key:"disableBackNavigation",value:function(){this._isNavigationBackEnabled=!1}},{key:"enableSelection",value:function(){this._isSelectionEnabled=!0}},{key:"disableSelection",value:function(){this._isSelectionEnabled=!1}},{key:"enableTutorialSelection",value:function(){this._isTutorialSelectionEnabled=!0}},{key:"disableTutorialSelection",value:function(){this._isTutorialSelectionEnabled=!1}},{key:"goToOverview",value:function(){d.b.killTweensOf(this._targetPosition),this._savedActiveRow=this._activeRow,this._savedActiveCol=this._activeCol,d.b.to(this._targetPosition,{duration:2,x:this._settings.overviewPosition.x+this._settings.overviewPositionOffset.x,y:this._settings.overviewPosition.y+this._settings.overviewPositionOffset.y,z:this._settings.overviewPosition.z+this._settings.overviewPositionOffset.z,ease:"power4.inOut"})}},{key:"leaveOverview",value:function(e){d.b.killTweensOf(this._targetPosition);var t=void 0!==e?this._grid.cols[this._getColFromIndex(e)]:this._savedActiveCol,n=void 0!==e?this._grid.rows[this._getRowFromIndex(e)]:this._savedActiveRow;d.b.to(this._targetPosition,{duration:2,x:t.x,y:n.y,z:0,ease:"power3.inOut"})}},{key:"goToFocus",value:function(e){d.b.killTweensOf(this._targetPosition),this._activeCol=void 0!==e?this._grid.cols[this._getColFromIndex(e)]:this._activeCol,this._activeRow=void 0!==e?this._grid.rows[this._getRowFromIndex(e)]:this._activeRow,this._activeIndex=this._getIndex(this._activeCol.index,this._activeRow.index),d.b.to(this._targetPosition,{duration:2,x:this._activeCol.x+this._settings.focusPositionOffset.x,y:this._activeRow.y+this._settings.focusPositionOffset.y,z:this._settings.focusPositionOffset.z,ease:"power4.inOut"})}},{key:"leaveFocus",value:function(){d.b.killTweensOf(this._targetPosition),d.b.to(this._targetPosition,{duration:1.5,x:this._activeCol.x,y:this._activeRow.y,z:0,ease:"power3.inOut"})}},{key:"enableOverview",value:function(){this._isOverviewAllowed=!0}},{key:"disableOverview",value:function(){this._isOverviewAllowed=!1}},{key:"_applySettings",value:function(){"medium"===W.a.current&&(this._settings=ae(this._settings,this._settingsMedium)),"small"===W.a.current&&(this._settings=ae(this._settings,this._settingsMobile))}},{key:"_createWheelManager",value:function(){var e=new Ae({el:this.$renderer.domElement});return e.enabled=this._settings.wheel.enabled,e}},{key:"_throw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drag";"drag"===e&&(this._tweenThrow=d.b.to(this._targetPosition,{inertia:{duration:{min:this._settings.drag.durationMin,max:this._settings.drag.durationMax},resistance:this._settings.drag.resistance,x:{end:this._snapX},y:{end:this._snapY}}})),"wheel"===e&&(this._tweenThrow=d.b.to(this._targetPosition,{inertia:{duration:{min:this._settings.wheel.durationMin,max:this._settings.wheel.durationMax},resistance:this._settings.wheel.resistance,x:{end:this._snapX},y:{end:this._snapY}}}))}},{key:"_snapX",value:function(e){if(e||0===e){for(var t=this._grid.cols[0],n=Math.abs(e-t.x),i=0;i<this._grid.cols.length;i++){var col=this._grid.cols[i],o=Math.abs(e-col.x);o<n&&(t=col,n=o)}return this._activeCol=t,t.x}}},{key:"_snapY",value:function(e){if(e||0===e){for(var t=this._grid.rows[0],n=Math.abs(e-t.y),i=0;i<this._grid.rows.length;i++){var o=this._grid.rows[i],r=Math.abs(e-o.y);r<n&&(t=o,n=r)}return this._activeRow=t,this._activeIndex=this._getIndex(this._activeCol.index,this._activeRow.index),t.y}}},{key:"_goTo",value:function(e,col){var t;this._activeRow=e,this._activeCol=col,this._activeIndex=this._getIndex(this._activeCol.index,this._activeRow.index),null===(t=this._tweenThrow)||void 0===t||t.kill(),this._tweenGoTo=d.b.to(this._targetPosition,{duration:1,x:this._activeCol.x,y:this._activeRow.y,ease:"power3.out"})}},{key:"_goToDragFeedbackPosition",value:function(){var e;null===(e=this.tweenDragFeedback)||void 0===e||e.kill(),this.tweenDragFeedback=d.b.to(this._targetPosition,{duration:this._settings.drag.feedbackDurationIn,z:this._settings.drag.feedbackDistance,ease:"power3.out"})}},{key:"_goToInitialPosition",value:function(){var e;null===(e=this.tweenDragFeedback)||void 0===e||e.kill(),this.tweenDragFeedback=d.b.to(this._targetPosition,{duration:this._settings.drag.feedbackDurationOut,z:0,ease:"power3.out"})}},{key:"_setInitialPosition",value:function(){this._targetPosition.x=this._activeCol.x,this._targetPosition.y=this._activeRow.y,this._targetPosition.z=0,this._currentPosition.x=this._targetPosition.x,this._currentPosition.y=this._targetPosition.y,this._currentPosition.z=this._targetPosition.z}},{key:"_getDistances",value:function(){return{left:this._targetPosition.x-this._grid.bounds.left,right:this._grid.bounds.right-this._targetPosition.x,top:this._grid.bounds.top-this._targetPosition.y,bottom:this._targetPosition.y-this._grid.bounds.bottom}}},{key:"_clampTargetPosition",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(this._targetPosition.x=ue.a.clamp(this._targetPosition.x,this._grid.bounds.left-this._settings.boundsPadding,this._grid.bounds.right+this._settings.boundsPadding)),t&&(this._targetPosition.y=ue.a.clamp(this._targetPosition.y,this._grid.bounds.bottom-this._settings.boundsPadding,this._grid.bounds.top+this._settings.boundsPadding))}},{key:"_bindAll",value:function(){this._dragstartHandler=this._dragstartHandler.bind(this),this._dragmoveHandler=this._dragmoveHandler.bind(this),this._dragendHandler=this._dragendHandler.bind(this),this._wheelstartHandler=this._wheelstartHandler.bind(this),this._wheelHandler=this._wheelHandler.bind(this),this._wheelendHandler=this._wheelendHandler.bind(this),this._snapX=this._snapX.bind(this),this._snapY=this._snapY.bind(this),this._pressLeftHandler=this._pressLeftHandler.bind(this),this._pressRightHandler=this._pressRightHandler.bind(this),this._pressUpHandler=this._pressUpHandler.bind(this),this._pressDownHandler=this._pressDownHandler.bind(this),this._touchdownHandler=this._touchdownHandler.bind(this),this._touchupHandler=this._touchupHandler.bind(this),this._selectHandler=this._selectHandler.bind(this)}},{key:"_setupEventListeners",value:function(){this._dragManager.addEventListener("dragstart",this._dragstartHandler),this._dragManager.addEventListener("drag",this._dragmoveHandler),this._dragManager.addEventListener("dragend",this._dragendHandler),this._dragManager.addEventListener("touchdown",this._touchdownHandler),this._dragManager.addEventListener("touchup",this._touchupHandler),this._wheelManager.addEventListener("wheel:start",this._wheelstartHandler),this._wheelManager.addEventListener("wheel",this._wheelHandler),this._wheelManager.addEventListener("wheel:end",this._wheelendHandler),Fe.addEventListener("left",this._pressLeftHandler),Fe.addEventListener("right",this._pressRightHandler),Fe.addEventListener("up",this._pressUpHandler),Fe.addEventListener("down",this._pressDownHandler),Fe.addEventListener("select",this._selectHandler)}},{key:"_removeEventListeners",value:function(){this._dragManager.removeEventListener("dragstart",this._dragstartHandler),this._dragManager.removeEventListener("drag",this._dragmoveHandler),this._dragManager.removeEventListener("dragend",this._dragendHandler),this._dragManager.removeEventListener("touchdown",this._touchdownHandler),this._dragManager.removeEventListener("touchup",this._touchupHandler),this._wheelManager.removeEventListener("wheel:start",this._wheelstartHandler),this._wheelManager.removeEventListener("wheel",this._wheelHandler),this._wheelManager.removeEventListener("wheel:end",this._wheelendHandler),Fe.removeEventListener("left",this._pressLeftHandler),Fe.removeEventListener("right",this._pressRightHandler),Fe.removeEventListener("up",this._pressUpHandler),Fe.removeEventListener("down",this._pressDownHandler),Fe.removeEventListener("select",this._selectHandler)}},{key:"_dragstartHandler",value:function(){this._isNavigationEnabled&&d.b.killTweensOf(this._targetPosition)}},{key:"_dragmoveHandler",value:function(e){var t=e.delta;this._isNavigationEnabled&&(this._targetPosition.x+=t.x*this._settings.drag.sensibility,this._targetPosition.y+=t.y*-this._settings.drag.sensibility,this._clampTargetPosition())}},{key:"_dragendHandler",value:function(){this._isNavigationEnabled&&(this._throw("drag"),this.$nuxtRoot.$emit("webgl:drag:end"))}},{key:"_wheelstartHandler",value:function(){this._isNavigationEnabled&&d.b.killTweensOf(this._targetPosition)}},{key:"_wheelHandler",value:function(e){var t=e.deltaX,n=e.deltaY;this._isNavigationEnabled&&(this._targetPosition.x+=t*-this._settings.wheel.sensibility,this._targetPosition.y+=n*this._settings.wheel.sensibility)}},{key:"_wheelendHandler",value:function(){this._isNavigationEnabled&&this._throw("wheel")}},{key:"_pressLeftHandler",value:function(){if(this._isNavigationEnabled){var e=this._activeCol.index-1,t=this._grid.cols[e];t&&this._goTo(this._activeRow,t)}}},{key:"_pressRightHandler",value:function(){if(this._isNavigationEnabled){var e=this._activeCol.index+1,t=this._grid.cols[e];t&&this._goTo(this._activeRow,t)}}},{key:"_pressUpHandler",value:function(){if(this._isNavigationEnabled){var e=this._activeRow.index-1,t=this._grid.rows[e];t&&this._goTo(t,this._activeCol)}}},{key:"_pressDownHandler",value:function(){if(this._isNavigationEnabled){var e=this._activeRow.index+1,t=this._grid.rows[e];t&&this._goTo(t,this._activeCol)}}},{key:"_touchdownHandler",value:function(){var e=this;clearTimeout(this._touchdownDebounce),this._isNavigationEnabled&&(this._touchdownDebounce=setTimeout((function(){e._goToDragFeedbackPosition()}),110))}},{key:"_touchupHandler",value:function(){clearTimeout(this._touchdownDebounce),this._isNavigationEnabled&&this._goToInitialPosition()}},{key:"_selectHandler",value:function(){if(this._isSelectionEnabled){var e=this._getIndex(this._activeCol.index,this._activeRow.index);this.$nuxtRoot.$emit("webgl:select",e)}}},{key:"onUpdate",value:function(e){var time=e.time,t=e.deltaTime;e.frame;this._targetPosition.y=Math.max(this._targetPosition.y,this._settings.clampBottom),this._currentPosition.x=ue.a.lerp(this._currentPosition.x,this._targetPosition.x,t/16*this._settings.damping),this._currentPosition.y=ue.a.lerp(this._currentPosition.y,this._targetPosition.y,t/16*this._settings.damping),this._currentPosition.z=ue.a.lerp(this._currentPosition.z,this._targetPosition.z,t/16*this._settings.damping),this._camera.isAnimationCompleted&&(this._camera.position.x=this._currentPosition.x+-.003298552706837654,this._camera.position.y=this._currentPosition.y+.01790809631347834,this._camera.position.z=this._currentPosition.z+7.679490566253662+this._settings.cameraOffsetZ);var n=this._previousPosition.distanceTo(this._camera.position);Se.a.windFrequency=Se.a.windBaseFrequency+n*Se.a.windIntensity,this._previousPosition.set(this._camera.position.x,this._camera.position.y,this._camera.position.z),Se.a.windPeak=Math.sin(time)*Se.a.windPeakAmplitude}},{key:"onWindowResize",value:function(){this._applySettings()}},{key:"onClick",value:function(e){var t=e.centeredMousePosition;this.$raycaster.setFromCamera(t,this._camera);var n=this.$raycaster.intersectObjects(this._raycastMeshes);if(n.length>0){var o=n[0].object.userData,r=this._grid.rows[o.row],l=this._grid.cols[o.col],c=this._getIndex(l.index,r.index);this._isSelectionEnabled?this.$nuxtRoot.$emit("webgl:select",c):this._isTutorialSelectionEnabled?this.$nuxtRoot.$emit("webgl:select:tutorial",c):this._isNavigationBackEnabled&&c!==this._activeIndex&&this.$nuxtRoot.$emit("webgl:back",c),this.$nuxtRoot.$emit("webgl:overview:exit",c)}else this._isNavigationBackEnabled?this.$nuxtRoot.$emit("webgl:back"):this.$nuxtRoot.$emit("webgl:overview:exit")}},{key:"_getIndex",value:function(col,e){return col+this._grid.cols.length*e}},{key:"_getColFromIndex",value:function(e){return e%this._grid.cols.length}},{key:"_getRowFromIndex",value:function(e){return Math.floor(e/this._grid.rows.length)}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t=this._debug.addFolder({title:"Camera Controller",expanded:!1});t.addButton({title:"Enable Navigation"}).on("click",(function(){e.enableNavigation()})),t.addButton({title:"Disable Navigation"}).on("click",(function(){e.disableNavigation()})),t.addSeparator(),t.addButton({title:"Enable Selection"}).on("click",(function(){e.enableSelection()})),t.addButton({title:"Disable Selection"}).on("click",(function(){e.disableSelection()})),t.addSeparator(),t.addButton({title:"Go to overview"}).on("click",(function(){e.goToOverview()})),t.addButton({title:"Leave overview"}).on("click",(function(){e.leaveOverview()})),t.addSeparator(),t.addButton({title:"Go to focus"}).on("click",(function(){e.goToFocus(e._activeIndex)})),t.addButton({title:"Leave focus"}).on("click",(function(){e.leaveFocus()})),t.addSeparator(),t.addInput(this._settings,"damping"),t.addInput(this._settings,"boundsPadding"),t.addInput(this._settings,"overviewPositionOffset"),t.addInput(this._settings,"focusPositionOffset"),t.addInput(this._settings,"clampBottom");var n=t.addFolder({title:"Wind"});n.addButton({title:"Play Wind"}).on("click",(function(){Se.a.playWind()})),n.addInput(Se.a,"windIntensity"),n.addInput(Se.a,"windVolume"),n.addInput(Se.a,"windBaseFrequency"),n.addInput(Se.a,"windPeak"),n.addInput(Se.a,"windPeakAmplitude");var o=t.addTab({pages:[{title:"Drag"},{title:"Wheel"}]});return o.pages[0].addInput(this._settings.drag,"sensibility"),o.pages[0].addInput(this._settings.drag,"resistance"),o.pages[0].addInput(this._settings.drag,"durationMin"),o.pages[0].addInput(this._settings.drag,"durationMax"),o.pages[0].addInput(this._settings.drag,"feedbackDistance"),o.pages[0].addInput(this._settings.drag,"feedbackDurationIn"),o.pages[0].addInput(this._settings.drag,"feedbackDurationOut"),o.pages[1].addInput(this._settings.wheel,"enabled").on("change",(function(){e._wheelManager.enabled=e._settings.wheel.enabled})),o.pages[1].addInput(this._settings.wheel,"sensibility"),o.pages[1].addInput(this._settings.wheel,"resistance"),o.pages[1].addInput(this._settings.wheel,"durationMin"),o.pages[1].addInput(this._settings.wheel,"durationMax"),t}}}]),n}(component()),je=(n(63),n(70),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this._nuxtRoot=t.nuxtRoot,this._object=t.object,this._isEnabled=!1,this._dragManager=I.dragManager,this._settings={damping:.201,drag:{sensibility:.001,resistance:15,durationMin:1,durationMax:1}},this._rotationProgress={target:0,current:0},Ce.a.track(this._rotationProgress,"target"),this._bindAll(),this._setupEventListeners()}return Object(h.a)(e,[{key:"isEnabled",get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e||this.goToInitialRotation()}},{key:"objectRotation",get:function(){return this._object.rotation.y}},{key:"destroy",value:function(){this._removeEventListeners()}},{key:"update",value:function(e){e.time;var t=e.deltaTime;e.frame;this._rotationProgress.current=ue.a.lerp(this._rotationProgress.current,this._rotationProgress.target,t/16*this._settings.damping),this._object.rotation.y=this._rotationProgress.current*Math.PI*2}},{key:"goToInitialRotation",value:function(){d.b.killTweensOf(this._rotationProgress);var e=Math.round(this._rotationProgress.target)-this._rotationProgress.target;this._tweenGoTo=d.b.to(this._rotationProgress,{duration:1,target:"+= ".concat(e),ease:"power3.out"})}},{key:"_throw",value:function(){this._tweenThrow=d.b.to(this._rotationProgress,{inertia:{duration:{min:this._settings.drag.durationMin,max:this._settings.drag.durationMax},resistance:this._settings.drag.resistance,target:{end:this._snap}}})}},{key:"_snap",value:function(e){return e}},{key:"_bindAll",value:function(){this._dragstartHandler=this._dragstartHandler.bind(this),this._dragmoveHandler=this._dragmoveHandler.bind(this),this._dragendHandler=this._dragendHandler.bind(this),this._snap=this._snap.bind(this)}},{key:"_setupEventListeners",value:function(){this._dragManager.addEventListener("dragstart",this._dragstartHandler),this._dragManager.addEventListener("drag",this._dragmoveHandler),this._dragManager.addEventListener("dragend",this._dragendHandler)}},{key:"_removeEventListeners",value:function(){this._dragManager.removeEventListener("dragstart",this._dragstartHandler),this._dragManager.removeEventListener("drag",this._dragmoveHandler),this._dragManager.removeEventListener("dragend",this._dragendHandler)}},{key:"_dragstartHandler",value:function(){this._isEnabled&&(this._nuxtRoot.$emit("webgl:rotate:start"),d.b.killTweensOf(this._rotationProgress))}},{key:"_dragmoveHandler",value:function(e){var t=e.delta;this._isEnabled&&(this._rotationProgress.target+=-t.x*this._settings.drag.sensibility)}},{key:"_dragendHandler",value:function(){this._isEnabled&&(this._nuxtRoot.$emit("webgl:rotate:end"),this._throw())}}]),e}()),De="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nvoid main() {\n    vec4 mvPosition = vec4(position, 1.0);\n    mvPosition = modelViewMatrix * mvPosition;\n\n    vUv = uv;\n    vViewPosition = -mvPosition.xyz;\n    vec3 transformedNormal = normalMatrix * normal;\n    vNormal = normalize(transformedNormal);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",ze="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\n// Uniforms\nuniform sampler2D uMatcap;\nuniform sampler2D uMap;\nuniform sampler2D uNormalMap;\nuniform float uOpacity;\nuniform vec3 uColor;\nuniform vec2 uOffset;\nuniform vec2 uNormalMapScale;\n\nvec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, vec2 uv, float faceDirection) {\n\tvec3 q0 = dFdx(eye_pos.xyz);\n\tvec3 q1 = dFdy(eye_pos.xyz);\n\tvec2 st0 = dFdx(uv.st);\n\tvec2 st1 = dFdy(uv.st);\n\tvec3 N = surf_norm;\n\tvec3 q1perp = cross(q1, N);\n\tvec3 q0perp = cross(N, q0);\n\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\tfloat det = max(dot(T, T), dot(B, B));\n\tfloat scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);\n\treturn normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);\n}\n\nvoid main() {\n\tvec3 color = vec3(1.0, 1.0, 1.0);\n\n\t// Apply color if defined\n\t#ifdef USE_COLOR\n\t\tcolor = uColor;\n\t#endif\n\n\tvec4 diffuseColor = vec4(color, uOpacity);\n\n\t// Apply texture if defined\n\t#ifdef USE_MAP\n        diffuseColor *= texture2D(uMap, vUv);\n    #endif\n\n\tvec3 normal = normalize(vNormal);\n\n\t// Apply normal map\n\t#ifdef USE_NORMAL_MAP\n\t\tvec3 mapN = texture2D(uNormalMap, vUv).xyz * 2.0 - 1.0;\n\t\tmapN.xy *= uNormalMapScale;\n\t\tnormal = perturbNormal2Arb(-vViewPosition, normal, mapN, vUv, 1.0);\n\t#endif\n\n\t// Apply matcap\n\tvec3 viewDir = normalize(vViewPosition);\n\tvec3 x = normalize(vec3(viewDir.z, 0.0, - viewDir.x));\n\tvec3 y = cross(viewDir, x);\n\tvec2 uv = vec2(dot(x, normal), dot(y, normal)) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\tuv.x += uOffset.x;\n\tuv.y += uOffset.y;\n\tvec4 matcapColor = texture2D(uMatcap, uv);\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n}";function Ue(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Be=function(e){Object(x.a)(n,e);var t=Ne(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._side=e.side,this._debug=e.debugFolder,this.transparent=!1,this.wireframe=!1,this.transparent=!1,this.lights=!1,this.extensions={derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defines={USE_COLOR:!0,USE_MAP:!1,USE_NORMAL_MAP:!1},this.uniforms=this._createUniforms(e.uniforms),this.vertexShader=De,this.fragmentShader=ze}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this.dispose()}},{key:"_createUniforms",value:function(e){var t=function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Ue(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Ue(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},e);return t}},{key:"onWindowResize",value:function(e){}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}}]),n}(component(m.ShaderMaterial)),Ee="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvarying vec3 vPosition;\n\nvoid main() {\n    vec4 mvPosition = vec4(position, 1.0);\n    mvPosition = modelViewMatrix * mvPosition;\n\n    vUv = uv;\n    vViewPosition = -mvPosition.xyz;\n    vPosition = mvPosition.xyz;\n\n    vec3 transformedNormal = normalMatrix * normal;\n    vNormal = normalize(transformedNormal);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",He="#define GLSLIFY 1\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nvarying vec3 vViewPosition;\nvarying vec2 vUv;\nuniform float uKa;\nuniform float uKd;\nuniform float uKs;\nuniform float uShininess;\nuniform vec2 uNormalMapScale;\n\n// Material color\nuniform sampler2D uMap;\nuniform sampler2D uNormalMap;\nuniform vec3 uColorA;\nuniform vec3 uColorD;\nuniform vec3 uColorS;\nuniform vec3 uLightPos;\n\nvec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, vec2 uv, float faceDirection) {\n\tvec3 q0 = dFdx(eye_pos.xyz);\n\tvec3 q1 = dFdy(eye_pos.xyz);\n\tvec2 st0 = dFdx(uv.st);\n\tvec2 st1 = dFdy(uv.st);\n\tvec3 N = surf_norm;\n\tvec3 q1perp = cross(q1, N);\n\tvec3 q0perp = cross(N, q0);\n\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\tfloat det = max(dot(T, T), dot(B, B));\n\tfloat scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);\n\treturn normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);\n}\n\nvoid main() {\n\tvec3 normal = normalize(vNormal);\n\n  \t// #ifdef USE_NORMAL_MAP\n\tvec3 mapN = texture2D(uNormalMap, vUv).xyz * 2.0 - 1.0;\n\tmapN.xy *= uNormalMapScale;\n\tnormal = perturbNormal2Arb(-vViewPosition, normal, mapN, vUv, 1.0);\n\n  vec3 N = normalize(normal);\n  vec3 L = normalize(uLightPos - vPosition);\n\n  vec4 bagTex = texture2D(uMap, vUv);\n  // Lambert's cosine law\n  float lambertian = max(dot(N, L), 0.0);\n  float specular = 0.0;\n  if(lambertian > 0.0) {\n    vec3 R = reflect(-L, N);\n    vec3 V = normalize(-vPosition);\n    float specAngle = max(dot(R, V), 0.0);\n    specular = pow(specAngle, uShininess);\n  }\n  \n  vec3 lightOut = vec3(uKa * uColorA +\n                      uKd * lambertian * uColorD +\n                      uKs * specular * uColorS);\n  gl_FragColor = vec4(lightOut * bagTex.rgb, 1.0);\n\t\t\n}\n";function Ge(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var We=function(e){Object(x.a)(n,e);var t=Ve(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._side=e.side,this._debug=e.debugFolder,this.transparent=!1,this.wireframe=!1,this.transparent=!1,this.lights=!1,this.extensions={derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defines={USE_COLOR:!0,USE_MAP:!1,USE_NORMAL_MAP:!1},this.uniforms=this._createUniforms(e.uniforms),this.vertexShader=Ee,this.fragmentShader=He}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this.dispose()}},{key:"_createUniforms",value:function(e){var t=function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Ge(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):Ge(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},e);return t}},{key:"onWindowResize",value:function(e){}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}}]),n}(component(m.ShaderMaterial));function qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var $e=function(e){Object(x.a)(n,e);var t=qe(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._model=e.model.scene,this._materialsConfig=e.materials,this.name=e.name,this._settings=e.settings,this._rotationFactor=1,this._randomX=ue.a.randomFromRange(-100,100),this._randomY=ue.a.randomFromRange(-100,100),this._bagController=this._createBagController(),this._materials=this._createMaterials(),this._rotationContainer1=this._createRotationContainer(),this._rotationContainer2=this._createRotationContainer(),this.add(this._rotationContainer1),this._rotationContainer1.add(this._rotationContainer2),this._rotationContainer2.add(this._model)}},{key:"objectRotation",get:function(){return this._bagController.objectRotation}},{key:"bagInstance",get:function(){return this._bag}},{key:"materials",get:function(){return this._materials}},{key:"materialsConfig",get:function(){return this._materialsConfig}},{key:"model",get:function(){return this._model},set:function(e){this._model=e}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._bagController.destroy();for(var i=0;i<this._materials.length;i++)this._materials[i].dispose()}},{key:"goToDetails",value:function(){this._bagController.isEnabled=!0,d.b.to(this,{duration:1,_rotationFactor:0,ease:"sine.inOut"})}},{key:"leaveDetails",value:function(){this._bagController.isEnabled=!1,d.b.to(this,{duration:1,_rotationFactor:1,ease:"sine.inOut"})}},{key:"playSelectionFeedback",value:function(){d.b.fromTo(this._rotationContainer2.rotation,{y:0},{duration:1.5,y:2*Math.PI,ease:"power3.inOut"})}},{key:"_createBagController",value:function(){return new je({object:this._model,nuxtRoot:this.$nuxtRoot})}},{key:"_createMaterials",value:function(){var e=this,t=[];return this._model.traverse((function(n){if(n.isMesh){if(n.name.includes("STANDARD")){var o=e._createStandardMaterial(e._materialsConfig.standard);o.name=n.name.split("_")[1],n.material=o,t.push(o)}if(n.name.includes("MATCAP")){var r=e._createMatCapMaterial(e._materialsConfig.matcap);r.name=n.name.split("_")[1],n.material=r,t.push(r)}}})),t}},{key:"_createRotationContainer",value:function(){return new m.Object3D}},{key:"_createMatCapMaterial",value:function(e){var map=U.a.get(e.map),t=U.a.get(e.normal),n=U.a.get(e.matcap),o=new Be({uniforms:{uMap:{value:map},uNormalMap:{value:t},uMatcap:{value:n},uOpacity:{value:e.opacity},uColor:{value:new m.Color(e.color)},uOffset:{value:new m.Vector2(e.offset.x,e.offset.y)},uNormalMapScale:{value:new m.Vector2(e.normalScale.x,e.normalScale.y)}}});return o.defines.USE_MAP=e.useMap,o.defines.USE_NORMAL_MAP=e.useNormal,o}},{key:"_createStandardMaterial",value:function(e){var map=U.a.get(e.map),t=U.a.get(e.normal),n=U.a.get(e.matcap),o=new We({uniforms:{uMap:{value:map},uNormalMap:{value:t},uMatcap:{value:n},uShininess:{value:e.shininess},uOpacity:{value:e.opacity},uKa:{value:e.ambientReflection},uKd:{value:e.diffuseReflection},uKs:{value:e.specularReflection},uNormalMapScale:{value:new m.Vector2(e.normalScale.x,e.normalScale.y)},uColorA:{value:new m.Color(e.ambientColor)},uColorD:{value:new m.Color(e.diffuseColor)},uColorS:{value:new m.Color(e.specularColor)},uLightPos:{value:new m.Vector3(e.lightPosition.x,e.lightPosition.y,e.lightPosition.z)}}});return o.defines.USE_MAP=e.useMap,o.defines.USE_NORMAL_MAP=e.useNormal,o}},{key:"onUpdate",value:function(e){var time=e.time,t=e.deltaTime,n=e.frame;this._rotationContainer1.rotation.x=Math.sin(-time+this._randomX)*this._settings.idleAnimation.rotationAmplitude.x*this._settings.idleAnimation.rotationSpeed*this._rotationFactor,this._rotationContainer1.rotation.y=Math.cos(time+this._randomY)*this._settings.idleAnimation.rotationAmplitude.y*this._settings.idleAnimation.rotationSpeed*this._rotationFactor,this._bagController.update({time:time,deltaTime:t,frame:n})}}]),n}(component(m.Object3D)),Ye={bag01:{name:"Bag 01",options:{model:"bag-01",materials:{standard:{map:"albedo-01",normal:"normal-01",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.54,diffuseReflection:1.8,specularReflection:0,normalScale:{x:4,y:4},ambientColor:"white",diffuseColor:"#5b5d85",specularColor:"white",lightPosition:{x:.34,y:4.03,z:-1.44}},matcap:{map:"albedo-01",normal:"normal-01",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag02:{name:"Bag 02",options:{model:"bag-02",materials:{standard:{map:"albedo-02",normal:"normal-02",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:10,opacity:1,ambientReflection:2.77,diffuseReflection:1.2,specularReflection:0,normalScale:{x:4.4,y:4.4},ambientColor:"#5c5c5c",diffuseColor:"#7e7e7e",specularColor:{r:1,g:1,b:1},lightPosition:{x:0,y:.2,z:.08}},matcap:{map:"albedo-02",normal:"normal-02",matcap:"texture-matcap-metal",useNormal:!0,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag03:{name:"Bag 03",options:{model:"bag-03",materials:{standard:{map:"albedo-03",normal:"normal-03",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:20,opacity:1,ambientReflection:.55,diffuseReflection:.4,specularReflection:.54,normalScale:{x:3,y:3},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:.4,y:-.2,z:.08}},matcap:{map:"albedo-03",normal:"normal-03",matcap:"texture-matcap-metal",useNormal:!0,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag04:{name:"Bag 04",options:{model:"bag-04",materials:{standard:{map:"albedo-04",normal:"normal-04",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:1,opacity:1,ambientReflection:.5,diffuseReflection:.5,specularReflection:.1,normalScale:{x:4,y:4},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:-.4,y:.9,z:.01}},matcap:{map:"albedo-04",normal:"normal-04",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag05:{name:"Bag 05",options:{model:"bag-05",materials:{standard:{map:"albedo-05",normal:"normal-05",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:10,opacity:1,ambientReflection:.5,diffuseReflection:.6,specularReflection:.1,normalScale:{x:4,y:4},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:-.1,y:-1,z:.08}},matcap:{map:"albedo-05",normal:"normal-05",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag06:{name:"Bag 06",options:{model:"bag-06",materials:{standard:{map:"albedo-06",normal:"normal-06",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:10,opacity:1,ambientReflection:.2,diffuseReflection:1,specularReflection:.6,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-06",normal:"normal-06",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag07:{name:"Bag 07",options:{model:"bag-07",materials:{standard:{map:"albedo-07",normal:"normal-07",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:40,opacity:1,ambientReflection:.8,diffuseReflection:.4,specularReflection:1,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-07",normal:"normal-07",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag08:{name:"Bag 08",options:{model:"bag-08",materials:{standard:{map:"albedo-08",normal:"normal-08",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:20,opacity:1,ambientReflection:.64,diffuseReflection:.35,specularReflection:.5,normalScale:{x:2,y:2},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:-.6,y:-.7,z:-.1}},matcap:{map:"albedo-08",normal:"normal-08",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag09:{name:"Bag 09",options:{model:"bag-09",materials:{standard:{map:"albedo-09",normal:"normal-09",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.35,diffuseReflection:.8,specularReflection:1,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:0,y:.5,z:.08}},matcap:{map:"albedo-09",normal:"normal-09",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag010:{name:"Bag 010",options:{model:"bag-010",materials:{standard:{map:"albedo-010",normal:"normal-010",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.35,diffuseReflection:.8,specularReflection:1,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:0,y:.5,z:.08}},matcap:{map:"albedo-010",normal:"normal-010",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag011:{name:"Bag 011",options:{model:"bag-011",materials:{standard:{map:"albedo-011",normal:"normal-011",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:70,opacity:1,ambientReflection:.8,diffuseReflection:.5,specularReflection:4.5,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-011",normal:"normal-011",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag012:{name:"Bag 012",options:{model:"bag-012",materials:{standard:{map:"albedo-012",normal:"normal-012",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:40,opacity:1,ambientReflection:.9,diffuseReflection:.2,specularReflection:.67,normalScale:{x:4,y:4},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-012",normal:"normal-012",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag013:{name:"Bag 013",options:{model:"bag-013",materials:{standard:{map:"albedo-013",normal:"normal-013",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.6,diffuseReflection:.7,specularReflection:0,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-013",normal:"normal-013",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag014:{name:"Bag 014",options:{model:"bag-014",materials:{standard:{map:"albedo-014",normal:"normal-014",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.6,diffuseReflection:.69,specularReflection:0,normalScale:{x:6.3,y:6.3},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:.9,y:.8,z:.08}},matcap:{map:"albedo-014",normal:"normal-014",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag015:{name:"Bag 015",options:{model:"bag-015",materials:{standard:{map:"albedo-015",normal:"normal-015",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.5,diffuseReflection:.6,specularReflection:.6,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-015",normal:"normal-015",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag016:{name:"Bag 016",options:{model:"bag-016",materials:{standard:{map:"albedo-016",normal:"normal-016",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.5,diffuseReflection:.6,specularReflection:.6,normalScale:{x:1,y:1},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:1,y:1,z:.08}},matcap:{map:"albedo-016",normal:"normal-016",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag017:{name:"Bag 017",options:{model:"bag-017",materials:{standard:{map:"albedo-017",normal:"normal-017",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:30,opacity:1,ambientReflection:1.2,diffuseReflection:-.4,specularReflection:0,normalScale:{x:4,y:4},ambientColor:{r:1,g:1,b:1},diffuseColor:{r:1,g:1,b:1},specularColor:{r:1,g:1,b:1},lightPosition:{x:-.3,y:-3.8,z:.08}},matcap:{map:"albedo-017",normal:"normal-017",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag018:{name:"Bag 018",options:{model:"bag-018",materials:{standard:{map:"albedo-018",normal:"normal-018",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.6,diffuseReflection:.4,specularReflection:0,normalScale:{x:6,y:6},ambientColor:{r:1,g:1,b:1},diffuseColor:{r:1,g:1,b:1},specularColor:{r:1,g:1,b:1},lightPosition:{x:-2.4,y:-2.5,z:.08}},matcap:{map:"albedo-018",normal:"normal-018",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag019:{name:"Bag 019",options:{model:"bag-019",materials:{standard:{map:"albedo-019",normal:"normal-019",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.9,diffuseReflection:.46,specularReflection:0,normalScale:{x:10,y:10},ambientColor:{r:1,g:1,b:1},diffuseColor:{r:1,g:1,b:1},specularColor:{r:1,g:1,b:1},lightPosition:{x:-.8,y:.3,z:.08}},matcap:{map:"albedo-019",normal:"normal-019",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag020:{name:"Bag 020",options:{model:"bag-020",materials:{standard:{map:"albedo-020",normal:"normal-020",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:10,opacity:1,ambientReflection:.41,diffuseReflection:.61,specularReflection:.3,normalScale:{x:2,y:2},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:-.3,y:1.5,z:.08}},matcap:{map:"albedo-020",normal:"normal-020",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag021:{name:"Bag 021",options:{model:"bag-021",materials:{standard:{map:"albedo-021",normal:"normal-021",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.87,diffuseReflection:.39,specularReflection:0,normalScale:{x:5,y:5},ambientColor:{r:1,g:1,b:1},diffuseColor:{r:1,g:1,b:1},specularColor:{r:1,g:1,b:1},lightPosition:{x:.4,y:3.1,z:.08}},matcap:{map:"albedo-021",normal:"normal-021",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag022:{name:"Bag 022",options:{model:"bag-022",materials:{standard:{map:"albedo-022",normal:"normal-022",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:20,opacity:1,ambientReflection:.76,diffuseReflection:.33,specularReflection:0,normalScale:{x:5,y:5},ambientColor:{r:1,g:1,b:1},diffuseColor:{r:1,g:1,b:1},specularColor:{r:1,g:1,b:1},lightPosition:{x:-.3,y:2.8,z:.08}},matcap:{map:"albedo-022",normal:"normal-022",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag023:{name:"Bag 023",options:{model:"bag-023",materials:{standard:{map:"albedo-023",normal:"normal-023",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.81,diffuseReflection:.72,specularReflection:0,normalScale:{x:10,y:10},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:2.8,y:.8,z:.08}},matcap:{map:"albedo-023",normal:"normal-023",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag024:{name:"Bag 024",options:{model:"bag-024",materials:{standard:{map:"albedo-024",normal:"normal-024",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.29,diffuseReflection:1.3,specularReflection:0,normalScale:{x:5,y:5},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:.5,y:2.2,z:.08}},matcap:{map:"albedo-024",normal:"normal-024",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}},bag025:{name:"Bag 025",options:{model:"bag-025",materials:{standard:{map:"albedo-025",normal:"normal-025",matcap:"texture-matcap-metal",useNormal:!0,useMap:!0,shininess:100,opacity:1,ambientReflection:.8,diffuseReflection:.35,specularReflection:0,normalScale:{x:5,y:5},ambientColor:"white",diffuseColor:"white",specularColor:"white",lightPosition:{x:-.6,y:-.1,z:.08}},matcap:{map:"albedo-025",normal:"normal-025",matcap:"texture-matcap-metal",useNormal:!1,useMap:!1,opacity:1,color:"white",offset:{x:0,y:0},normalScale:{x:1,y:1}}}}}};function Ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Xe=function(e){Object(x.a)(n,e);var t=Ke(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._bagEmpties=e.empties,this._settings={idleAnimation:{rotationAmplitude:{x:.1*1.5,y:.05*1.5},rotationSpeed:1}},this._bags=[],this._createBags(),this._debugFolder=this._createDebugFolder()}},{key:"bags",get:function(){return this._bags}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this)}},{key:"playAnimation",value:function(){var e=new d.b.timeline({delay:4.5}),t=this._bags.map((function(e){return{scale:1,rotation:0,item:e}}));e.fromTo(t,{scale:0,rotation:2*Math.PI},{duration:.5,scale:1,rotation:0,stagger:{from:"random",grid:[5,5],ease:"power3.inOut",each:.1},modifiers:{scale:function(e,t){return t.item.scale.set(e,e,e),e},rotation:function(e,t){return t.item.rotation.y=e,e}}})}},{key:"skipAnimation",value:function(){for(var e=0;e<this._bags.length;e++)this._bags[e].scale.set(1,1,1),this._bags[e].rotation.y=0}},{key:"playSelectionFeedback",value:function(e,t){t&&this._bags[e].playSelectionFeedback()}},{key:"goToDetails",value:function(e){this._bags[e].goToDetails()}},{key:"leaveDetails",value:function(e){this._bags[e].leaveDetails()}},{key:"_createBags",value:function(){for(var e=0;e<this._bagEmpties.length;e++){var t="bag0".concat(e+1);this._createBagInstance({name:t,position:this._bagEmpties[e].position})}}},{key:"_createBagInstance",value:function(e){var t=new $e({name:Ye[e.name].name,model:U.a.get(Ye[e.name].options.model),materials:Ye[e.name].options.materials,settings:this._settings});t.position.copy(e.position),t.position.y-=1,t.position.z+=.5,t.rotation.y+=2*Math.PI,t.scale.set(0,0,0),this._bags.push(t),this.add(t)}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){this._resize()}},{key:"_resize",value:function(){}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t=this._debug.addFolder({title:"Bags",expanded:!1}),n=t.addFolder({title:"Animation",expanded:!1});n.addInput(this._settings.idleAnimation,"rotationAmplitude",{x:{min:-1,max:1},y:{min:-1,max:1}}),n.addInput(this._settings.idleAnimation,"rotationSpeed",{min:0,max:2});for(var o=0;o<this._bags.length;o++)for(var r=t.addFolder({title:this._bags[o].name,expanded:!1}),l=function(t){var n=r.addFolder({title:"".concat(e._bags[o].materials[t].name,"_TEXTURES"),expanded:!1}),l=r.addFolder({title:"".concat(e._bags[o].materials[t].name,"_PARAMS"),expanded:!1}),element=e._bags[o].materials[t].uniforms,c=function(e){if(element[e].value.isTexture)n.addInput(element[e].value,"image",{label:"texture",view:"image",height:60,showMonitor:!0}).on("change",(function(t){var n=t.value;element[e].value=(new m.TextureLoader).load(n.src),element[e].value.flipY=!1})),n.addSeparator();else if(element[e].value.isColor){var t={color:"#".concat(element[e].value.getHexString())};l.addInput(t,"color",{label:e}).on("change",(function(){element[e].value.set(t.color)}))}else l.addInput(element[e],"value",{label:e})};for(var h in element)c(h)},c=0;c<this._bags[o].materials.length;c++)l(c);return t}}}]),n}(component(m.Object3D));n(174),n(198),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(308);function Ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Je=function(e){Object(x.a)(n,e);var t=Ze(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._camera=e.camera,this._empties=e.empties,this._planes=e.curtainPlanes,this._model=U.a.get("scene-V9"),this._settings={animation:{progress:0}},this._geometry=this._createInstancedGeometry(),this._material=this._createCurtainsMaterial(),this._createGeometryAttributes(),this._mesh=this._createMesh(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"playAnimation",value:function(){var e=this;this._model.animationManager.playAnimation({name:"IntroLeft",loop:!1}),this._model.animationManager.playAnimation({name:"IntroRight",loop:!1,onComplete:function(){d.b.to(e._material.uniforms.uFoldFinish,{value:1})}}),d.b.to(this._material.uniforms.uCurtainsColorProgress,{value:1,duration:2,delay:3.5,ease:"power3.inOut"}),d.b.to(this._mesh.position,{z:-.08,duration:2,delay:3.5,ease:"power3.inOut"})}},{key:"skipAnimation",value:function(){var progress=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._material.uniforms.uFoldProgress.value=progress,this._material.uniforms.uFoldFinish.value=1,this._material.uniforms.uCurtainsColorProgress.value=1,this._mesh.position.z=-.08}},{key:"_createInstancedGeometry",value:function(){var e=new m.PlaneGeometry(2.2,3,5,5),t=(new m.InstancedBufferGeometry).copy(e);return t.instanceCount=50,t}},{key:"_createGeometryAttributes",value:function(){for(var e=[],t=[],i=0;i<this._empties.length;i++)t.push(Math.random()-.5);for(var n=0;n<2;n++)for(var o=0;o<this._empties.length;o++){var r=n%2?0:-.04;e.push(this._empties[o].position.x,this._empties[o].position.y+.5,r,t[o])}var l=new Float32Array(e);this._geometry.setAttribute("aPosition",new m.InstancedBufferAttribute(l,4,!1))}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return e.position.y-=.1,e.position.z-=.24,e.frustumCulled=!1,e.renderOrder=1,this.add(e),e}},{key:"_createCurtainsMaterial",value:function(){var e=U.a.get("alpha-curtains"),t=U.a.get("cloud-noise"),n=U.a.get("curtains-noise"),o=U.a.get("concrete-normal");e.premultiplyAlpha=!0;var r={uAlpha:{value:1},uFadeGradient:{value:20},uCurtainsColorProgress:{value:.4},uCurtainsTex:{value:e},uNormalTex:{value:o},uNoiseTexture:{value:t},uGlittersNoise:{value:n},uFBOTexture:{value:null},uTime:{value:0},uColor:{value:new m.Color("#c2e56c")},uFoldProgress:{value:1},uFoldFinish:{value:0},uGlittersIntensity:{value:39.3},uGlittersSharpness:{value:5.5},uGlittersSize:{value:194},uGlittersUvRepeat:{value:1.6},uGlittersSpeed:{value:.014},uKa:{value:.84},uKd:{value:.05},uKs:{value:.61},uShininess:{value:48},uCameraPosition:{value:new m.Vector3(0,0,0)},uLightPosition:{value:new m.Vector3(0,0,0)},uNormalMapScale:{value:87.2},uVelocity:{value:0},uWindSpeed:{value:2},uWaveDisplacement:{value:2},uShadowAlpha:{value:1.3},uAmplitude:{value:new m.Vector3(-.03,.02,.08)},uMouseAmplitude:{value:new m.Vector2(.03,.07)}};return new m.ShaderMaterial({uniforms:r,vertexShader:"#define GLSLIFY 1\n#define PI 3.1415926538\n\n// Attributes\nattribute vec4 aPosition;\n\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec2 vTexCoords;\nvarying float vCurtainDepth;\nvarying float vCurtainZOffset;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\n// Uniforms\nuniform float uTime;\nuniform float uWindSpeed;\nuniform float uWaveDisplacement;\nuniform vec2 uMouseAmplitude;\nuniform vec3 uAmplitude;\n\nuniform sampler2D uFBOTexture;\nuniform sampler2D uNoiseTexture;\n\nuniform float uFoldProgress;\nuniform float uFoldFinish;\n\nuniform float uVelocity;\n\n// Imports\nfloat mapRange(float value, float min1, float max1, float min2, float max2) {\n    return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nmat4 rotationMatrix(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n\n    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                0.0,                                0.0,                                0.0,                                1.0);\n}\n\nvoid main() {\n\n    vUv = uv;\n    vUv.y = 1.0 - vUv.y;\n    vec3 transformed = vec3(position);\n    transformed.xy += aPosition.xy;\n    transformed.x += aPosition.z * aPosition.w;\n    transformed.z += aPosition.z * 2.;\n    // transformed.y += aPosition.z * 2.;\n    vPosition = transformed;\n\n    // FBO\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n    pos.xyz /= pos.w;\n    vTexCoords = abs(vec2(mapRange(pos.x, -1., 1., 0., 1.),mapRange(pos.y, -1., 1., 0., 1.)));\n    vec4 fboTexture = texture2D(uFBOTexture, vTexCoords);\n\n    vec2 uvTimeShift = vUv.xy * 0.5 + vec2( 1.3, -1.7 )* uTime * 0.08;\n    vec4 noiseTexture = texture2D(uNoiseTexture, uvTimeShift * 1.2);\n\n    float transformedUvX = 1.0 - abs(mapRange(vUv.x, 0.15, .85, -.85, .85));\n\n    float texStep = smoothstep(0.02, 1., fboTexture.r);\n    float mouseForceX = uVelocity * texStep * transformedUvX * uMouseAmplitude.x; \n    float mouseForceZ = texStep * (2.5* vUv.y) * uMouseAmplitude.y; \n\n    float freq = sqrt(transformed.x * transformed.x + transformed.y * transformed.y);\n    float angle = (uTime * uWindSpeed + freq * uWaveDisplacement);\n    \n    transformed.x += sin(angle) * uAmplitude.x * vUv.y * transformedUvX  * (noiseTexture.r * 4. + 0.01) *  (uFoldFinish + 0.001);\n\n    // mouse transform\n    transformed.x -= mouseForceX;\n    transformed.z += mouseForceZ * transformedUvX * vUv.y;\n\n    transformed.y -= cos(angle) * uAmplitude.y * vUv.y * transformedUvX  * (noiseTexture.r * 4. + 0.01) * ( (uFoldFinish));\n    transformed.z += (sin(angle) * uAmplitude.z * vUv.y * (noiseTexture.r * 4. + 0.01) * (uFoldFinish)) * transformedUvX;\n    transformed.z += (cos(uTime) * vUv.y * (aPosition.w * (aPosition.z * 20.)) * (uFoldFinish)) * transformedUvX;\n\n    vCurtainDepth = transformed.z;\n    vCurtainZOffset = aPosition.z;\n\n    vec3 transformedNormal = normalMatrix * normal;\n    vNormal = normalize(transformedNormal);\n    // animation rotate\n    mat4 rotatedMat = rotationMatrix(vec3(0., transformed.x, 0.), uFoldProgress);\n    vec4 mvPosition = rotatedMat * vec4( transformed.x, transformed.y, transformed.z, 1.0 );\n    \n    vViewPosition = -mvPosition.xyz;\n\n    gl_Position = projectionMatrix * modelViewMatrix * mvPosition;\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vTexCoords;\nvarying float vCurtainDepth;\nvarying float vCurtainZOffset;\n\nuniform sampler2D uCurtainsTex;\nuniform sampler2D uFBOTexture;\nuniform sampler2D uNormalTex;\nuniform sampler2D uGlittersNoise;\nuniform float uTime;\nuniform float uCurtainsColorProgress;\nuniform float uShadowAlpha;\nuniform float uFadeGradient;\nuniform float uNormalMapScale;\nuniform vec3 uColor;\nuniform float uAlpha;\nuniform vec3 uCameraPosition;\nuniform vec3 uLightPosition;\n\nuniform float uGlittersIntensity;\nuniform float uGlittersSharpness;\nuniform float uGlittersSize;\nuniform float uGlittersUvRepeat;\nuniform float uGlittersSpeed;\n\nuniform float uKa;\nuniform float uKd;\nuniform float uKs;\nuniform float uShininess;\n\nvec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, vec2 uv, float faceDirection) {\n\tvec3 q0 = dFdx(eye_pos.xyz);\n\tvec3 q1 = dFdy(eye_pos.xyz);\n\tvec2 st0 = dFdx(uv.st);\n\tvec2 st1 = dFdy(uv.st);\n\tvec3 N = surf_norm;\n\tvec3 q1perp = cross(q1, N);\n\tvec3 q0perp = cross(N, q0);\n\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\tfloat det = max(dot(T, T), dot(B, B));\n\tfloat scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);\n\treturn normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);\n}\n\nfloat mapRange(float value, float min1, float max1, float min2, float max2) {\n    return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nvoid main() {\n    vec2 uvTimeShift = vPosition.xy * 0.5 + vec2( 1.3, -1.7 )* uTime * 0.08;\n    float transformedUvX = 1.0 - abs(mapRange(vUv.x, 0.15, .85, -.85, .85));\n\n\tvec4 curtainsTex = texture2D(uCurtainsTex, vUv);\n  \tvec4 fboTexture = texture2D(uFBOTexture, vTexCoords);\n  \t\n\tfloat timeGlitters = uTime * uGlittersSpeed;\n\t\n\tvec4 noiseTex = texture2D(uGlittersNoise, uvTimeShift * .008);\n\n\tfloat glittersNoise = texture2D(uGlittersNoise, vUv * uGlittersUvRepeat + vec2(timeGlitters)).r;\n\tfloat glittersNoise2 = texture2D(uGlittersNoise, vUv * uGlittersUvRepeat + vec2(1.0 - timeGlitters)).g;\n\n\tvec3 color = uColor;\n\t\n\tfloat glitters = 0.0;\n    glitters += glittersNoise;\n    glitters *= glittersNoise2;\n    glitters = pow(glitters, 3.0) * uGlittersSize;\n\n\tcolor *= curtainsTex.r - (noiseTex.r * uFadeGradient * 0.01);\n\n\tcolor += pow(glitters, uGlittersSharpness) * smoothstep(0., 1., vCurtainDepth * 20.) * uGlittersIntensity * transformedUvX * curtainsTex.a;\n\n\tvec3 normal = normalize(vNormal);\n\n\tvec3 mapN = texture2D(uNormalTex, vUv).xyz * 2.0 - 1.0;\n\tmapN.xy *= uNormalMapScale;\n\tnormal = perturbNormal2Arb(-vViewPosition, normal, mapN, vUv, 1.0);\n\n  \tvec3 N = normalize(normal);\n\tvec3 L = normalize(vec3(uCameraPosition.x * 0.10, uCameraPosition.y * 5.80 , uCameraPosition.z * 6.90) - vPosition);\n  \t// Lambert's cosine law\n  \tfloat lambertian = max(dot(N, L), 0.0);\n\n\tfloat specular = 0.0;\n\tif(lambertian > 0.0) {\n\t\tvec3 R = reflect(-L, N);\n\t\tvec3 V = normalize(-vPosition);\n\t\tfloat specAngle = max(dot(R, V), 0.0);\n\t\tspecular = pow(specAngle, uShininess);\n\t}\n\t\n\tif(uCameraPosition.z > 40.) {\n\t\tspecular = 0.;\n\t}\n\n\tvec3 lightOut = vec3(uKa * vec3(1.0, 1.0, 1.0) +\n\t\t\t\t\t\tuKd * lambertian * vec3(1.0, 1.0, 1.0) +\n\t\t\t\t\t\tuKs * specular * vec3(1.0, 1.0, 1.0));\n\n\tgl_FragColor = vec4(color, curtainsTex.a * uAlpha);\n\n\tfloat curtainsShadows = clamp(pow(length((1.0 - vUv.x) * vUv.y + 0.93), 6.), 0., 1.);\n\n\tgl_FragColor.rgb *= lightOut + vCurtainZOffset;\n\tgl_FragColor.rgb += (vCurtainDepth * 2.) * curtainsTex.a;\n\tgl_FragColor.rgb *= uCurtainsColorProgress;\n\tgl_FragColor.rgb *= curtainsShadows;\n}",transparent:!0,depthWrite:!1,blending:m.CustomBlending,blendSrc:m.OneFactor,blendDst:m.OneMinusSrcAlphaFactor,extensions:{derivatives:!0}})}},{key:"onUpdate",value:function(e){e.time;var t=e.deltaTime;e.frame;this._material.uniforms.uTime.value+=.001*t,this._material.uniforms.uFBOTexture.value=this.$mouseFBO.texture,this._material.uniforms.uVelocity.value=this.$mouseFBO.mouseVelocity,this._material.uniforms.uCameraPosition.value=this._camera.position,this._material.uniforms.uFoldProgress.value=this._model.scene.getObjectByName("left_part").rotation.y}},{key:"onMouseMove",value:function(e){}},{key:"onWindowResize",value:function(e){}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t=this._debug.addFolder({title:"Curtains",expanded:!1}),n=t.addTab({pages:[{title:"Curtains"},{title:"Mouse"},{title:"Glitters"},{title:"Light"}]}),o={uColor:"#".concat(this._material.uniforms.uColor.value.getHexString())};return n.pages[0].addInput(this._settings.animation,"progress",{label:"Animation Progress",min:0,max:1}).on("change",(function(){e.skipAnimation(e._settings.animation.progress)})),n.pages[0].addInput(this._material.uniforms.uFoldProgress,"value",{label:"Fold Progress"}),n.pages[0].addInput(this._material.uniforms.uAlpha,"value",{label:"Global Alpha"}),n.pages[0].addInput(this._material.uniforms.uWindSpeed,"value",{label:"Wind Speed"}),n.pages[0].addInput(this._material.uniforms.uWaveDisplacement,"value",{label:"Wave Vertex Displacement"}),n.pages[0].addInput(this._material.uniforms.uAmplitude,"value",{label:"Wind Final Amplitude"}),n.pages[0].addInput(this._material.uniforms.uFadeGradient,"value",{label:"Fade Gradient"}),n.pages[0].addInput(o,"uColor",{label:"Color"}).on("change",(function(){e._material.uniforms.uColor.value.set(o.uColor)})),n.pages[1].addInput(this.$mouseFBO,"isVisible",{label:"Canvas visibility"}),n.pages[1].addInput(this.$mouseFBO,"lerp",{label:"Lerp"}),n.pages[1].addInput(this.$mouseFBO,"radius",{label:"Radius"}),n.pages[1].addInput(this.$mouseFBO,"hardness",{label:"Hardness"}),n.pages[1].addInput(this.$mouseFBO,"clearAlpha",{label:"Clear Alpha"}),n.pages[1].addInput(this._material.uniforms.uShadowAlpha,"value",{label:"Shadow Alpha"}),n.pages[1].addInput(this._material.uniforms.uMouseAmplitude,"value",{label:"Mouse Amplitude"}),t.addInput(this._material.uniforms.uCurtainsTex.value,"image",{label:"Curtains Texture",view:"image",height:60,showMonitor:!0}).on("change",(function(t){var n=t.value,o=e._material.uniforms.uCurtainsTex.value=(new m.TextureLoader).load(n.src);o.wrapS=o.wrapT=m.RepeatWrapping})),n.pages[2].addInput(this._material.uniforms.uGlittersIntensity,"value",{label:"Glitters Intensity"}),n.pages[2].addInput(this._material.uniforms.uGlittersSharpness,"value",{label:"Glitters Sharpness"}),n.pages[2].addInput(this._material.uniforms.uGlittersSize,"value",{label:"Glitters Size"}),n.pages[2].addInput(this._material.uniforms.uGlittersUvRepeat,"value",{label:"Glitters Repeat"}),n.pages[2].addInput(this._material.uniforms.uGlittersSpeed,"value",{label:"Glitters Speed+"}),n.pages[2].addSeparator(),n.pages[3].addInput(this._material.uniforms.uKa,"value",{label:"Ambient"}),n.pages[3].addInput(this._material.uniforms.uKd,"value",{label:"Diffuse"}),n.pages[3].addInput(this._material.uniforms.uKs,"value",{label:"Specular"}),n.pages[3].addInput(this._material.uniforms.uShininess,"value",{label:"Shininess"}),n.pages[3].addInput(this._material.uniforms.uNormalMapScale,"value",{label:"Normal scale"}),n.pages[3].addInput(this._material.uniforms.uLightPosition,"value",{label:"Light Position"}),t.addSeparator(),t}}}]),n}(component(m.Object3D));function Qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var et=["positionStart","startTime","velocity","acceleration","color","endColor","size","lifeTime"],tt=function(e){Object(x.a)(n,e);var t=Qe(n);function n(){var e,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(Object(c.a)(this,n),o=o||{},(e=t.call(this)).blending=o.blending?o.blending:m.NormalBlending,e.PARTICLE_COUNT=o.maxParticles||100,e.PARTICLE_CURSOR=0,e.time=0,e.offset=0,e.count=0,e.DPR=P.a.dpr,e.particleUpdate=!1,e.onTick=o.onTick,e.reverseTime=o.reverseTime,e.fadeIn=o.fadeIn||1,0===e.fadeIn&&(e.fadeIn=.001),e.fadeOut=o.fadeOut||1,0===e.fadeOut&&(e.fadeOut=.001),e.rand=[],i=100;i>0;i--)e.rand.push(Math.random()-.5);if(e.i=i,e.sprite=o.particleSpriteTex||null,!e.sprite)throw new Error("No particle sprite texture specified");return e.sprite.wrapS=e.sprite.wrapT=m.RepeatWrapping,e._createMaterial(),e._createGeometry(),e._createMesh(),e}return Object(h.a)(n,[{key:"update",value:function(e,t){this.time+=e,this.material.uniforms.uTime.value=this.time,this.onTick&&this.onTick(this,this.time),this._geometryUpdate()}},{key:"spawnParticle",value:function(e){var t=new m.Vector3,n=new m.Vector3,o=new m.Vector3,r=new m.Color,l=new m.Color,c=this.geometry.getAttribute("positionStart"),h=this.geometry.getAttribute("startTime"),d=this.geometry.getAttribute("velocity"),f=this.geometry.getAttribute("acceleration"),v=this.geometry.getAttribute("color"),_=this.geometry.getAttribute("endColor"),y=this.geometry.getAttribute("size"),x=this.geometry.getAttribute("lifeTime");t=void 0!==(e=e||{}).position?t.copy(e.position):t.set(0,0,0),n=void 0!==e.velocity?n.copy(e.velocity):n.set(0,0,0),o=void 0!==e.acceleration?o.copy(e.acceleration):o.set(0,0,0),r=void 0!==e.color?r.copy(e.color):r.set(16777215),l=void 0!==e.endColor?l.copy(e.endColor):l.copy(r);var w=void 0!==e.lifetime?e.lifetime:5,S=void 0!==e.size?e.size:10,k=void 0!==e.sizeRandomness?e.sizeRandomness:0;void 0!==this.DPR&&(S*=this.DPR);var i=this.PARTICLE_CURSOR;c.array[3*i+0]=t.x,c.array[3*i+1]=t.y,c.array[3*i+2]=t.z,d.array[3*i+0]=n.x,d.array[3*i+1]=n.y,d.array[3*i+2]=n.z,f.array[3*i+0]=o.x,f.array[3*i+1]=o.y,f.array[3*i+2]=o.z,v.array[3*i+0]=r.r,v.array[3*i+1]=r.g,v.array[3*i+2]=r.b,_.array[3*i+0]=l.r,_.array[3*i+1]=l.g,_.array[3*i+2]=l.b,y.array[i]=S+this._random()*k,x.array[i]=w,h.array[i]=this.time+.02*this._random(),0===this.offset&&(this.offset=this.PARTICLE_CURSOR),this.count++,this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=0),this.particleUpdate=!0}},{key:"_createMaterial",value:function(){this.material=new m.ShaderMaterial({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tSprite:{value:this.sprite},reverseTime:{value:this.reverseTime},fadeIn:{value:this.fadeIn},fadeOut:{value:this.fadeOut}},blending:this.blending,vertexShader:"#define GLSLIFY 1\nuniform float uTime;\nuniform float uScale;\nuniform bool reverseTime;\nuniform float fadeIn;\nuniform float fadeOut;\n\nattribute vec3 positionStart;\nattribute float startTime;\nattribute vec3 velocity;\nattribute vec3 acceleration;\nattribute vec3 color;\nattribute vec3 endColor;\nattribute float size;\nattribute float lifeTime;\n\nvarying vec4 vColor;\nvarying vec4 vEndColor;\nvarying float lifeLeft;\nvarying float alpha;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec3 newPosition;\n    float timeElapsed = uTime - startTime;\n    \n    if(reverseTime) timeElapsed = lifeTime - timeElapsed;\n\n    if(timeElapsed < fadeIn) {\n        alpha = timeElapsed/fadeIn;\n    }\n\n    if(timeElapsed >= fadeIn && timeElapsed <= (lifeTime - fadeOut)) {\n        alpha = 1.0;\n    }\n\n    if(timeElapsed > (lifeTime - fadeOut)) {\n        alpha = 1.0 - (timeElapsed - (lifeTime-fadeOut))/fadeOut;\n    }\n    \n    lifeLeft = 1.0 - ( timeElapsed / lifeTime );\n    gl_PointSize = (size * uScale);\n\n    newPosition = positionStart + (velocity * timeElapsed) + (acceleration * 0.5 * timeElapsed * timeElapsed);\n    if (lifeLeft < 0.0) { \n        lifeLeft = 0.0; \n        gl_PointSize = 0.;\n    }\n\n    if( timeElapsed > 0.0 ) {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n    } else {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        lifeLeft = 0.0;\n        gl_PointSize = 0.;\n    }\n    \n    vColor = vec4( color, 1.0 );\n    vEndColor = vec4( endColor, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\nvarying vec4 vColor;\nvarying vec4 vEndColor;\nvarying float lifeLeft;\nvarying float alpha;\nuniform sampler2D tSprite;\nvoid main() {\n    vec4 tex = texture2D( tSprite, gl_PointCoord );\n    vec4 color = mix(vColor, vEndColor, 1.0-lifeLeft);\n    gl_FragColor = vec4( color.rgb*tex.rgb, alpha * tex.a);\n}"}),this.material.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],this.material.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0]}},{key:"_createGeometry",value:function(){this.geometry=new m.BufferGeometry,this.geometry.setAttribute("position",new m.BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("positionStart",new m.BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("velocity",new m.BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("acceleration",new m.BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("color",new m.BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("endColor",new m.BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("startTime",new m.BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("size",new m.BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setUsage(m.DynamicDrawUsage)),this.geometry.setAttribute("lifeTime",new m.BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setUsage(m.DynamicDrawUsage))}},{key:"_createMesh",value:function(){this.particleSystem=new m.Points(this.geometry,this.material),this.particleSystem.frustumCulled=!1,this.particleSystem.renderOrder=3,this.add(this.particleSystem)}},{key:"_geometryUpdate",value:function(){var e=this;!0===this.particleUpdate&&(this.particleUpdate=!1,et.forEach((function(t){var n=e.geometry.getAttribute(t);e.offset+e.count<e.PARTICLE_COUNT?(n.updateRange.offset=e.offset*n.itemSize,n.updateRange.count=e.count*n.itemSize):(n.updateRange.offset=0,n.updateRange.count=-1),n.needsUpdate=!0})),this.offset=0,this.count=0)}},{key:"_random",value:function(){return++this.i>=this.rand.length?this.rand[this.i=1]:this.rand[this.i]}}]),n}(m.Object3D),it=n(310);function nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var at=function(e){Object(x.a)(n,e);var t=nt(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){this._options=this._setupOptions(),this._particleSystem=this._createParticleSystem(),this._particlesStartTime=-2}},{key:"_setupOptions",value:function(){return{position:new m.Vector3(0,0,0),velocity:new m.Vector3(0,0,0),acceleration:new m.Vector3(0,0,0),color:new m.Color("#e4ab00"),endColor:new m.Color("#e4ab00"),colorRandomness:0,lifetime:2,fadeIn:.001,fadeOut:.1,size:5,sizeRandomness:10}}},{key:"_createParticleSystem",value:function(){var e=this,t=new tt({maxParticles:1e3,particleSpriteTex:U.a.get("texture-star"),blending:m.AdditiveBlending,onTick:function(t,time){for(var i=0;i<2;i++){e._options.position.set(Object(it.a)(-30,30),Object(it.a)(0,20),Object(it.a)(-30,30)-5),e._options.velocity.set(.5*Math.cos(time),Object(it.a)(-.5,.5),Object(it.a)(-.2,.2)),t.spawnParticle(e._options)}}});return this.add(t),t}},{key:"onUpdate",value:function(e){e.time;var t=e.deltaTime;e.frame;this._particleSystem&&this._particleSystem.update(.001*t)}}]),n}(component(m.Object3D));function st(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var ot=function(e){Object(x.a)(n,e);var t=st(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._empties=e.empties,this._settings={alpha:.8},this._geometry=this._createGeometry(),this._raycastMaterial=this._createRaycastMaterial(),this._raycastMeshes=[],this._alphaStates={hidden:0,hover:.35,visible:.75},this._tweenAlphaStates=[],this._overlayStates=[];for(var t=0;t<this._empties.length;t++){var n=this._empties[t],o=this._createRaycastMesh({position:n.position,row:n.row,col:n.col});this._raycastMeshes.push(o)}this._instancedGeometry=this._createInstancedGeometry(),this._instancedMaterial=this._createInstancedMaterial(),this._instancedMesh=this._createInstancedMesh(),this._createGeometryAttributes(),this._debugFolder=this._createDebugFolder()}},{key:"raycastMeshes",get:function(){return this._raycastMeshes}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._raycastMaterial.dispose(),this._instancedGeometry.dispose(),this._instancedMaterial.dispose()}},{key:"fadeInOverlay",value:function(){return d.b.killTweensOf(this._instancedMaterial.uniforms.uAlpha),d.b.to(this._instancedMaterial.uniforms.uAlpha,{duration:1,value:this._settings.alpha,ease:"sine.inOut"})}},{key:"fadeOutOverlay",value:function(){return d.b.killTweensOf(this._instancedMaterial.uniforms.uAlpha),d.b.to(this._instancedMaterial.uniforms.uAlpha,{duration:1,value:0,ease:"sine.inOut"})}},{key:"hideOverlay",value:function(e){var t=this;return d.b.killTweensOf(this._tweenAlphaStates[e]),d.b.to(this._tweenAlphaStates[e],{duration:1,value:this._alphaStates.hidden,ease:"sine.inOut",onUpdate:function(){t._alphaBuffer[e]=t._tweenAlphaStates[e].value,t._instancedGeometry.attributes.aAlpha.needsUpdate=!0}})}},{key:"showOverlay",value:function(e){var t=this;return d.b.killTweensOf(this._tweenAlphaStates[e]),d.b.to(this._tweenAlphaStates[e],{duration:1,value:this._alphaStates.visible,ease:"sine.inOut",onUpdate:function(){t._alphaBuffer[e]=t._tweenAlphaStates[e].value,t._instancedGeometry.attributes.aAlpha.needsUpdate=!0}})}},{key:"_createGeometry",value:function(){return new m.PlaneGeometry(2.4,4,1,1)}},{key:"_createRaycastMaterial",value:function(){return new m.ShaderMaterial({vertexShader:"#define GLSLIFY 1\nvoid main() {\n    vec3 transformed = position.xyz;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\nvoid main() {\n\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}",transparent:!1,depthWrite:!1,depthTest:!1})}},{key:"_createRaycastMesh",value:function(e){var t=new m.Mesh(this._geometry,this._raycastMaterial);return t.position.set(e.position.x,e.position.y,e.position.z+1),t.userData={row:e.row,col:e.col},t.visible=!1,this.add(t),t}},{key:"_createInstancedGeometry",value:function(){var e=(new m.InstancedBufferGeometry).copy(this._geometry);return e.instanceCount=this._empties.length,e}},{key:"_createGeometryAttributes",value:function(){for(var e=[],t=[],i=0;i<this._empties.length;i++)e.push(this._empties[i].position.x,this._empties[i].position.y+-.2,this._empties[i].position.z),t.push(this._alphaStates.visible);var n=new Float32Array(e);this._alphaBuffer=new Float32Array(t),this._instancedGeometry.setAttribute("aPosition",new m.InstancedBufferAttribute(n,3,!1)),this._instancedGeometry.setAttribute("aAlpha",new m.InstancedBufferAttribute(this._alphaBuffer,1,!1).setUsage(m.DynamicDrawUsage))}},{key:"_createInstancedMaterial",value:function(){for(var e=0;e<this._empties.length;e++)this._overlayStates.push(this._alphaStates.visible),this._tweenAlphaStates.push({value:this._alphaStates.visible});var t={uAlpha:{value:0},overlayStates:{value:this._overlayStates},uTime:{value:0},uZPosOffset:{value:1}};return new m.ShaderMaterial({uniforms:t,vertexShader:"#define GLSLIFY 1\n// Attributes\nattribute vec3 aPosition;\nattribute float aAlpha;\n\n// Varyings\nvarying vec2 vUv;\nvarying float vAlpha;\nvarying vec4 vPosition;\n\nuniform float uZPosOffset;\n\nvoid main() {\n    \n    vec3 transformed = position;\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    transformed.xyz += aPosition;\n    transformed.z += uZPosOffset;\n    vUv = uv;\n    vPosition = pos;\n    vAlpha = aAlpha;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying float vAlpha;\n\nuniform float uAlpha;\n\nvoid main() {\n\tfloat alpha = vAlpha * uAlpha;\n\tgl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\n}",transparent:!0,depthWrite:!1})}},{key:"_createInstancedMesh",value:function(){var e=new m.Mesh(this._instancedGeometry,this._instancedMaterial);return e.frustumCulled=!1,e.renderOrder=2,this.add(e),e}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onClick",value:function(e){}},{key:"onMousemove",value:function(e){}},{key:"onWindowResize",value:function(e){}},{key:"_createDebugFolder",value:function(){if(this._debug){var e=this._debug.addFolder({title:"Bag Overlay",expanded:!1}),t=e.addTab({pages:[{title:"Curtains"},{title:"Mouse"}]});return t.pages[0].addInput(this._instancedMaterial.uniforms.uAlpha,"value",{label:"Global Alpha"}),t.pages[0].addSeparator(),t.pages[0].addInput(this._instancedMaterial.uniforms.uZPosOffset,"value",{label:"Overlay Z Pos"}),t.pages[0].addSeparator(),e.addSeparator(),e}}}]),n}(component(m.Object3D));function lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var ut=function(e){Object(x.a)(n,e);var t=lt(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._empties=e.empties,this._bagsInstances=e.bagsInstances,this._geometry=this._createGeometry(),this._instancedGeometry=this._createInstancedGeometry(),this._instancedMaterial=this._createInstancedMaterial(),this._instancedMesh=this._createInstancedMesh(),this._createGeometryAttributes(),this._activeBagIndex=0,this._activeBagInstance=null,this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._instancedGeometry.dispose(),this._instancedMaterial.dispose()}},{key:"playAnimation",value:function(){d.b.to(this._instancedMaterial.uniforms.uGlobalAlpha,{value:1,delay:6})}},{key:"skipAnimation",value:function(){d.b.to(this._instancedMaterial.uniforms.uGlobalAlpha,{value:1})}},{key:"setActiveBag",value:function(e){this._activeBagIndex=e,this._activeBagInstance=this._bagsInstances[e]}},{key:"removeActiveBag",value:function(e){}},{key:"_createGeometry",value:function(){return new m.PlaneGeometry(1,1,1,1)}},{key:"_createInstancedGeometry",value:function(){var e=(new m.InstancedBufferGeometry).copy(this._geometry);return e.instanceCount=this._empties.length,e}},{key:"_createGeometryAttributes",value:function(){for(var e=[],t=Math.PI,i=0;i<this._empties.length;i++)e.push(this._empties[i].position.x,this._empties[i].position.y+-.2,t);this._posBuffer=new Float32Array(e),this._instancedGeometry.setAttribute("aPosition",new m.InstancedBufferAttribute(this._posBuffer,3,!1).setUsage(m.DynamicDrawUsage))}},{key:"_createInstancedMaterial",value:function(){var e=U.a.get("bag-shadow"),t=U.a.get("bag-shadow-side"),n={uAlpha:{value:.11},uGlobalAlpha:{value:0},uTime:{value:0},uOffset:{value:new m.Vector3(.2,.2,1.23)},uBagRotation:{value:1},uBagShadowTexture:{value:e},uBagShadowSideTexture:{value:t},uZPosOffset:{value:1}};return new m.ShaderMaterial({uniforms:n,vertexShader:"#define GLSLIFY 1\n#define PI 3.1415926538\n\n// Attributes\nattribute vec3 aPosition;\n\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\nvarying float vBagRotation;\n\nuniform vec3 uOffset;\nuniform float uZPosOffset;\n\nvoid main() {\n    \n    vec3 transformed = position;\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    // transformed.x *= sin(aPosition.z + (-PI / 2.));\n    vBagRotation = aPosition.z + (-PI / 2.);\n\n    transformed.xyz *= 1.8;\n    transformed.xyz -= uOffset.xyz;\n    transformed.xy += aPosition.xy;\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.1415926538\n\n// Varyings\nvarying vec2 vUv;\nvarying float vBagRotation;\n\nuniform float uAlpha;\nuniform float uGlobalAlpha;\nuniform sampler2D uBagShadowTexture;\nuniform sampler2D uBagShadowSideTexture;\n\nvec2 scaleUv(vec2 uv, float scale)\n{\n  return (uv - 0.5) * (1.0 / scale) + 0.5;\n}\n\nfloat mapRange(float value, float min1, float max1, float min2, float max2) {\n    return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nvoid main() {\n\tfloat rotation1 = sin(vBagRotation);\n\trotation1 = sign(rotation1) * max(abs(rotation1), 0.22);\n\n\tfloat rotation2 = sin(vBagRotation);\n\trotation2 = sign(rotation2) * max(abs(rotation2), 0.05);\n\n\tvec2 scaledUv1 = scaleUv(vUv, rotation1);\n\tscaledUv1.y = vUv.y;\n\n\tvec2 scaledUv2 = vUv;\n\n\tvec4 bagShadowTexture = texture2D(uBagShadowTexture, scaledUv1);\n\tvec4 bagShadowSideTexture = texture2D(uBagShadowSideTexture, scaledUv2);\n\t\n\tvec4 finalColor = vec4(0.);\n\n\tfloat transitionRange = 0.4;\n\tfloat transitionStep = 0.2;\n\n\tfloat textureSwitch = abs(rotation2);\n\ttextureSwitch = smoothstep(transitionStep - transitionRange, transitionStep + transitionRange, textureSwitch);\n\n\tfinalColor = mix(bagShadowTexture, bagShadowSideTexture, 1.0 - textureSwitch);\n\n\tgl_FragColor = vec4(finalColor.rgb, finalColor.a * uAlpha * uGlobalAlpha);\n}  ",transparent:!0,depthWrite:!1,side:m.DoubleSide})}},{key:"_createInstancedMesh",value:function(){var e=new m.Mesh(this._instancedGeometry,this._instancedMaterial);return e.frustumCulled=!1,e.position.z-=.8,this.add(e),e}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame;this._instancedMaterial.uniforms.uTime.value+=.01,this._activeBagInstance&&(this._posBuffer[3*this._activeBagIndex+2]=this._activeBagInstance.objectRotation,this._instancedGeometry.attributes.aPosition.needsUpdate=!0)}},{key:"onClick",value:function(e){}},{key:"onMousemove",value:function(e){}},{key:"onWindowResize",value:function(e){}},{key:"_createDebugFolder",value:function(){if(this._debug){var e=this._debug.addFolder({title:"Bag Shadow",expanded:!1}),t=e.addTab({pages:[{title:"Curtains"},{title:"Mouse"}]});return t.pages[0].addInput(this._instancedMaterial.uniforms.uAlpha,"value",{label:"Global Alpha"}),t.pages[0].addSeparator(),t.pages[0].addInput(this._instancedMaterial.uniforms.uOffset,"value",{label:"Offset Position"}),t.pages[0].addSeparator(),t.pages[0].addInput(this._instancedMaterial.uniforms.uBagRotation,"value",{label:"Bag Rotation"}),t.pages[0].addSeparator(),t.pages[0].addInput(this._instancedMaterial.uniforms.uZPosOffset,"value",{label:"shadow Z Pos"}),t.pages[0].addSeparator(),e.addSeparator(),e}}}]),n}(component(m.Object3D));n(147);function ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var ht=function(e){Object(x.a)(n,e);var t=ct(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._isDebug=e.isDebug,this._empties=e.empties,this._settings={rows:5,cols:5,rowGap:2,colGap:2},this._geometry=this._createGeometry(),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._isDebug?this._grid=this._createGridDebug():this._grid=this._createGrid(),this._bounds=this._createBounds(),this._isDebug&&(this._gridItems=this._createGridItems()),this._isDebug&&(this._boundsObject=this._createBoundsObject())}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose()}},{key:"cols",get:function(){return this._grid.cols}},{key:"rows",get:function(){return this._grid.rows}},{key:"bounds",get:function(){return this._bounds}},{key:"_createGeometry",value:function(){return new m.BoxGeometry(1,1,1)}},{key:"_createMaterial",value:function(){return new m.MeshNormalMaterial}},{key:"_createMesh",value:function(){return new m.Mesh(this._geometry,this._material)}},{key:"_createGrid",value:function(){for(var e=this,t=[],n=[],o=[],r=function(i){var r=e._empties[i],l={x:r.position.x,y:r.position.y};if(t.push(l),!n.filter((function(e){return e.index===r.row}))[0]){var c={x:null,y:r.position.y,index:r.row};n.push(c)}if(!o.filter((function(e){return e.index===r.col}))[0]){var col={x:r.position.x,y:null,index:r.col};o.push(col)}},i=0;i<this._empties.length;i++)r(i);return{cols:o.sort((function(a,b){return a.index>b.index?1:-1})),rows:n.sort((function(a,b){return a.index>b.index?1:-1})),positions:t}}},{key:"_createGridDebug",value:function(){for(var e=[],t=[],n=[],i=0;i<this._settings.rows;i++){var o={x:null,y:-i*this._settings.rowGap,index:i};e.push(o)}for(var r=0;r<this._settings.cols;r++){var col={x:r*this._settings.colGap,y:null,index:r};t.push(col)}for(var l=0;l<e.length;l++)for(var c=e[l],h=0;h<t.length;h++){var d={x:t[h].x,y:c.y};n.push(d)}return{rows:e,cols:t,positions:n}}},{key:"_createGridItems",value:function(){for(var i=0;i<this._grid.positions.length;i++){var e=this._grid.positions[i],t=this._mesh.clone();t.position.x=e.x,t.position.y=e.y,this.add(t)}return[]}},{key:"_createBounds",value:function(){var e={};return e.top=this._grid.rows[0].y,e.bottom=this._grid.rows[this._grid.rows.length-1].y,e.left=this._grid.cols[0].x,e.right=this._grid.cols[this._grid.cols.length-1].x,e}},{key:"_createBoundsObject",value:function(){var e=new m.PlaneGeometry(1,1,1),t=new m.MeshBasicMaterial({color:"red",wireframe:!0}),n=new m.Mesh(e,t),o=this._bounds.right-this._bounds.left,r=this._bounds.bottom-this._bounds.top;return n.scale.set(o,r),n.position.x=o/2,n.position.y=r/2,this.add(n),n}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){this._resize()}},{key:"_resize",value:function(){}}]),n}(component(m.Object3D)),mt="#define GLSLIFY 1\nattribute vec3 color;\nattribute vec2 uv2;\n\n// Varyings\nvarying vec2 vUv;\nvarying vec2 vUv2;\nvarying vec3 vPosition;\nvarying vec2 vTexCoords;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nfloat mapRange(float value, float min1, float max1, float min2, float max2) {\n    return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n    vTexCoords = abs(vec2(mapRange(pos.x, -1., 1., 0., 1.),mapRange(pos.y, -1., 1., 0., 1.)));\n\n    vec4 mvPosition = vec4(position, 1.0);\n    mvPosition = modelViewMatrix * mvPosition;\n\n    vec3 transformedNormal = normalMatrix * normal;\n    vNormal = normalize(transformedNormal);\n    vViewPosition = -mvPosition.xyz;\n\n    vUv = uv;\n    vUv2 = uv2;\n    vPosition = pos.xyz;\n    vColor = color;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",ft="#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec2 vUv2;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvarying vec3 vPosition;\n\n// Uniforms\nuniform sampler2D uMap;\nuniform sampler2D uNormal;\nuniform sampler2D uShadowMap;\nuniform sampler2D uNoise;\nuniform float uCloudsScale;\nuniform float uCloudsSpeed;\nuniform float uTime;\nuniform float uNormalMapScale;\nuniform float uMapRepeat;\nuniform float uShadowAlphaProgress;\nuniform float uColorIntensity;\nuniform vec3 uColorMix;\nuniform vec3 uSideColor;\nuniform vec3 uCameraPosition;\nuniform vec3 uLightPosition;\n\nvec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, vec2 uv, float faceDirection) {\n\tvec3 q0 = dFdx(eye_pos.xyz);\n\tvec3 q1 = dFdy(eye_pos.xyz);\n\tvec2 st0 = dFdx(uv.st);\n\tvec2 st1 = dFdy(uv.st);\n\tvec3 N = surf_norm;\n\tvec3 q1perp = cross(q1, N);\n\tvec3 q0perp = cross(N, q0);\n\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\tfloat det = max(dot(T, T), dot(B, B));\n\tfloat scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);\n\treturn normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);\n}\n\nvoid main() {\n    vec2 uvTimeShift = vUv2 * uCloudsScale + vec2( 1.3, -1.7 ) * uTime * uCloudsSpeed;\n  \tvec4 noiseTexture = texture2D(uNoise, uvTimeShift);\n\t\n\tvec4 mainColor = vec4(uColorMix, 1.);\n\tvec4 shadowTex = texture2D(uShadowMap, vUv);\n\tvec4 facadeTex = texture2D(uMap, fract(vUv * uMapRepeat));\n\n\tvec3 finalColor = vec3(0.);\n\n\t#ifdef USE_MAP\n\t\tmainColor = mix(mainColor, facadeTex, facadeTex.r);\n    #endif\n\n\t#ifdef USE_SHADOW_MAP\n\t\tmainColor *= mix(mainColor, shadowTex * uShadowAlphaProgress, shadowTex.r);\n    #endif\n\n\t#ifdef USE_VERTEX_COLOR\n\t\tmainColor = mix(mainColor , vec4(uSideColor, 1.) * shadowTex, 1.0 - vColor.r);\n    #endif\n\n\tvec3 mixClouds = mix(mainColor.rgb, vec3(noiseTexture.r), noiseTexture.r);\n\tmixClouds = clamp(mixClouds, 0., 0.7);\n\tfinalColor = mainColor.rgb * mixClouds + uColorIntensity;\n\n\tvec3 normal = normalize(vNormal);\n\t#ifdef USE_NORMAL_MAP\n\t\tvec3 mapN = texture2D(uNormal, fract(vUv * uMapRepeat)).xyz * 2.0 - 1.0;\n\t\tmapN.xy *= uNormalMapScale * vColor.r;\n\t\tnormal = perturbNormal2Arb(-vViewPosition, normal, mapN, vUv, 1.0);\n\t\tvec3 N = normalize(normal);\n\t\tvec3 L = normalize(vec3(uCameraPosition.x + uLightPosition.x, uCameraPosition.y+ uLightPosition.y, uCameraPosition.z+ uLightPosition.z) - vPosition);\n  \t\tfloat lambertian = max(dot(N, L), 0.0);\n\t\tlambertian *= 1.2;\n\t\tlambertian = max(lambertian, 1.);\n\t\tfinalColor *= lambertian;\n    #endif\n\n\t#ifdef USE_SIDE_SHADOW\n\t\t// float sideShadow = clamp(length((vUv2.x)), 0.8, 1.);\n\t\t// finalColor = mix(finalColor, finalColor * sideShadow, 1.0 - vColor.r);\n\t#endif\n\tgl_FragColor = vec4(finalColor,  1.);\n}";function vt(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var gt=function(e){Object(x.a)(n,e);var t=pt(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.uniforms=this._createUniforms(e.uniforms),this.extensions={derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.vertexShader=mt,this.fragmentShader=ft}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this.dispose()}},{key:"_createUniforms",value:function(e){var t=function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?vt(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):vt(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},e);return t}},{key:"onWindowResize",value:function(e){}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}}]),n}(component(m.ShaderMaterial)),_t=function(){function e(t){Object(c.a)(this,e),this._model=t.model,this._animations=t.animations,this._actions=[],this._actionType={},this._mixer=null,this._currentAnim=null,this._firstPlaying=!0,this._isCameraAnimationComplete=!1,this._setupMixer(t.skinnedMesh);for(var n=0;n<this._animations.length;n++){var o=this._animations[n];this._setupMultipleAnimations(o,o.name,n)}this._activateAllActions()}return Object(h.a)(e,[{key:"cameraAnimationComplete",get:function(){return this._isCameraAnimationComplete},set:function(e){this._isCameraAnimationComplete=e}},{key:"currentAnim",get:function(){return this._currentAnim},set:function(e){this._currentAnim=e}},{key:"update",value:function(e){e.time;var t=e.deltaTime;e.frame;this._isCameraAnimationComplete||this._mixer.update(.001*t)}},{key:"playAnimation",value:function(e){this._currentAnim=this._actionType[e.name].getClip(),this._actionType[e.name].time=0,e.loop?this._actionType[e.name].loop=m.LoopRepeat:(this._actionType[e.name].clampWhenFinished=!0,this._actionType[e.name].loop=m.LoopOnce),e.yoyo&&(this._actionType[e.name].clampWhenFinished=!0,this._actionType[e.name].loop=m.LoopPingPong,this._actionType[e.name].repetitions=2),this._setWeight(this._actionType[e.name],1),this._actionType[e.name].paused=!1,this._actionType[e.name].play(),this._actionType[e.name].timeScale=e.speed?e.speed:1,this._actionType[e.name].time=e.delay?e.delay:0,e.onComplete&&this._mixer.addEventListener("finished",(function(t){t.action._clip.name===e.name&&e.onComplete(t)}))}},{key:"revertAnimation",value:function(e){this._actionType[e.name].timeScale=-1,this._actionType[e.name].loop=m.LoopOnce}},{key:"pauseAnimation",value:function(e){this._actionType[e.name].paused=!0}},{key:"fadeAnimation",value:function(e){var t=this;e.loop||(this._actionType[e.to].loop=m.LoopOnce,this._actionType[e.to].clampWhenFinished=!0),this._unPauseAllActions(),this._setWeight(this._actionType[e.to],1),this._actionType[e.to].time=e.delay?e.delay:0,this._actionType[e.from].crossFadeTo(this._actionType[e.to],e.duration?e.duration:1,!0),this.playAnimation({animation:e.to,loop:e.loop,speed:e.speed}),e.onComplete&&this._mixer.addEventListener("finished",(function(n){t._setWeight(t._actionType[e.to],0),e.onComplete(n)}))}},{key:"setAnimationProgress",value:function(e){this.playAnimation(e);var progress=this._currentAnim.duration*e.progress;this._actionType[e.name].paused=!0,this._actionType[e.name].time=progress}},{key:"getAnimationProgress",value:function(e){var t=this._actionType[e.name];return t.getClip().duration*t.time}},{key:"_setupMixer",value:function(e){this._mixer=new m.AnimationMixer(e||this._model.scene)}},{key:"_setupMultipleAnimations",value:function(e,t,n){this._actionType[t]=this._mixer.clipAction(this._animations[n]),this._actions.push(this._actionType[t])}},{key:"_setupAnimations",value:function(e){var t=this;e.forEach((function(e){t._actionType[e.name]=t._mixer.clipAction(e),t._actions.push(t._actionType[e.name])}))}},{key:"_setWeight",value:function(e,t){e.enabled=!0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(t)}},{key:"_activateAllActions",value:function(e,t){var n=this;this._actions.forEach((function(e){n._setWeight(e,1)}))}},{key:"_pauseAllActions",value:function(){this._actions.forEach((function(e){e.paused=!0}))}},{key:"_unPauseAllActions",value:function(){this._actions.forEach((function(e){e.paused=!1}))}}]),e}();function yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var bt=function(e){Object(x.a)(n,e);var t=yt(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._debug=e.debugFolder,this._camera=e.camera,this._settings={animation:{progress:0},materials:{gold:{matcap:U.a.get("texture-matcap-gold"),color:"#ffffff",offset:new m.Vector2(0,0),opacity:1}}},this._initialScale=new m.Vector3(1,1,1),this._model=U.a.get("scene-V9"),this._facade=this._model.scene,this._materials=this._createMaterials(),this._mesh=this._createMesh(),this._animationManager=this._createAnimationManager(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){for(var e in Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._materials)this._materials[e].dispose()}},{key:"playAnimation",value:function(){var e=this;this._animationManager.playAnimation({name:"IntroCamera",loop:!1,onComplete:function(){e._model.cameras[0].isAnimationCompleted=!0}}),d.b.to(this._materials.wall.uniforms.uShadowAlphaProgress,{value:1,duration:2,delay:3.5,ease:"power3.inOut"}),d.b.to(this._materials.gold.uniforms.uOffset.value,{x:.4,duration:.9,delay:2.25,ease:"sine.inOut"}),d.b.to(this._materials.wallSide.uniforms.uLightPosition.value,{x:1.4,duration:.9,delay:2.25,ease:"sine.inOut"})}},{key:"skipAnimation",value:function(){var progress=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._animationManager.setAnimationProgress({name:"IntroCamera",progress:progress}),this._animationManager.setAnimationProgress({name:"IntroRight",progress:progress}),this._animationManager.setAnimationProgress({name:"IntroLeft",progress:progress}),this._model.cameras[0].isAnimationCompleted=!0,this._materials.wall.uniforms.uShadowAlphaProgress.value=1}},{key:"getGridPositionEmpties",value:function(){var e=this,t=[];return this._facade.traverse((function(n){if(n.name.includes("row-")&&n.name.includes("col-")){var o=parseInt(n.name.split("__")[0].split("-")[1]),col=parseInt(n.name.split("__")[1].split("-")[1]);t.push({row:o,col:col,position:{x:n.position.x*e._initialScale.x,y:n.position.y*e._initialScale.y,z:n.position.z*e._initialScale.z}})}})),t}},{key:"getCurtainPlanes",value:function(){var e=[];return this._facade.traverse((function(t){t.name.includes("curtains")&&e.push(t)})),e}},{key:"_createMaterials",value:function(){var e={};return e.gold=this._createGoldMaterial(),e.wall=this._createWallMaterial(),e.wallSide=this._createWallSideMaterial(),e}},{key:"_createGoldMaterial",value:function(){var e=new Be({uniforms:{uMatcap:{value:this._settings.materials.gold.matcap},uOpacity:{value:this._settings.materials.gold.opacity},uColor:{value:new m.Color(this._settings.materials.gold.color)},uOffset:{value:this._settings.materials.gold.offset}}});return e.defines.USE_MAP=!1,e.defines.USE_NORMAL_MAP=!1,e}},{key:"_createWallMaterial",value:function(){var e=U.a.get("texture-shadow-facade"),map=U.a.get("texture-facade"),t=U.a.get("concrete-normal"),n=U.a.get("cloud-noise");return new gt({uniforms:{uMap:{value:map},uMapRepeat:{value:8},uShadowMap:{value:e},uShadowAlphaProgress:{value:.7},uNoise:{value:n},uNormal:{value:t},uNormalMapScale:{value:3},uColorIntensity:{value:.28},uCameraPosition:{value:new m.Vector3(0,0,0)},uLightPosition:{value:new m.Vector3(22,-15,56)},uColorMix:{value:new m.Color("#ffeec0")},uSideColor:{value:new m.Color("#b6b740")},uCloudsScale:{value:.5},uCloudsSpeed:{value:.01},uTime:{value:0}},defines:{USE_SHADOW_MAP:!0,USE_MAP:!0,USE_NORMAL_MAP:!0,USE_VERTEX_COLOR:!0,USE_SIDE_SHADOW:!0}})}},{key:"_createWallSideMaterial",value:function(){var e=U.a.get("cloud-noise"),t=U.a.get("concrete-normal");return new gt({uniforms:{uMap:{value:null},uTime:{value:0},uNoise:{value:e},uNormal:{value:t},uNormalMapScale:{value:0},uMapRepeat:{value:9},uColorIntensity:{value:.4},uUVScale:{value:new m.Vector2(.15,.28)},uColorMix:{value:new m.Color("#b6b740")},uCameraPosition:{value:new m.Vector3(0,0,0)},uLightPosition:{value:new m.Vector3(0,0,1.6)}},side:m.DoubleSide,defines:{USE_MAP:!1,USE_NORMAL_MAP:!0,USE_SHADOW_MAP:!1,USE_VERTEX_COLOR:!1,USE_SIDE_SHADOW:!0}})}},{key:"_createMesh",value:function(){var e=this;return this._facade.scale.set(this._initialScale.x,this._initialScale.y,this._initialScale.z),this._facade.traverse((function(t){if(t.isMesh)switch("_"===t.name[0]&&(t.visible=!1),t.name){case"structure_left":case"structure_right":t.material=e._materials.wall;break;case"logo_left":case"logo_right":t.material=e._materials.gold;break;case"logo_wall_left":case"logo_wall_right":t.material=e._materials.wallSide;break;default:t.visible=!1}})),this.add(this._facade),this._facade}},{key:"_createAnimationManager",value:function(){var e=new _t({model:this._model,animations:this._model.animations});return this._model.animationManager=e,e}},{key:"onUpdate",value:function(e){var time=e.time,t=e.deltaTime,n=e.frame;this._model.animationManager.update({time:time,deltaTime:t,frame:n}),this._materials.wall.uniforms.uTime.value+=.001*t,this._materials.wall.uniforms.uTime.value+=.001*t,this._materials.wall.uniforms.uCameraPosition.value=this._camera.position}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t={uColorMix:"#".concat(this._materials.wallSide.uniforms.uColorMix.value.getHexString()),uColorMix2:"#".concat(this._materials.wall.uniforms.uColorMix.value.getHexString()),uSideColor:"#".concat(this._materials.wall.uniforms.uSideColor.value.getHexString())},n=function(){e._materials.gold.uniforms.uColor.value.set(e._settings.materials.gold.color),e._materials.gold.uniforms.uOpacity.value=e._settings.materials.gold.opacity,e._materials.gold.uniforms.uOffset.value.set(e._settings.materials.gold.offset.x,e._settings.materials.gold.offset.y)},o=this._debug.addFolder({title:"Facade",expanded:!1}),r=o.addTab({pages:[{title:"Gold"},{title:"Wall"},{title:"Side"}]});return r.pages[0].addInput(this._settings.materials.gold.matcap,"image",{label:"Matcap",view:"image",height:100,showMonitor:!0}).on("change",(function(t){var n=t.value;e._materials.gold.uniforms.uMatcap.value=(new m.TextureLoader).load(n.src),e._materials.gold.uniforms.uMatcap.value.flipY=!1})),r.pages[0].addInput(this._settings.materials.gold,"color",{label:"Color"}).on("change",n),r.pages[0].addInput(this._settings.materials.gold,"opacity",{label:"Opacity"}).on("change",n),r.pages[0].addInput(this._settings.materials.gold,"offset",{label:"Offset",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",n),r.pages[1].addInput(t,"uColorMix2",{label:"Color"}).on("change",(function(){e._materials.wall.uniforms.uColorMix.value.set(t.uColorMix2)})),r.pages[1].addInput(t,"uSideColor",{label:"Color"}).on("change",(function(){e._materials.wall.uniforms.uSideColor.value.set(t.uSideColor)})),r.pages[1].addInput(this._settings.animation,"progress",{label:"Animation Progress",min:0,max:1}).on("change",(function(){e.skipAnimation(e._settings.animation.progress)})),r.pages[1].addInput(this._materials.wall.uniforms.uCloudsScale,"value",{label:"Clouds Scale"}),r.pages[1].addInput(this._materials.wall.uniforms.uCloudsSpeed,"value",{label:"Clouds Speed"}),r.pages[1].addInput(this._materials.wall.uniforms.uMapRepeat,"value",{label:"Map repeat"}),r.pages[1].addInput(this._materials.wall.uniforms.uShadowAlphaProgress,"value",{label:"Shadow Alpha Progress"}),r.pages[1].addInput(this._materials.wall.uniforms.uNormalMapScale,"value",{label:"Normal Scale"}),r.pages[1].addInput(this._materials.wall.uniforms.uMapRepeat,"value",{label:"Map repeat"}),r.pages[1].addInput(this._materials.wall.uniforms.uLightPosition,"value",{label:"Light Position"}),r.pages[1].addInput(this._materials.wall.uniforms.uMap.value,"image",{label:"Facade Texture",view:"image",height:60,showMonitor:!0}).on("change",(function(t){var n=t.value,o=e._materials.wall.uniforms.uMap.value=(new m.TextureLoader).load(n.src);o.wrapS=o.wrapT=m.RepeatWrapping})),r.pages[2].addInput(t,"uColorMix",{label:"Color"}).on("change",(function(){e._materials.wallSide.uniforms.uColorMix.value.set(t.uColorMix)})),r.pages[2].addInput(this._materials.wallSide.uniforms.uUVScale,"value",{label:"UV Scale"}),r.pages[2].addInput(this._materials.wallSide.uniforms.uNormalMapScale,"value",{label:"Normal Scale"}),r.pages[2].addInput(this._materials.wallSide.uniforms.uLightPosition,"value",{label:"Light Position"}),o}}}]),n}(component(m.Object3D));function xt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var wt=function(e){Object(x.a)(n,e);var t=xt(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._renderTarget=this._setupRenderTarget(),this._renderTargetScene=this._setupRenderTargetScene(),this._groundGeometry=this._createGroundGeometry(),this._groundMaterial=this._createGroundMaterial(),this._groundMesh=this._createGroundMesh(),this._reflectionRotationContainer=new m.Object3D,this._renderTargetScene.add(this._reflectionRotationContainer),this._reflectionMesh=this._createReflectionMesh(),this._debugFolder=this._createDebugFolder()}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._groundGeometry.dispose(),this._groundMaterial.dispose()}},{key:"renderTarget",get:function(){return this._renderTarget}},{key:"renderTargetScene",get:function(){return this._renderTargetScene}},{key:"reflectionRotationContainer",get:function(){return this._reflectionRotationContainer}},{key:"_createGroundGeometry",value:function(){return new m.PlaneGeometry(1,1,1,1)}},{key:"_createGroundMaterial",value:function(){var e=U.a.get("concrete-ground"),t=U.a.get("concrete-normal"),n=U.a.get("facade-shadow"),o=U.a.get("cloud-noise"),r={uReflectionTexture:{value:this._renderTarget.texture},uGroundTexture:{value:e},uShadowTexture:{value:n},uNoiseTexture:{value:o},uCloudsSpeed:{value:.13},uCloudsScale:{value:2.19},uTime:{value:0},uNormalMap:{value:t},uRepeatNormal:{value:17},uNormalMapScale:{value:new m.Vector2(-1.4,2.2)},uGroundFadeOffset:{value:2.8},uGroundFadeAlpha:{value:.06},uResolution:{value:new m.Vector2(0,0)},uLightPos:{value:new m.Vector3(4.3,4.5,5)},uKa:{value:.64},uKd:{value:1.02},uKs:{value:1.8},uShininess:{value:1.3},uColorA:{value:new m.Color("#ffd79a")},uColorD:{value:new m.Color("#ffcc6f")},uColorS:{value:new m.Color("#dfdfdf")},uAlphaReflection:{value:.62},uAlphaFade:{value:.25},uFadeRange:{value:new m.Vector2(3.4,2.7)}};return new m.ShaderMaterial({uniforms:r,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\nvoid main() {\n    vec3 transformed = position;\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    vec3 transformedNormal = normalMatrix * normal;\n\n    vUv = uv;\n    vPosition = mvPosition.xyz;\n    vNormal = normalize(transformedNormal);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nvarying vec2 vUv;\n\nuniform sampler2D uNoiseTexture;\nuniform float uCloudsScale;\nuniform float uCloudsSpeed;\nuniform float uTime;\n\nuniform sampler2D uReflectionTexture;\nuniform sampler2D uGroundTexture;\nuniform float uGroundFadeOffset;\nuniform float uGroundFadeAlpha;\n\nuniform sampler2D uShadowTexture;\n\nuniform sampler2D uNormalMap;\nuniform float uRepeatNormal;\nuniform vec2 uNormalMapScale;\nuniform vec2 uResolution;\n// Light\nuniform vec3 uLightPos;\nuniform float uShininess;\nuniform float uKa;\nuniform float uKd;\nuniform float uKs;\nuniform vec3 uColorA;\nuniform vec3 uColorD;\nuniform vec3 uColorS;\nuniform float uAlphaFade;\nuniform float uAlphaReflection;\nuniform vec2 uFadeRange;\n\n// Imports\nvec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, vec2 uv, float faceDirection) {\n\tvec3 q0 = dFdx(eye_pos.xyz);\n\tvec3 q1 = dFdy(eye_pos.xyz);\n\tvec2 st0 = dFdx(uv.st);\n\tvec2 st1 = dFdy(uv.st);\n\tvec3 N = surf_norm;\n\tvec3 q1perp = cross(q1, N);\n\tvec3 q0perp = cross(N, q0);\n\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\tfloat det = max(dot(T, T), dot(B, B));\n\tfloat scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);\n\treturn normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);\n}\n\nvec2 scaleUv(vec2 uv, float scale)\n{\n  return (uv - 0.5) * (1.0 / scale) + 0.5;\n}\n\nvoid main() {\n\n    vec2 uvTimeShift = vUv * uCloudsScale + vec2( 1.3, -1.7 ) * uTime * uCloudsSpeed;\n  \tvec4 noiseTexture = texture2D(uNoiseTexture, uvTimeShift);\n\n    vec2 fragPos = gl_FragCoord.xy / uResolution;\n    vec4 renderTex = texture2D(uReflectionTexture, fragPos);\n\n    vec2 scaledUv = scaleUv(vUv, 0.42);\n    vec4 shadowTex = texture2D(uShadowTexture, vec2(scaledUv.x, scaledUv.y - 0.032));\n\n    float powUv = pow(vUv.y * 2., 4.);\n\n    float smoothOpacity = smoothstep((powUv + uFadeRange.x),(powUv + uFadeRange.y), uAlphaFade * 15.);\n    smoothOpacity *= uAlphaReflection;\n\n\t  vec3 normal = normalize(vNormal);\n    vec3 mapN = texture2D(uNormalMap, vUv * uRepeatNormal).rgb * 2.0 - 1.0;\n    mapN.rg *= uNormalMapScale;    \n    normal = perturbNormal2Arb(vPosition, normal, mapN, vUv, 1.0);\n    \n    vec3 L = normalize(uLightPos - vec3(vPosition.x, 1., 1.0));\n    vec3 N = normalize(normal);\n\n    float lambertian = max(dot(N, L), 0.0);\n    \n    vec3 R = reflect(L, N);\n    vec3 V = normalize(-vPosition);\n    \n    float specAngle = max(dot(R, V), 0.0);\n    float specular = pow(specAngle, uShininess);\n    vec3 lightOut = vec3(uKa * uColorA +\n                        uKd * lambertian * uColorD + \n                        uKs * specular * uColorS);\n                        \n    renderTex.a -= mapN.r * 0.5;\n    renderTex.a *= smoothOpacity;\n\n    vec4 groundTex = texture2D(uGroundTexture, vUv * uRepeatNormal);\n                        \n    vec3 finalColor = groundTex.rgb * lightOut.rgb;\n    float fadeAlpha = smoothstep(pow(1.0 - vUv.y, uGroundFadeOffset), 0., uGroundFadeAlpha);\n\n    finalColor = mix(finalColor, renderTex.rgb, renderTex.a);\n    finalColor *= mix(finalColor, shadowTex.rgb, shadowTex.a);\n\n    if (fadeAlpha < 0.01) discard;\n\n    gl_FragColor = vec4(finalColor, fadeAlpha);\n}",transparent:!0,extensions:{derivatives:!0}})}},{key:"_createGroundMesh",value:function(){var e=new m.Mesh(this._groundGeometry,this._groundMaterial);return e.rotation.x-=Math.PI/2,e.scale.set(200,200,200),e.renderOrder=-1,this.add(e),e}},{key:"_createReflectionMesh",value:function(){var e=new m.PlaneGeometry(1,1,1,1),t=new m.MeshBasicMaterial({map:U.a.get("facade-background"),transparent:!0}),n=new m.Mesh(e,t);n.position.y-=9.4,n.position.x+=.05;var o=18.9;return n.scale.set(o,o,o),this._reflectionRotationContainer.add(n),n}},{key:"_setupRenderTarget",value:function(){return new m.WebGLRenderTarget(512,512)}},{key:"_setupRenderTargetScene",value:function(){return new m.Scene}},{key:"onUpdate",value:function(e){e.time;var t=e.deltaTime;e.frame;this._groundMesh.material.uniforms.uTime.value+=.001*t}},{key:"onWindowResize",value:function(e){this._resize(e)}},{key:"_resize",value:function(e){this._groundMesh.material.uniforms.uResolution.value.set(e.innerWidth*e.dpr,e.innerHeight*e.dpr)}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t={uColorA:"#".concat(this._groundMaterial.uniforms.uColorA.value.getHexString()),uColorD:"#".concat(this._groundMaterial.uniforms.uColorD.value.getHexString()),uColorS:"#".concat(this._groundMaterial.uniforms.uColorS.value.getHexString())},n=this._debug.addFolder({title:"Ground",expanded:!1}),o=n.addTab({pages:[{title:"Main"},{title:"Fog"},{title:"Light"},{title:"Reflection"},{title:"Clouds"}]});return o.pages[0].addInput(this._groundMaterial.uniforms.uGroundTexture.value,"image",{label:"Ground Texture",view:"image",height:60,showMonitor:!0}).on("change",(function(t){var n=t.value,o=e._groundMaterial.uniforms.uGroundTexture.value=(new m.TextureLoader).load(n.src);o.wrapS=o.wrapT=m.RepeatWrapping})),o.pages[0].addInput(this._groundMaterial.uniforms.uNormalMap.value,"image",{label:"Normal Texture",view:"image",height:60,showMonitor:!0}).on("change",(function(t){var n=t.value,o=e._groundMaterial.uniforms.uNormalMap.value=(new m.TextureLoader).load(n.src);o.wrapS=o.wrapT=m.RepeatWrapping})),o.pages[0].addInput(this._groundMaterial.uniforms.uRepeatNormal,"value",{label:"Repeat Normal"}),o.pages[0].addInput(this._groundMaterial.uniforms.uNormalMapScale,"value",{label:"Scale Normal"}),o.pages[1].addInput(this._groundMaterial.uniforms.uGroundFadeOffset,"value",{label:"Ground Fade Offset"}),o.pages[1].addInput(this._groundMaterial.uniforms.uGroundFadeAlpha,"value",{label:"Ground Fade Alpha"}),o.pages[2].addInput(this._groundMaterial.uniforms.uLightPos,"value",{label:"Light Pos"}),o.pages[2].addInput(this._groundMaterial.uniforms.uKa,"value",{label:"Ambient"}),o.pages[2].addInput(this._groundMaterial.uniforms.uKd,"value",{label:"Diffuse"}),o.pages[2].addInput(this._groundMaterial.uniforms.uKs,"value",{label:"Specular"}),o.pages[2].addInput(this._groundMaterial.uniforms.uShininess,"value",{label:"Shininess"}),o.pages[2].addInput(t,"uColorA",{label:"Ambient"}).on("change",(function(){e._groundMaterial.uniforms.uColorA.value.set(t.uColorA)})),o.pages[2].addInput(t,"uColorD",{label:"Diffuse"}).on("change",(function(){e._groundMaterial.uniforms.uColorD.value.set(t.uColorD)})),o.pages[2].addInput(t,"uColorS",{label:"Specular"}).on("change",(function(){e._groundMaterial.uniforms.uColorS.value.set(t.uColorS)})),o.pages[3].addInput(this._groundMaterial.uniforms.uAlphaFade,"value",{label:"Alpha Fade"}),o.pages[3].addInput(this._groundMaterial.uniforms.uFadeRange,"value",{label:"Fade Range"}),o.pages[3].addInput(this._groundMaterial.uniforms.uAlphaReflection,"value",{label:"Reflection Global Alpha"}),o.pages[4].addInput(this._groundMaterial.uniforms.uCloudsScale,"value",{label:"Clouds Scale"}),o.pages[4].addInput(this._groundMaterial.uniforms.uCloudsSpeed,"value",{label:"Clouds Speed"}),n}}}]),n}(component(m.Object3D));function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var kt=function(e){Object(x.a)(n,e);var t=St(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(e){this._debug=e.debugFolder,this._empties=e.empties,this._activeIndex=12,this._settings={visible:!1,scale:new m.Vector2(2.94,4.41),offsetPosition:new m.Vector3(0,.01,.01),stroke:{alpha:1,scale:new m.Vector2(.93,1.06),outsetWidth:.92,insetWidth:.92}},this._geometry=this._createGeometry(),this._material=this._createMaterial(),this._mesh=this._createMesh(),this._debugFolder=this._createDebugFolder(),this.visible=this._settings.visible,this._mesh.position.x=this._empties[this._activeIndex].position.x+this._settings.offsetPosition.x,this._mesh.position.y=this._empties[this._activeIndex].position.y+this._settings.offsetPosition.y,this._mesh.position.z=this._settings.offsetPosition.z}},{key:"destroy",value:function(){var e;Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._geometry.dispose(),this._material.dispose(),null===(e=this.timeline)||void 0===e||e.kill()}},{key:"activeIndex",get:function(){return this._activeIndex},set:function(e){this._activeIndex=e,this._mesh.position.x=this._empties[this._activeIndex].position.x+this._settings.offsetPosition.x,this._mesh.position.y=this._empties[this._activeIndex].position.y+this._settings.offsetPosition.y,this._mesh.position.z=this._settings.offsetPosition.z}},{key:"playAnimation",value:function(){var e;return null===(e=this.timeline)||void 0===e||e.kill(),this.timeline=new d.b.timeline,this.timeline.timeScale(1.2),this.timeline.set(this,{visible:!0},0),this.timeline.fromTo(this._material.uniforms.uAlpha0,{value:0},{duration:1,value:1,ease:"sine.inOut"},0),this.timeline.fromTo(this._material.uniforms.uAlpha1,{value:0},{duration:1,value:1,ease:"sine.inOut"},.2),this.timeline.fromTo(this._material.uniforms.uAlpha2,{value:0},{duration:1,value:1,ease:"sine.inOut"},.4),this.timeline.fromTo(this._material.uniforms.uScale0,{value:1},{duration:1,value:.6,ease:"sine.inOut"},0),this.timeline.fromTo(this._material.uniforms.uScale1,{value:1},{duration:1,value:.6,ease:"sine.inOut"},.2),this.timeline.fromTo(this._material.uniforms.uScale2,{value:1},{duration:1,value:.6,ease:"sine.inOut"},.4),this.timeline.fromTo(this._material.uniforms.uOpacity,{value:1},{duration:1.5,value:0,ease:"sine.inOut"},0),this.timeline.set(this,{visible:!1}),this.timeline}},{key:"goTo",value:function(){}},{key:"_createGeometry",value:function(){return new m.PlaneGeometry(1,1,1)}},{key:"_createMaterial",value:function(){return new m.ShaderMaterial({depthWrite:!1,vertexShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\nvarying vec4 vPosition;\n\nvoid main() {\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pos.xyz /= pos.w;\n\n    vUv = uv;\n    vPosition = pos;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define GLSLIFY 1\n// Varyings\nvarying vec2 vUv;\n\n// Uniforms\nuniform vec2 uScale;\nuniform float uOpacity;\n\n//// Shape\nuniform sampler2D uShape;\n\n//// Stroke\nuniform vec3 uStrokeColor;\nuniform float uStrokeOutsetWidth;\nuniform float uStrokeInsetWidth;\n\n//// Animations\nuniform float uScale0;\nuniform float uScale1;\nuniform float uScale2;\n\nuniform float uAlpha0;\nuniform float uAlpha1;\nuniform float uAlpha2;\n\nvec2 scaleUv(vec2 uv, float scale)\n{\n  return (uv - 0.5) * (1.0 / scale) + 0.5;\n}\n\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\n\nvoid main() {\n\tvec2 uv = vUv;\n\tuv.x = (uv.x - 0.5) * (1.0 / uScale.x) + 0.5;\n\tuv.y = (uv.y - 0.5) * (1.0 / uScale.y) + 0.5;\n\n\tvec2 uv0 = scaleUv(uv, uScale0);\n\tvec2 uv1 = scaleUv(uv, uScale1);\n\tvec2 uv2 = scaleUv(uv, uScale2);\n\n\t// Texture sample\n\tvec3 s0 = texture2D(uShape, uv0).rgb;\n\tvec3 s1 = texture2D(uShape, uv1).rgb;\n\tvec3 s2 = texture2D(uShape, uv2).rgb;\n\n\t// Signed distance\n\tfloat sigDist0 = median(s0.r, s0.g, s0.b) - 0.5;\n\tfloat sigDist1 = median(s1.r, s1.g, s1.b) - 0.5;\n\tfloat sigDist2 = median(s2.r, s2.g, s2.b) - 0.5;\n\n\tfloat afwidth = 1.4142135623730951 / 2.0;\n\n\t// Outset\n\tfloat sigDistOutset0 = sigDist0 + uStrokeOutsetWidth * 0.5;\n\tfloat sigDistOutset1 = sigDist1 + uStrokeOutsetWidth * 0.5;\n\tfloat sigDistOutset2 = sigDist2 + uStrokeOutsetWidth * 0.5;\n\n\tfloat outset0 = clamp(sigDistOutset0 / fwidth(sigDistOutset0) + 0.5, 0.0, 1.0);\n\tfloat outset1 = clamp(sigDistOutset1 / fwidth(sigDistOutset1) + 0.5, 0.0, 1.0);\n\tfloat outset2 = clamp(sigDistOutset2 / fwidth(sigDistOutset2) + 0.5, 0.0, 1.0);\n\n\t// Inset\n\tfloat sigDistInset0 = sigDist0 - uStrokeInsetWidth * 0.5;\n\tfloat sigDistInset1 = sigDist1 - uStrokeInsetWidth * 0.5;\n\tfloat sigDistInset2 = sigDist2 - uStrokeInsetWidth * 0.5;\n\n\tfloat inset0 = 1.0 - clamp(sigDistInset0 / fwidth(sigDistInset0) + 0.5, 0.0, 1.0);\n\tfloat inset1 = 1.0 - clamp(sigDistInset1 / fwidth(sigDistInset1) + 0.5, 0.0, 1.0);\n\tfloat inset2 = 1.0 - clamp(sigDistInset2 / fwidth(sigDistInset2) + 0.5, 0.0, 1.0);\n\n\t// Border\n\tfloat border0 = outset0 * inset0 * uAlpha0;\n\tfloat border1 = outset1 * inset1 * uAlpha1;\n\tfloat border2 = outset2 * inset2 * uAlpha2;\n\n\t// Output\n\tvec4 strokedFragColor = vec4(uStrokeColor, uOpacity * clamp(border0 + border1 + border2, 0.0, 1.0));\n\n\tgl_FragColor = strokedFragColor;\n}",transparent:!0,extensions:{derivatives:!0},uniforms:{uScale:{value:this._settings.stroke.scale},uOpacity:{value:1},uShape:{value:U.a.get("arch")},uStrokeOutsetWidth:{value:this._settings.stroke.outsetWidth},uStrokeInsetWidth:{value:this._settings.stroke.insetWidth},uStrokeColor:{value:new m.Color("white")},uScale0:{value:1},uScale1:{value:.8},uScale2:{value:.5},uAlpha0:{value:1},uAlpha1:{value:.8},uAlpha2:{value:.5}}})}},{key:"_createMesh",value:function(){var e=new m.Mesh(this._geometry,this._material);return e.renderOrder=3,this.add(e),e}},{key:"onUpdate",value:function(e){e.time,e.deltaTime,e.frame}},{key:"onWindowResize",value:function(e){this._resize()}},{key:"_resize",value:function(){this._mesh.scale.x=this._settings.scale.x,this._mesh.scale.y=this._settings.scale.y}},{key:"_createDebugFolder",value:function(){var e=this;if(this._debug){var t=function(){e.visible=e._settings.visible,e._mesh.scale.x=e._settings.scale.x,e._mesh.scale.y=e._settings.scale.y,e._mesh.position.x=e._empties[e._activeIndex].position.x+e._settings.offsetPosition.x,e._mesh.position.y=e._empties[e._activeIndex].position.y+e._settings.offsetPosition.y,e._mesh.position.z=e._settings.offsetPosition.z,e._material.uniforms.uStrokeInsetWidth.value=e._settings.stroke.insetWidth,e._material.uniforms.uStrokeOutsetWidth.value=e._settings.stroke.outsetWidth,e._material.uniforms.uScale.value.x=e._settings.stroke.scale.x,e._material.uniforms.uScale.value.y=e._settings.stroke.scale.y,e._material.uniforms.uOpacity.value=e._settings.stroke.alpha},n=this._debug.addFolder({title:"Arch Outlines",expanded:!1});n.addInput(this._settings,"visible").on("change",t),n.addInput(this._settings,"scale").on("change",t),n.addInput(this._settings,"offsetPosition").on("change",t),n.addButton({title:"Animate"}).on("click",(function(){e.playAnimation()}));var o=n.addFolder({title:"Stroke"});return o.addInput(this._settings.stroke,"scale").on("change",t),o.addInput(this._settings.stroke,"alpha").on("change",t),o.addInput(this._settings.stroke,"outsetWidth",{min:-1,max:1}).on("change",t),o.addInput(this._settings.stroke,"insetWidth",{min:-1,max:1}).on("change",t),n}}}]),n}(component(m.Object3D));function Ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(S.a)(e);if(t){var r=Object(S.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(w.a)(this,n)}}var Mt=function(e){Object(x.a)(n,e);var t=Ct(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"init",value:function(){this._settings={mouse:{damping:.05,positionAmplitude:{x:0,y:0,z:0},rotationAmplitude:{x:-.1,y:.05,z:0},factor:0,factorOverview:1,factorNavigation:.5,factorDetails:0}},this._isReady=!1,this._config=ke,this._centeredMousePosition={target:new m.Vector2(0,0),current:new m.Vector2(0,0)},this._cameraController=null,this._debugFolder=this._createDebugFolder(),this._cameraManager=this._createCameraManager(),this._rotationContainer=new m.Object3D,this.add(this._rotationContainer),this._skipAnimation=!1}},{key:"destroy",value:function(){Object(D.a)(Object(S.a)(n.prototype),"destroy",this).call(this),this._destroyComponents()}},{key:"config",get:function(){return this._config}},{key:"camera",get:function(){return this._cameraManager.camera}},{key:"cameraController",get:function(){return this._cameraController}},{key:"initialize",value:function(e){"critical"!==e&&(this._components=this._createComponents(),this._cameraController=this._createCameraController(),this._modelCamera=this._applyModelCamera(),this._isReady=!0)}},{key:"compile",value:function(e,t){"critical"!==t&&(e.compile(this,this._cameraManager.camera),e.compile(this._components.ground.renderTargetScene,this._cameraManager.camera))}},{key:"renderGround",value:function(e){this._isReady&&(e.setRenderTarget(this._components.ground.renderTarget),e.render(this._components.ground.renderTargetScene,this._cameraManager.camera))}},{key:"render",value:function(e){this._isReady&&e.render(this,this._cameraManager.camera)}},{key:"playIntroAnimation",value:function(){this._components&&this._components.facade&&this._components.facade.playAnimation(),this._components&&this._components.bags&&this._components.bags.playAnimation(),this._components&&this._components.bagShadow&&this._components.bagShadow.playAnimation(),this._components&&this._components.curtains&&this._components.curtains.playAnimation()}},{key:"skipIntroAnimation",value:function(){this._skipAnimation=!0,this._components&&this._components.facade&&this._components.facade.skipAnimation(),this._components&&this._components.bags&&this._components.bags.skipAnimation(),this._components&&this._components.bagShadow&&this._components.bagShadow.skipAnimation(),this._components&&this._components.curtains&&this._components.curtains.skipAnimation()}},{key:"setCollectedItems",value:function(e){if(this._components.bagOverlay)for(var i=0;i<e.length;i++){var t=e[i];this._components.bagOverlay.hideOverlay(t)}}},{key:"showOverlays",value:function(){if(this._components)return this._components.bagOverlay.fadeInOverlay()}},{key:"hideOverlays",value:function(){if(this._components)return this._components.bagOverlay.fadeOutOverlay()}},{key:"playSelectionFeedback",value:function(e,t){this._components&&(this._components.bags.playSelectionFeedback(e,t),this._components.archOutlines.activeIndex=e,this._components.archOutlines.playAnimation())}},{key:"animationCompleted",value:function(){d.b.killTweensOf(this._settings.mouse),d.b.to(this._settings.mouse,{duration:1,factor:this._settings.mouse.factorNavigation,ease:"sine.inOut"})}},{key:"goToOverview",value:function(){d.b.killTweensOf(this._settings.mouse),d.b.to(this._settings.mouse,{duration:1,factor:this._settings.mouse.factorOverview,ease:"sine.inOut"})}},{key:"leaveOverview",value:function(){d.b.killTweensOf(this._settings.mouse),d.b.to(this._settings.mouse,{duration:1,factor:this._settings.mouse.factorNavigation,ease:"sine.inOut"})}},{key:"goToDetails",value:function(e){this._components&&(this._cameraController.goToFocus(e),this._components.bags.goToDetails(e),this._components.bagShadow.setActiveBag(e),d.b.killTweensOf(this._settings.mouse),d.b.to(this._settings.mouse,{duration:1,factor:this._settings.mouse.factorDetails,ease:"sine.inOut"}))}},{key:"leaveDetails",value:function(e){this._components&&(this._cameraController.leaveFocus(e),this._components.bags.leaveDetails(e),this._components.bagShadow.removeActiveBag(e),d.b.killTweensOf(this._settings.mouse),d.b.to(this._settings.mouse,{duration:1,factor:this._settings.mouse.factorNavigation,ease:"sine.inOut"}))}},{key:"_createCameraManager",value:function(){return new Z({types:["Model","Orbit","Default"],debugFolder:this._debugFolder})}},{key:"_createCameraController",value:function(){return new Ie({debugFolder:this._debugFolder,camera:this._cameraManager.getCamera("Model"),grid:this._components.grid,raycastMeshes:this._components.bagOverlay.raycastMeshes})}},{key:"_applyModelCamera",value:function(){var e=this._cameraManager.getCamera("Model");return e.applyModelCamera(U.a.get("scene-V9").cameras[0]),e}},{key:"_createComponents",value:function(){var e={};return e.facade=this._createComponentFacade(),e.ground=this._createComponentGround(),e.curtains=this._createComponentCurtains(e.facade),e.particles=this._createComponentParticles(),e.bagOverlay=this._createComponentBagOverlay(e.facade),e.bags=this._createComponentBags(e.facade),e.bagShadow=this._createComponentBagShadow(e.facade,e.bags),e.grid=this._createComponentGrid(e.facade),e.archOutlines=this._createComponentArchOutlines(e.facade),e}},{key:"_createComponentGrid",value:function(e){var t=new ht({isDebug:!1,empties:e.getGridPositionEmpties()});return this._rotationContainer.add(t),t}},{key:"_createComponentFacade",value:function(){var e=new bt({debugFolder:this._debugFolder,camera:this._cameraManager.getCamera("Model")});return this._skipAnimation&&e.skipAnimation(),this._rotationContainer.add(e),e}},{key:"_createComponentGround",value:function(){var e=new wt({debugFolder:this._debugFolder});return this._rotationContainer.add(e),e}},{key:"_createComponentCurtains",value:function(e){var t=new Je({debugFolder:this._debugFolder,camera:this._cameraManager.getCamera("Model"),empties:e.getGridPositionEmpties()});return this._skipAnimation&&t.skipAnimation(),this._rotationContainer.add(t),t}},{key:"_createComponentParticles",value:function(){var e=new at({debugFolder:this._debugFolder,camera:this._cameraManager.getCamera("Model")});return this._rotationContainer.add(e),e}},{key:"_createComponentBagOverlay",value:function(e){var t=new ot({debugFolder:this._debugFolder,cameraController:this._cameraController,empties:e.getGridPositionEmpties()});return this._rotationContainer.add(t),t}},{key:"_createComponentBags",value:function(e){var t=new Xe({debugFolder:this._debugFolder,empties:e.getGridPositionEmpties()});return this._skipAnimation&&t.skipAnimation(),this._rotationContainer.add(t),t}},{key:"_createComponentBagShadow",value:function(e,t){var n=new ut({debugFolder:this._debugFolder,cameraController:this._cameraController,empties:e.getGridPositionEmpties(),bagsInstances:t.bags});return this._skipAnimation&&n.skipAnimation(),this._rotationContainer.add(n),n}},{key:"_createComponentArchOutlines",value:function(e){var t=new kt({debugFolder:this._debugFolder,empties:e.getGridPositionEmpties()});return this._rotationContainer.add(t),t}},{key:"_destroyComponents",value:function(){if(this._components)for(var e in this._components)"function"==typeof this._components[e].destroy&&this._components[e].destroy()}},{key:"onMousemove",value:function(e){var t=e.centeredMousePosition;this._centeredMousePosition.target.x=t.x,this._centeredMousePosition.target.y=t.y}},{key:"onUpdate",value:function(e){var t=e.deltaTime;this._centeredMousePosition.current.x=ue.a.lerp(this._centeredMousePosition.current.x,this._centeredMousePosition.target.x,t/16*this._settings.mouse.damping),this._centeredMousePosition.current.y=ue.a.lerp(this._centeredMousePosition.current.y,this._centeredMousePosition.target.y,t/16*this._settings.mouse.damping),this._rotationContainer.position.x=this._settings.mouse.positionAmplitude.x*this._centeredMousePosition.current.x*this._settings.mouse.factor,this._rotationContainer.position.y=this._settings.mouse.positionAmplitude.y*this._centeredMousePosition.current.y*this._settings.mouse.factor,this._rotationContainer.position.z=this._settings.mouse.positionAmplitude.z*this._centeredMousePosition.current.y*this._settings.mouse.factor,this._rotationContainer.rotation.x=this._settings.mouse.rotationAmplitude.y*this._centeredMousePosition.current.y*this._settings.mouse.factor,this._rotationContainer.rotation.y=this._settings.mouse.rotationAmplitude.x*this._centeredMousePosition.current.x*this._settings.mouse.factor,this._components&&this._components.ground&&(this._components.ground.reflectionRotationContainer.position.x=this._settings.mouse.positionAmplitude.x*this._centeredMousePosition.current.x*this._settings.mouse.factor,this._components.ground.reflectionRotationContainer.position.y=this._settings.mouse.positionAmplitude.y*this._centeredMousePosition.current.y*this._settings.mouse.factor,this._components.ground.reflectionRotationContainer.position.z=this._settings.mouse.positionAmplitude.z*this._centeredMousePosition.current.y*this._settings.mouse.factor,this._components.ground.reflectionRotationContainer.rotation.x=this._settings.mouse.rotationAmplitude.y*this._centeredMousePosition.current.y*this._settings.mouse.factor,this._components.ground.reflectionRotationContainer.rotation.y=this._settings.mouse.rotationAmplitude.x*this._centeredMousePosition.current.x*this._settings.mouse.factor)}},{key:"_createDebugFolder",value:function(){if(this.$debugger){var e=this.$debugger.addFolder({title:"Scene ".concat(ke.name),expanded:!1}),t=e.addFolder({title:"Mouse"});return t.addInput(this._settings.mouse,"damping"),t.addInput(this._settings.mouse,"positionAmplitude",{label:"Position"}),t.addInput(this._settings.mouse,"rotationAmplitude",{label:"Rotation"}),e}}}]),n}(component(m.Scene)),Ot={main:ge,Sample:te,Main:ge,Sky:we,Facade:Mt},Pt=(n(655),n(309)),Rt=n(656),At=n(169),Tt={isEnabled:!0,renderScale:.2,isVisible:!1,clearAlpha:.1,radius:3,color:new m.Color("#ffffff"),hardness:.1,lerp:.1,drawOnMouseMove:!0},Ft=function(){function e(t,n,o){Object(c.a)(this,e);var r=Object.assign(Tt,o),l=r.isEnabled,h=r.renderScale,d=r.isVisible,m=r.clearAlpha,f=r.radius,v=r.color,_=r.hardness,y=r.lerp,x=r.drawOnMouseMove;this._viewportWidth=t,this._viewportHeight=n,this._isEnabled=l,this._renderScale=h,this._width=this._viewportWidth*this._renderScale,this._height=this._viewportHeight*this._renderScale,this._isVisible=d,this._clearAlpha=m,this._radius=f,this._color=v,this._hardness=_,this._lerp=y,this._drawOnMouseMove=x,this._mousePosition={target:{x:0,y:0},current:{x:0,y:0},old:{x:0,y:0},velocity:0},this._particlesArray=[],this._frame=0,this._isFirstDraw=!0,this._canvas=this._createCanvas(),this._texture=this._createTexture(),this._ctx=this._createContext(),this._bindAll(),this._resizeCanvas(),this._setupEventListeners()}return Object(h.a)(e,[{key:"destroy",value:function(){this._canvas.remove(),this._removeEventListeners()}},{key:"canvas",get:function(){return this._canvas}},{key:"texture",get:function(){return this._texture}},{key:"ctx",get:function(){return this._ctx}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"renderScale",get:function(){return this._renderScale},set:function(e){this._renderScale=e,this._width=this._viewportWidth*this._renderScale,this._height=this._viewportHeight*this._renderScale,this._resizeCanvas()}},{key:"isEnabled",get:function(){return this._isEnabled},set:function(e){this._isEnabled=e}},{key:"isVisible",get:function(){return this._isVisible},set:function(e){this._isVisible=e,this._canvas.style.visibility=e?"visible":"hidden"}},{key:"clearAlpha",get:function(){return this._clearAlpha},set:function(e){this._clearAlpha=e}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius=e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e}},{key:"hardness",get:function(){return this._hardness},set:function(e){this._hardness=e}},{key:"lerp",get:function(){return this._lerp},set:function(e){this._lerp=e}},{key:"mouseVelocity",get:function(){return this._mousePosition.velocity}},{key:"drawOnMouseMove",get:function(){return this._drawOnMouseMove},set:function(e){this._drawOnMouseMove=e}},{key:"update",value:function(e){e.time,e.deltaTime;var t=e.frame;this._isEnabled&&(this._mousePosition.current.x=Object(At.a)(this._mousePosition.current.x,this._mousePosition.target.x,this._lerp),this._mousePosition.current.y=Object(At.a)(this._mousePosition.current.y,this._mousePosition.target.y,this._lerp),this._mousePosition.velocity=Object(At.a)(this._mousePosition.velocity,Object(Pt.a)(.01*(this._mousePosition.current.x-this._mousePosition.target.x),-.5,.5),.1),this._frame=t,this._draw())}},{key:"show",value:function(){this.isVisible=!0}},{key:"hide",value:function(){this.isVisible=!1}},{key:"toggleVisibility",value:function(){this.isVisible=!this.isVisible}},{key:"resize",value:function(e,t){this._viewportWidth=e,this._viewportHeight=t,this._width=256,this._height=256,this._resizeCanvas()}},{key:"_createCanvas",value:function(){var canvas=document.createElement("canvas");return canvas.classList.add("mouse-fbo"),canvas.style.visibility=this._isVisible?"visible":"hidden",canvas.style.position="fixed",canvas.style.inset=0,document.body.appendChild(canvas),canvas}},{key:"_createTexture",value:function(){return new m.CanvasTexture(this._canvas)}},{key:"_createContext",value:function(){return this._canvas.getContext("2d")}},{key:"_initialDraw",value:function(){this._ctx.fillStyle="#050505",this._ctx.fillRect(0,0,this._width,this._height)}},{key:"_resizeCanvas",value:function(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.width="100%",this._canvas.style.height="100%"}},{key:"_draw",value:function(){this._isFirstDraw&&(this._initialDraw(),this._isFirstDraw=!1);for(var i=0;i<this._particlesArray.length;i++)this._updateParticlesPhysics(this._particlesArray[i]);this._ctx.fillStyle="rgba(0, 0, 0, ".concat(this._clearAlpha,")"),this._ctx.fillRect(0,0,this._width,this._height),this._texture.needsUpdate=!0}},{key:"_spawnParticles",value:function(){var e=this._mousePosition.velocity>0?.5:-.5,t={x:this._mousePosition.current.x,y:this._mousePosition.current.y+2,radius:this._radius*(20*Math.abs(this._mousePosition.velocity)),vx:e,vy:Object(Rt.a)(1,1.5),opacity:.5,birth:this._frame,life:100};this._particlesArray.push(t)}},{key:"_drawParticles",value:function(e){this._ctx.beginPath(),this._ctx.arc(e.x,e.y,e.radius,2*Math.PI,!1),this._ctx.fillStyle="rgba(255, 255, 255, ".concat(e.opacity,")"),this._ctx.fill()}},{key:"_updateParticlesPhysics",value:function(e){if(e.x+=e.vx,e.y+=e.vy,e.opacity=1-1*(this._frame-e.birth)/e.life,e.radius+=.2*e.vy,this._frame>e.birth+e.life){for(var i=0;i<this._particlesArray.length;i++)if(e.birth===this._particlesArray[i].birth&&e.life===this._particlesArray[i].life){this._particlesArray.splice(i,1);break}}else this._drawParticles(e)}},{key:"_clear",value:function(){}},{key:"_bindAll",value:function(){this._mousemoveHandler=this._mousemoveHandler.bind(this)}},{key:"_setupEventListeners",value:function(){window.addEventListener("mousemove",this._mousemoveHandler)}},{key:"_removeEventListeners",value:function(){window.removeEventListener("mousemove",this._mousemoveHandler)}},{key:"_mousemoveHandler",value:function(e){this._mousePosition.target.x=e.clientX/this._viewportWidth*this._width,this._mousePosition.target.y=e.clientY/this._viewportHeight*this._height,this._drawOnMouseMove&&this._isEnabled&&this._spawnParticles()}}]),e}(),Lt={initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.__initialize(e)},prepare:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.__prepare(e)},start:function(){this.__start()},destroy:function(){this.__destroy()},skipLoadingAnimation:function(){this._scene&&"Main"===this._scene.name&&(this._scene.skipLoadingAnimation(),this._scene.sceneFacade.skipIntroAnimation())},setLoadingProgress:function(progress){this._scene&&"Main"===this._scene.name&&(this._scene.textPreloader.value=progress)},playIntroLoadingAnimation:function(){if(this._scene&&"Main"===this._scene.name)return this._scene.playIntroLoadingAnimation()},playLoadingAnimationComplete:function(){if(this._scene&&"Main"===this._scene.name)return this._scene.playLoadingAnimationComplete()},hideLoadingProgress:function(){if(this._scene&&"Main"===this._scene.name)return this._scene.hideLoadingProgress()},playTimelapseAnimation:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneSky.playTimelapseAnimation()},playIntroAnimation:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.playIntroAnimation()},enableNavigation:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.enableNavigation()},disableNavigation:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.disableNavigation()},enableBackNavigation:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.enableBackNavigation()},disableBackNavigation:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.disableBackNavigation()},enableSelection:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.enableSelection()},disableSelection:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.disableSelection()},enableTutorialSelection:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.enableTutorialSelection()},disableTutorialSelection:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.disableTutorialSelection()},animationCompleted:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade&&this._scene.sceneFacade.animationCompleted()},setCollectedItems:function(e){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.setCollectedItems(e)},goToOverview:function(){this._scene&&"Main"===this._scene.name&&(this._scene.sceneFacade&&this._scene.sceneFacade.goToOverview(),this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.goToOverview())},leaveOverview:function(e){this._scene&&"Main"===this._scene.name&&(this._scene.sceneFacade&&this._scene.sceneFacade.leaveOverview(),this._scene.sceneFacade.cameraController&&this._scene.sceneFacade.cameraController.leaveOverview(e))},showOverlays:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.showOverlays()},playSelectionFeedback:function(e,t){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.playSelectionFeedback(e,t)},hideOverlays:function(){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.hideOverlays()},goToDetails:function(e){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.goToDetails(e)},leaveDetails:function(e){this._scene&&"Main"===this._scene.name&&this._scene.sceneFacade.leaveDetails(e)},noFocus:function(){if(this._scene&&"Main"===this._scene.name)return this._scene.noFocus()},smallFocus:function(){if(this._scene&&"Main"===this._scene.name)return this._scene.smallFocus()},fullFocus:function(){if(this._scene&&"Main"===this._scene.name)return this._scene.fullFocus()}},It=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this._canvas=t.canvas,this._debugger=t.debugger,this._nuxtRoot=t.nuxtRoot,this._gpuTier=t.gpuTier,this.isDevelopment=t.isDevelopment,this._gpuTier=t.gpuTier,this._gpu=t.gpu,this._isReady=!1,I.start(),this._renderer=this._createRenderer(),this._mouseInteractionFBO=this._createMouseInteractionFBO(),this._raycaster=this._createRaycaster(),this._registerBidelloGlobals(),this._stats=this._createStats(),this._statsGpuPanel=this._createStatsGpuPanel(),this._bindAll(),this._setupEventListeners(),P.a.triggerResize()}return Object(h.a)(e,[{key:"__initialize",value:function(e){this._scene||(this._scene=this._createScene()),this._scene.initialize&&this._scene.initialize(e),P.a.triggerResize()}},{key:"__prepare",value:function(e){j.a.compute(this._renderer,e),this._compile(e)}},{key:"__start",value:function(){this._isReady=!0}},{key:"__destroy",value:function(){var e;this._removeEventListeners(),this._removeStats(),null===(e=this._scene)||void 0===e||e.destroy(),j.a.clear()}},{key:"_createRenderer",value:function(){return new(0,m.WebGLRenderer)({canvas:this._canvas,powerPreference:"high-performance",antialias:!1,alpha:!0})}},{key:"_createMouseInteractionFBO",value:function(){return new Ft(P.a.innerWidth,P.a.innerHeight)}},{key:"_createRaycaster",value:function(){return new m.Raycaster}},{key:"_createScene",value:function(){var e=new URLSearchParams(location.search).get("scene");return Ot[e]?new Ot[e]:new Ot.main}},{key:"_createStats",value:function(){if(this.isDevelopment){var e=new _.a;return document.body.appendChild(e.dom),e}}},{key:"_createStatsGpuPanel",value:function(){if(this.isDevelopment){var e=new f.a(this._renderer.getContext());return this._stats.addPanel(e),this._stats.showPanel(0),e}}},{key:"_removeStats",value:function(){this._stats&&(document.body.removeChild(this._stats.dom),this._stats=null)}},{key:"_registerBidelloGlobals",value:function(){O.registerGlobal("root",this),O.registerGlobal("nuxtRoot",this._nuxtRoot),O.registerGlobal("renderer",this._renderer),O.registerGlobal("canvas",this._canvas),O.registerGlobal("debugger",this._debugger),O.registerGlobal("mouseFBO",this._mouseInteractionFBO),O.registerGlobal("raycaster",this._raycaster)}},{key:"_resize",value:function(e){this._resizeRenderer(e),this._triggerBidelloResize(e),this._mouseInteractionFBO.resize(e.innerWidth,e.innerHeight)}},{key:"_resizeRenderer",value:function(e){var t=this._gpuTier<3?1.5:2,n=Math.min(e.dpr,t);this._renderer.setPixelRatio(n),this._renderer.setSize(e.innerWidth,e.innerHeight,!0)}},{key:"_triggerBidelloResize",value:function(e){O.trigger({name:"windowResize",fireAtStart:!0},e)}},{key:"_tick",value:function(e){var t,n,time=e.time,o=e.deltaTime,r=e.frame;this._isReady&&(null===(t=this._stats)||void 0===t||t.begin(),this._update({time:time,deltaTime:o,frame:r}),this._render({time:time,deltaTime:o,frame:r}),null===(n=this._stats)||void 0===n||n.end())}},{key:"_update",value:function(e){var time=e.time,t=e.deltaTime,n=e.frame;this._mouseInteractionFBO.update({time:time,deltaTime:t,frame:n}),this._triggerBidelloUpdate({time:time,deltaTime:t,frame:n})}},{key:"_triggerBidelloUpdate",value:function(e){var time=e.time,t=e.deltaTime,n=e.frame;O.trigger({name:"update",fireAtStart:!1},{time:time,deltaTime:t,frame:n})}},{key:"_render",value:function(){var e,t;null===(e=this._statsGpuPanel)||void 0===e||e.startQuery(),this._scene&&(this._scene.render?this._scene.render(this._renderer):this._renderer.render(this._scene,this._scene.camera)),null===(t=this._statsGpuPanel)||void 0===t||t.endQuery()}},{key:"_compile",value:function(e){this._scene&&(this._scene.compile?this._scene.compile(this._renderer,e):this._renderer.compile(this._scene,this._scene.camera))}},{key:"_bindAll",value:function(){this._tickHandler=this._tickHandler.bind(this),this._resizeHandler=this._resizeHandler.bind(this)}},{key:"_setupEventListeners",value:function(){P.a.addEventListener("resize",this._resizeHandler),d.b.ticker.add(this._tickHandler)}},{key:"_removeEventListeners",value:function(){P.a.removeEventListener("resize",this._resizeHandler),d.b.ticker.remove(this._tickHandler)}},{key:"_tickHandler",value:function(time,e,t){this._tick({time:time,deltaTime:e,frame:t})}},{key:"_resizeHandler",value:function(e){this._resize(e)}}]),e}();function jt(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}Object.assign(It.prototype,Lt);var Dt={computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?jt(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):jt(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(r.b)({isDebug:"context/isDebug",isDevelopment:"context/isDevelopment",isCriticalLoadingCompleted:"preloader/isCriticalLoadingCompleted",isLoadingCompleted:"preloader/isLoadingCompleted",isCompleted:"preloader/isCompleted"})),watch:{isCriticalLoadingCompleted:function(){var e,t,n=this;null===(e=this.$root.webglApp)||void 0===e||e.initialize("critical"),null===(t=this.$root.webglApp)||void 0===t||t.prepare("critical"),setTimeout((function(){var e;null===(e=n.$root.webglApp)||void 0===e||e.start()}),1e3)},isLoadingCompleted:function(){var e,t;null===(e=this.$root.webglApp)||void 0===e||e.initialize(),null===(t=this.$root.webglApp)||void 0===t||t.prepare()},isCompleted:function(){}},mounted:function(){var e=this;Object(l.a)({benchmarksURL:"./libs/detect-gpu/benchmarks"}).then((function(t){var n=t.gpu,o=t.tier;e.setupDebugger(n,o),e.setupWebGL(n,o),e.$store.dispatch("webgl/setMounted")}))},beforeDestroy:function(){var e,t;null===(e=this.$root.debugger)||void 0===e||e.destroy(),null===(t=this.$root.webglApp)||void 0===t||t.destroy(),this.$root.webglApp=null},methods:{setupDebugger:function(e,t){},setupWebGL:function(e,t){var n,o,r,l;(this.$root.webglApp=new It({canvas:this.$el,nuxtRoot:this.$root,debugger:this.$root.debugger,isDevelopment:this.isDevelopment,gpuTier:t,gpu:e}),this.isCompleted)&&(null===(n=this.$root.webglApp)||void 0===n||n.initialize("critical"),null===(o=this.$root.webglApp)||void 0===o||o.prepare("critical"),null===(r=this.$root.webglApp)||void 0===r||r.initialize(),null===(l=this.$root.webglApp)||void 0===l||l.prepare(),this.$root.webglApp.start(),this.isDevelopment&&this.$root.webglApp.skipLoadingAnimation())}}},zt=Dt,Ut=(n(657),n(58)),Nt=Object(Ut.a)(zt,(function(){var e=this._self._c;this._self._setupProxy;return e("canvas",{staticClass:"the-webgl-background"})}),[],!1,null,"6ee10543",null);t.default=Nt.exports}}]);